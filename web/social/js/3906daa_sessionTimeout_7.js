(function($){jQuery.sessionTimeout=function(options){var defaults={message:Translator.trans("Your session is about to expire."),keepAliveUrl:generateLangURL("/keep-alive"),keepAliveAjaxRequestType:"POST",redirUrl:generateLangURL("/timed-out"),logoutUrl:generateLangURL("/logout"),warnAfter:9e5,redirAfter:12e5,appendTime:true,access_token:"",returnedConversationId:"",actionUrl:generateLangURL("/close-session"),width:555};var o=defaults,dialogTimer,redirTimer;if(options){o=$.extend(defaults,options)}$("body").append('<div title="'+Translator.trans("Session Timeout")+'" id="sessionTimeout-dialog">'+o.message+"</div>");$("#sessionTimeout-dialog").dialog({autoOpen:false,width:o.width,modal:true,closeOnEscape:false,open:function(){$(".ui-dialog-titlebar-close").hide()},buttons:{"Refresh Session":function(){$("#airplaneform").submit();$(".ui-dialog-content").html(Translator.trans("Please wait while we refresh the session..."))},"End Session":function(){window.location=o.logoutUrl}}});function controlDialogTimer(action){switch(action){case"start":dialogTimer=setTimeout(function(){$("#sessionTimeout-dialog").dialog("open");controlRedirTimer("start")},o.warnAfter);break;case"stop":clearTimeout(dialogTimer);break}}function controlRedirTimer(action){switch(action){case"start":redirTimer=setTimeout(function(){$.ajax({type:"POST",url:o.actionUrl,data:{access_token:o.access_token,returnedConversationId:o.returnedConversationId}}).done(function(){window.location=o.redirUrl})},o.redirAfter-o.warnAfter);break;case"stop":clearTimeout(redirTimer);break}}function updateQueryStringParameter(uri,key,value){var re=new RegExp("([?|&])"+key+"=.*?(&|#|$)","i");if(uri.match(re)){return uri.replace(re,"$1"+key+"="+value+"$2")}else{var hash="";if(uri.indexOf("#")!==-1){hash=uri.replace(/.*#/,"#");uri=uri.replace(/#.*/,"")}var separator=uri.indexOf("?")!==-1?"&":"?";return uri+separator+key+"="+value+hash}}$(document).ajaxComplete(function(){if(!$("#sessionTimeout-dialog").dialog("isOpen")){controlRedirTimer("stop");controlDialogTimer("stop");controlDialogTimer("start")}});controlDialogTimer("start")}})(jQuery);