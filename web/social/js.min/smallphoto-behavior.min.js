var $outer_container;var $preloader;var $bg_full_img;var $nextImageBtn;var $prevImageBtn;var full_currentpage=0;var GettingNext=false;var GettingPrev=false;var NoMorePrev=false;var NoMoreNext=false;var NextPage=0;var PrevPage=0;var single_thumb_width;var min_left=0;var slideInterval=0;var SkipNext=0;var SkipPrev=0;var ORIGINAL_PHOTO_ID;function centerOn(d){var b=$("#ThumbViewer li").length;var a=-1*b*single_thumb_width+5*single_thumb_width;var c=-1*(d-2)*single_thumb_width;if(c<a){c=a}if(c>min_left){c=min_left}$("#ThumbViewer ul").stop().animate({left:c},500)}function LoadNext(){if(GettingNext||NoMoreNext){return}GettingNext=true;NextPage=NextPage+1;var a=$("#ThumbViewer ul li").last();var b=a.attr("data-id");$.ajax({url:ReturnLink("/ajax/photo_viewer.php"),data:{vid:ORIGINAL_PHOTO_ID,min_id:b,page:NextPage,skip:SkipNext},type:"post",success:function(d){var h=null;try{h=$.parseJSON(d)}catch(e){}if(!h){return}if(h.length==0){GettingNext=false;$("#ThumbNext").addClass("inactive");NoMoreNext=true;return}$("#ThumbNext").removeClass("inactive");$.each(h.media,function(o,p){var m=$('<li class="ThumbViewerListItem"></li>');m.attr({"data-id":p.id});var j=$('<a class="ThumbViewer_a"></a>');j.attr({href:p.media_uri}).appendTo(m);var k=$('<div class="enlarge '+p.enlarge_class+'"></div>');k.appendTo(j);var l=$("<img/>");l.attr({"data-title":p.title,alt:p.title,"data-rel":p.id,url:p.url,comments:p.comment_pages,width:"136",height:"76",src:decodeURL(p.thumb_image)}).addClass("ThumbViewerImage").appendTo(j);m.append("<span></span>");m.appendTo($("#ThumbViewer ul"));var k=$("<img/>");k.attr({"data-title":p.title,alt:p.title,"data-rel":p.id,src:decodeURL(p.big_image)}).css({display:"none",width:p.width,height:p.height});var n=$("<a></a>").attr({title:p.title,href:decodeURL(p.big_image),"data-rel":"gallery"});k.appendTo(n)});if(parseInt(h.total)<=(NextPage+1)*5){GettingNext=false;$("#ThumbNext").addClass("inactive");NoMoreNext=true}$("#ThumbViewer li").preloader();var f=$("#ThumbViewer li").length;var c=$("#ThumbViewer ul").offset().left-$("#ThumbViewer").offset().left;var g=c-single_thumb_width*5;if((g%single_thumb_width)!=0){g=g+Math.abs(g%single_thumb_width)}$("#ThumbViewer ul").stop(false,true).css({position:"relative"}).animate({left:g},500);$("#ThumbViewer ul").css("width",f*single_thumb_width+"px");GettingNext=false;single_thumb_width=140}})}$(document).ready(function(){$outer_container=$("#bg_full");$preloader=$("#preloader");single_thumb_width=140;ORIGINAL_PHOTO_ID=$("#BigImageHolder").attr("data-id");$("#ThumbViewer li").preloader();$bg_full_img=$("#bg_full_img");$nextImageBtn=$(".nextImageBtn");$prevImageBtn=$(".prevImageBtn");sliderWidth=$outer_container.width();var b=0;fadeSpeed=200;$(window).resize(function(){FullScreenBackground("#bg_full_img",$bg_full_img.data("newImageW"),$bg_full_img.data("newImageH"));var d=$outer_container.width();sliderWidth=d});$nextImageBtn.click(function(e){e.preventDefault();full_currentpage++;var d=$(this);if(d.hasClass("inactive")){return}SwitchImage($outer_container.data("nextImage"));$bg_full_img.attr("title",d.attr("data-title"));$(".header_txt").html(d.attr("data-title"));$("#favbutton").attr("data-id",d.attr("data-id"));GetNextPrevImages(ORIGINAL_PHOTO_ID)});$prevImageBtn.click(function(e){e.preventDefault();full_currentpage--;if(full_currentpage<0&&parseInt($(".glob_container").attr("data-album"))==0){full_currentpage=0}var d=$(this);if(d.hasClass("inactive")){return}SwitchImage($outer_container.data("prevImage"));$bg_full_img.attr("title",d.attr("data-title"));$(".header_txt").html(d.attr("data-title"));GetNextPrevImages(ORIGINAL_PHOTO_ID)});$("#favbutton").click(function(){var d=$(this);TTCallAPI({what:"social/favorite",data:{entity_id:d.attr("data-id"),entity_type:SOCIAL_ENTITY_MEDIA,channel_id:channelGlobalID()},callback:function(e){if(e.status=="ok"){if(e.favorite==0){d.removeClass("active");d.attr("data-title",t("add to favorites"))}else{d.addClass("active");d.attr("data-title",t("remove from favorites"))}$("#bg_full .mediabuttonsOver .ProfileHeaderOverin").html(d.attr("data-title"));if($(".glob_container").attr("data-id")==d.attr("data-id")){if(e.favorite==0){$("#favorite").removeClass("active");$("#favorite").attr("data-title",t("add to favorites"))}else{$("#favorite").addClass("active");$("#favorite").attr("data-title",t("remove from favorites"))}$("#media_buttons .mediabuttonsOver .ProfileHeaderOverin").html($("#favorite").attr("data-title"))}}}})});$(document).on("mouseover","#fsbutton, #favbutton, #shlkbutton",function(){if(!$("#bg_full .mediabuttonsOver").hasClass("inactive")){var d=$(this).offset().left-$(this).parent().offset().left-251;$("#bg_full .mediabuttonsOver .ProfileHeaderOverin").html($(this).attr("data-title"));$("#bg_full .mediabuttonsOver").css("left",d+"px");$("#bg_full .mediabuttonsOver").css("top","-18px");$("#bg_full .mediabuttonsOver").stop().show()}else{$("#bg_full .mediabuttonsOver").hide()}});$(document).on("mouseout","#fsbutton, #favbutton, #shlkbutton",function(){$("#bg_full .mediabuttonsOver").hide()});$(document).on("click","#shlkbutton",function(){if($(".share_link_holder.fullmode").css("display")!="none"){$(".share_link_holder.fullmode").hide();$("#bg_full .mediabuttonsOver").removeClass("inactive");$(this).removeClass("active")}else{$("#bg_full .mediabuttonsOver").addClass("inactive");$(this).addClass("active");$(".share_link_holder.fullmode").show();$("#bg_full .mediabuttonsOver").hide()}});$(document).keydown(function(d){if($(".glob_container").css("display")!="none"){if(d.keyCode==39){$nextImageBtn.click();return false}else{if(d.keyCode==37){$prevImageBtn.click();return false}}}});$(document).on("click",".fulls_div",function(){$(".glob_container").hide();$(document).fullScreen(false);$("body").removeClass("ofh")});$(document).bind("fullscreenchange",function(d){if(!$(document).fullScreen()){$(".glob_container").hide();$("body").removeClass("ofh")}});$(document).on("click","#fullscreen_pic",function(){$(document).fullScreen(true);setNewImageData();$(".glob_container").show();$("body").addClass("ofh")});var c=jQuery(window).width();if(c<768){$(document).on("click","#BigImageHolder, #fullscreen_pic",function(){$(document).fullScreen(true);setNewImageData();$(".glob_container").show();if(!$(".mediabuttonsOver").hasClass("active")){$(".mediabuttonsOver .ProfileHeaderOverin").html($(this).attr("data-title"));$(".mediabuttonsOver").hide()}});$(window).resize(function(){$(".mediabuttonsOver").css("left","auto !important");$(".mediabuttonsOver").css("right","20px !important")});$(function(){if($.isFunction("swipe")){alert("hi");$("#swiper_pic").swipe({swipe:function(g,d,e,f,h,i){if(d=="left"){$nextImageBtn.trigger("click")}else{$prevImageBtn.trigger("click")}phase:"move"},threshold:0,fingers:"all",})}})}$("#ThumbNext").click(function(){var f=$("#ThumbViewer li").length;var d=$("#ThumbViewer ul").offset().left-$("#ThumbViewer").offset().left;if(f<5||$(this).hasClass("inactive")){return}var e=-1*f*single_thumb_width+5*single_thumb_width;var g=d-single_thumb_width*5;if(g<=e&&!NoMoreNext){g=e;LoadNext()}$("#ThumbPrev").removeClass("inactive");if((g%single_thumb_width)!=0){g=g+Math.abs(g%single_thumb_width)}if(NoMoreNext&&(g-(5*single_thumb_width)+($("#ThumbViewer ul li").size()*single_thumb_width))<=0){$("#ThumbNext").addClass("inactive")}$("#ThumbViewer ul").stop(false,true).css({position:"relative"}).animate({left:g},500)});$("#ThumbPrev").click(function(){var e=$("#ThumbViewer li").length;var d=$("#ThumbViewer ul").offset().left-$("#ThumbViewer").offset().left;if(d>=0){d=0;$(this).addClass("inactive")}if($(this).hasClass("inactive")){return}var f=d+single_thumb_width*5;$("#ThumbNext").removeClass("inactive");if((f%single_thumb_width)!=0){f=f+Math.abs(f%single_thumb_width)}if(f>=0){f=0;$(this).addClass("inactive")}$("#ThumbViewer ul").width($("#ThumbViewer ul li").size()*single_thumb_width);$("#ThumbViewer ul").stop(false,true).css({position:"relative"}).animate({left:f},500)});var a=false;$("span.ProfileFollow").click(function(){$.ajax({url:ReturnLink("/ajax/photo_viewer_subscribe.php"),type:"post",data:{uid:ORIGINAL_USER_ID},success:function(f){var e;try{e=$.parseJSON(f)}catch(d){TTAlert({msg:t("Couldn't Process Request. Please try again later."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(!e){TTAlert({msg:t("Couldn't Process Request. Please try again later."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(e.status=="ok"){TTAlert({msg:e.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{TTAlert({msg:e.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}}})});$("span.ProfileFriend").click(function(){$.ajax({url:ReturnLink("/ajax/photo_viewer_addfriend.php"),type:"post",data:{uid:ORIGINAL_USER_ID},success:function(f){var e;try{e=$.parseJSON(f)}catch(d){TTAlert({msg:t("Couldn't Process Request. Please try again later."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(!e){TTAlert({msg:t("Couldn't Process Request. Please try again later."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(e.status=="ok"){TTAlert({msg:e.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{TTAlert({msg:e.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}}})})});function setNewImageData(){full_currentpage=0;$bg_full_img.attr("src","");var a=new Image();a.onload=CreateDelegate(a,theNewImg_onload);a.src=$("#BigImageHolder img").attr("data-org");$bg_full_img.attr("title",$("#BigImageHolder img").attr("data-title"));$(".header_txt").html($("#BigImageHolder img").attr("data-title"));$nextImageBtn.addClass("inactive");$prevImageBtn.addClass("inactive");if($nextImageBtn.length>0){GetNextPrevImages(ORIGINAL_PHOTO_ID)}}function BackgroundLoad(a,c,b,d){a.fadeOut("fast",function(){a.attr("src","").attr("src",d);FullScreenBackground(a,c,b);$preloader.fadeOut("fast",function(){a.fadeIn("slow")})})}function GetNextPrevImages(a){$.post(ReturnLink("/ajax/ajax_getNextPrevImages.php"),{id:a,favorite_data_id:$("#favbutton").attr("data-id"),page:full_currentpage,is_album:$(".glob_container").attr("data-album"),data_id:$(".glob_container").attr("data-id")},function(b){var d=null;try{d=$.parseJSON(b)}catch(c){return}if(d.photo_next_big==""||d.next_id==null){$nextImageBtn.addClass("inactive")}else{$nextImageBtn.removeClass("inactive");$outer_container.data("nextImage",d.photo_next_big);$nextImageBtn.attr("data-id",d.next_id);$nextImageBtn.attr("data-title",d.next_title)}if(d.photo_prev_big==""||d.prev_id==null){$prevImageBtn.addClass("inactive")}else{$prevImageBtn.removeClass("inactive");$outer_container.data("prevImage",d.photo_prev_big);$prevImageBtn.attr("data-id",d.prev_id);$prevImageBtn.attr("data-title",d.prev_title)}if(d.favorite==0){$("#favbutton").removeClass("active");$("#favbutton").attr("data-title",t("add to favorites"))}else{$("#favbutton").addClass("active");$("#favbutton").attr("data-title",t("remove from favorites"))}$(".share_link_holder.fullmode .share_link_text").val(d.sh_link);$(".share_link_holder.fullmode .sh_lk1").attr("href","http://www.facebook.com/sharer.php?s=100&amp;p[url]="+d.sh_link);$(".share_link_holder.fullmode .sh_lk2").attr("href","https://plus.google.com/share?url="+d.sh_link);$(".share_link_holder.fullmode .sh_lk3").attr("href","http://www.twitter.com/intent/tweet?url="+d.sh_link);incrementObjectsViews(SOCIAL_ENTITY_MEDIA,d.inc_id)})}function SwitchImage(a){$preloader.fadeIn("fast");var b=new Image();b.onload=CreateDelegate(b,theNewImg_onload);b.src=a}function CreateDelegate(a,b){return function(){return b.apply(a,arguments)}}function theNewImg_onload(){$bg_full_img.data("newImageW",this.width).data("newImageH",this.height);BackgroundLoad($bg_full_img,this.width,this.height,this.src)}function FullScreenBackground(e,b,a){var g=$(window).width();var f=$(window).height()-25;var c=a/b;var d=b/a;if((f/g)>c){$(e).attr("width",g);$(e).attr("height",c*g)}else{$(e).attr("height",f);$(e).attr("width",d*f)}$(e).css("margin-left",(g-$(e).width())/2);$(e).css("margin-top",(f-$(e).height())/2+25)};