var currentpage=0;var fr_txt="";var to_txt="";var TO_CAL;var one_object=0;var globorderby="";var privacyValue=0;var privacyArray=new Array();$(document).ready(function(){$(document).on("click","#resetpagebut",function(){document.location.reload()});InitCalendar();InitDocument();if(parseInt(is_owner)==1){initUserCalendarEvents()}$(document).on("click","#hide_button",function(){updateeventpagedata("is_visible",0,$(this).closest(".itemList"))});$(document).on("click",".hideText",function(){updateeventpagedata("is_visible",1,$(this).closest(".itemList"))});$(document).on("click",".DeleteEventAction",function(){removeevent($(this).closest(".itemList"))});$("#load_more_next").click(function(a){a.preventDefault();a.stopImmediatePropagation();currentpage++;getEventsDataRelated(1)});$(document).on("click","#hide_button_viewer",function(){$(this).closest(".itemList").remove();if($("#load_more_next").css("display")!="none"){one_object=1;getEventsDataRelated(1)}else{$(".list_container").attr("data-skip",skipnumber)}});$("#searchCalendarbut").click(function(){if($("#fromtxt").html()!=""||$("#totxt").html()!=""){fr_txt=""+$("#fromtxt").attr("data-cal");to_txt=""+$("#totxt").attr("data-cal");currentpage=0;$(".list_container").attr("data-skip",0);$(".list_container").html("");getEventsDataRelated(0)}});$("#searchbut").click(function(){txt_srch_init=""+$("#srchtxt").val();if(txt_srch_init==$("#srchtxt").attr("data-value")){txt_srch_init=""}globorderby=$("#sortby").val();currentpage=0;$(".list_container").attr("data-skip",0);$(".list_container").html("");getEventsDataRelated(0)})});function initResetIcon(a){a.removeClass("privacy_icon1");a.removeClass("privacy_icon2");a.removeClass("privacy_icon3");a.removeClass("privacy_icon4");a.removeClass("privacy_icon5");a.removeClass("privacy_icon6")}function initResetSelectedUsers(a){resetSelectedUsers(a)}function InitDocument(){$(".event_data").each(function(){var a=$(this);var b=a.find(".hide");a.mouseenter(function(){b.removeClass("hide")}).mouseleave(function(){b.addClass("hide")})})}function InitCalendar(){Calendar.setup({inputField:"fromtxt",noScroll:true,trigger:"frombutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());TO_CAL.args.min=a;TO_CAL.redraw();$("#fromtxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"});TO_CAL=Calendar.setup({inputField:"totxt",noScroll:true,trigger:"tobutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());$("#totxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"})}function addCalToEvent(a){if(new Date($("#fromtxt").attr("data-cal"))>new Date($("#totxt").attr("data-cal"))){$("#totxt").attr("data-cal",$("#fromtxt").attr("data-cal"));$("#totxt").val($("#fromtxt").val())}}function getEventsDataRelated(a){var b=a;if(a==1){b=parseInt($(".list_container").attr("data-skip"))}$(".upload-overlay-loading-fix").show();$.post(ReturnLink("/ajax/ajax_loadmoreTTevent.php"),{user_id:userGlobalID(),txt_srch_init:txt_srch_init,globorderby:globorderby,currentpage:currentpage,frtxt:fr_txt,totxt:to_txt,one_object:one_object,skip:b},function(d){if(d!=false){$(".list_container").append(d);var c=$(".list_container .currPageStatus");if((""+c.attr("data-value"))=="0"){$("#load_more_next").hide()}else{$("#load_more_next").show()}$(".event_text span.yellowbold12").html("("+c.attr("data-count")+")");c.remove();InitDocument()}else{$("#load_more_next").hide()}if(a==1&&one_object>0){b++;$(".list_container").attr("data-skip",b)}one_object=0;$(".upload-overlay-loading-fix").hide()})}function removeevent(b){var a=b.attr("data-id");TTAlert({msg:t("Canceling this event cannot be undone.<br/>This action deletes it from all joining people events' list."),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(c){if(c){updateeventpagedata("remove",-2,b)}}})}function updateeventpagedata(b,c,a){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_TT_event_update.php"),data:{str:b,data:c,id:a.attr("data-id")},type:"post",success:function(d){if(b=="is_visible"){if(parseInt(c)==0){a.find(".hideitems").removeClass("displaynone");a.find(".DeleteEventAction").addClass("displaynone");a.find(".EditEventAction").addClass("displaynone");a.addClass("inactive")}else{a.find(".hideitems").addClass("displaynone");a.find(".DeleteEventAction").removeClass("displaynone");a.find(".EditEventAction").removeClass("displaynone");a.removeClass("inactive")}}else{if(b=="remove"){a.remove();one_object=1;getEventsDataRelated(-1)}}$(".upload-overlay-loading-fix").hide()}})}function initUserCalendarEvents(){var d=0;var c=0;var b="";var g;EventsDetailedCal=Calendar.setup({cont:"idEventsCalendar_user",noScroll:true,bottomBar:false,selectionType:Calendar.SEL_MULTIPLE,disabled:function(){return true},dateInfo:getDateUserInfo,onChange:function(){var h="";if(b!=""){clearTimeout(b)}b=setTimeout(function(){$(".DynarchCalendar-day-selected.highlight_user, .DynarchCalendar-day-selected.highlight_user2").each(function(j,i){$(this).parent().mouseenter(function(){h=$(this).find(".DynarchCalendar-day-selected").attr("dyc-date");c=0;var k=DATE_USER_INFOInit[h][0];$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltip_a > .ed_CalEventImg").attr("src",k.imageurl);var l=ReturnLink("/events-detailed/"+k.id);$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltip_a").attr("href",l);$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltip_a > .ed_CalTooltipTitle").html(k.title);$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltipClose").attr("data-DateIndex",h);var n=$(this).position().top;var m=$(this).position().left;$(".ed_CalTooltipContent_user").css("margin-top",(n+63)+"px").css("margin-left",(m-33)+"px").show()});$(this).parent().mouseleave(function(){$(".ed_CalTooltipContent_user").hide()})})},500)}});$(".ed_CalTooltipContent_user").mouseenter(function(){$(this).show()});$(".ed_CalTooltipContent_user").mouseleave(function(){$(this).hide()});$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltipClose").click(function(){c++;if(DATE_USER_INFOInit[$(this).attr("data-DateIndex")].length>c){var h=DATE_USER_INFOInit[$(this).attr("data-DateIndex")][c];$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltip_a > .ed_CalEventImg").attr("src",h.imageurl);var i=ReturnLink("/events-detailed/"+h.id);$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltip_a").attr("href",i);$(".ed_CalTooltipContent_user > .ed_CalTooltip > .ed_CalTooltip_a > .ed_CalTooltipTitle").html(h.title)}else{$(".ed_CalTooltipContent_user").hide()}});$(".ed_CalTooltipContent_user .ed_CalTooltip").mouseleave(function(){$(".ed_CalTooltipContent_user").hide()});var a=new Array(),e=0;for(var f in DATE_USER_INFO){a[e]=f;e++}EventsDetailedCal.selection.set(a)}function getDateUserInfo(d,n){var a=Calendar.dateToInt(d);var k={};if(DATE_USER_INFOInit[a]){var b=new Array();for(var f=0;f<DATE_USER_INFOInit[a].length;f++){var l=DATE_USER_INFOInit[a][f];var h=l.klass;var e=false;for(var g=0;g<b.length;g++){if(b[g]==h){e=true}}if(!e){b.push(h)}}var c="";for(var g=0;g<b.length;g++){var m=b[g].replace(/"/g,"");c+=m+" "}k={klass:c,tooltip:""}}return k}function checkSubmit(a){if(a&&a.keyCode==13){$("#searchbut").click()}};