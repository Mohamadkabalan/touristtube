var pagename="";var jscrollpane_apiJ;var fr_txt="";var to_txt="";var journals_page=0;var journal_items_order="";var privacyValue="";var privacyArray=new Array();var custom_privacy_names=new Array();var add_more_box='<div class="addmore" style="margin: 0px 3px 3px 0;"><input id="addmoretext_custum_privacy_detailed" class="addmoretext_css addmoretext_custum_privacy_detailed ui-autocomplete-input" type="text" data-id="" onblur="addValue2(this)" onfocus="removeValue2(this)" data-value="'+$.i18n._("add more")+'" value="'+$.i18n._("add more")+'" name="addmoretext" autocomplete="off"><span role="status" aria-live="polite" class="ui-helper-hidden-accessible"></span><span role="status" aria-live="polite" class="ui-helper-hidden-accessible"></span></div>';var followers_box='<div class="peoplesdata formttl13" id="followersdata" data-email="" data-id="" style="width: 73px;"><div class="peoplesdatainside">'+t("followers")+'</div><div class="peoplesdataclose"></div></div>';var friends_of_friends_box='<div class="peoplesdata formttl13" id="friends_of_friends_data" data-email="" data-id="" style="width: 117px;"><div class="peoplesdatainside">'+t("friends of friends")+'</div><div class="peoplesdataclose"></div></div>';var friends_box='<div class="peoplesdata formttl13" id="friendsdata" data-email="" data-id="" style="width: 60px;"><div class="peoplesdatainside">'+t("friends")+'</div><div class="peoplesdataclose"></div></div>';var user_box='<div class="peoplesdata" data-email="" data-id="%user_id%" style="width: 120px;"><div class="peoplesdatainside">%username%</div><div class="peoplesdataclose"></div></div>';var journal_selected="";var objclicked="";$(document).ready(function(){$(document).on("click","#resetpagebut",function(){document.location.reload()});$(document).on("change","select[name=country]",function(){var b=$(this).closest(".editDiv");b.find("#edit_city_text").val("");b.find("#edit_city_text_cityname").val("");b.find("#edit_city_text_cityname").attr("data-id","")});if($("#fromtxt").length>0){InitCalendar()}if($(".body_div").length>0){initscrollPane()}if($(".social_data_all").length>0){initSocialActions();if(parseInt(is_owner)==1){addAutoComplete()}hideScrollBar();currentpage_like=0;$(".social_data_all").attr("data-page-like",0);currentpage_comments=0;$(".social_data_all").attr("data-page-comments",0);currentpage_shares=0;$(".social_data_all").attr("data-page-shares",0);if($("#report_button_log_viewer_journal").length>0){initReportFunctions($("#report_button_log_viewer_journal"))}}$(document).on("mouseover",".privacy_icon_glob",function(){var b=$("#JournalMainDiv").offset().left+255;var c=$("#JournalMainDiv").offset().top+22;var d=$(this).offset().left-b;var e=$(this).offset().top-c;$(".privacybuttonsOver .ProfileHeaderOverin").html($(this).attr("data-title"));$(".privacybuttonsOver").css("left",d+"px");$(".privacybuttonsOver").css("top",e+"px");$(".privacybuttonsOver").stop().show()});$(document).on("mouseout",".privacy_icon_glob",function(){$(".privacybuttonsOver").hide()});$(document).on("click",".item_details, .item_img_container, .item_actions",function(){$("#expand_div").hide();$(".itemList").removeClass("selected");$(this).parent().addClass("selected");journal_selected=$(this).closest(".itemList");$(".img_overlay_border").hide();$(this).parent().find(".img_overlay_border").show();var c=$(this).parent().offset().top-$(this).parent().parent().offset().top;jscrollpane_apiJ.scrollToY(c,true);if($(this).parent().attr("data-shares-comments")==1){$(".btn_comments").show();$(".btn_txt_comments").show();$(".btn_shares").show();$(".btn_txt_shares").show()}else{$(".btn_comments").hide();$(".btn_txt_comments").hide();$(".btn_shares").hide();$(".btn_txt_shares").hide()}$(".social_data_all").attr("data-id",$(this).parent().attr("data-id"));var b=$(".social_data_all").attr("data-id");$("#edit_add_photos_link").attr("href",ReturnLink("/upload-journal/id/"+b));initLikes($(".social_data_all"));initComments($(".social_data_all"));initShares($(".social_data_all"));$("#description").removeClass("selected");$("#description").click()});$(document).on("mouseover",".item_img_container",function(){$(this).find(".img_overlay").show()});$(document).on("mouseout",".item_img_container",function(){$(this).find(".img_overlay").hide()});$("#add_journal_icon").mouseover(function(){$("#add_journal_help").show()});$("#add_journal_icon").mouseout(function(){$("#add_journal_help").hide()});$(".item_built_img").mouseover(function(){var b=$(this).attr("src");$(this).attr("src",b.substr(0,b.length-9)+"_yellow.png")});$(".item_built_img").mouseout(function(){var b=$(this).attr("src");$(this).attr("src",b.substr(0,b.length-11)+"_grey.png")});$("#privacy_down_arrow").click(function(){$("#privacy_text").toggle();$("#hide_text").toggle()});$(document).on("click",".topArrow",function(){if($(".top_buttons_container").css("display")!="none"){$(".top_buttons_container").hide()}else{$(".top_buttons_container").show()}});$(document).on("click",".overdatabutenable",function(){var b=$(this);var c=$(".social_data_all").attr("data-id");if(String(""+b.attr("data-status"))=="1"){editJournalDetails($(".social_data_all"),"sharescomments");b.attr("data-status","0");b.find(".overdatabutntficon").addClass("inactive");$(".btn_comments").hide();$(".btn_txt_comments").hide();$(".btn_shares").hide();$(".btn_txt_shares").hide();$("#item_"+c).attr("data-shares-comments",0)}else{editJournalDetails($(".social_data_all"),"sharescomments");b.attr("data-status","1");b.find(".overdatabutntficon").removeClass("inactive");$(".btn_comments").show();$(".btn_txt_comments").show();$(".btn_shares").show();$(".btn_txt_shares").show();$("#item_"+c).attr("data-shares-comments",1)}});$(document).on("click","#hide_button",function(){editJournalDetails($(".social_data_all"),"hide")});backup_html="";$(document).on("click","#remove_button",function(){backup_html=$(".editDiv").html();$(".editDiv").html("");$(".editDiv").append('<div class="closeDiv"></div>');$(".editDiv").append('<div class="delete_message">'+t("are you sure you want to remove<br />permanently this journal?<br /><br />this action cannot be undone.")+"</div>");$(".editDiv").append('<div class="edit_buttons" style="margin-top:25px;"><div id="button_delete" class="edit_button">'+t("confirm")+'</div><div class="yellow_separator"></div><div id="button_cancel" class="edit_button">'+t("cancel")+"</div></div>");$(".editDiv").append('<div style="height:485px;"></div>')});$(document).on("click","#button_delete",function(){editJournalDetails($(".social_data_all"),"delete")});$(document).on("click","#button_save",function(){var b=$(".social_data_all").attr("data-id");resetValue($(this).parent().parent().find("#edit_title"));resetValue($(this).parent().parent().find("#edit_description"));resetValue($(this).parent().parent().find("#edit_location"));resetValue($(this).parent().parent().find("#edit_country"));resetValue($(this).parent().parent().find("#edit_city"));resetValue($(this).parent().parent().find("#edit_keywords"));if(verifyForm("editDiv")){editJournalDetails($(".social_data_all"),"save")}});$(document).on("click","#button_cancel",function(){$(this).parent().parent().find(".closeDiv").click();if(backup_html!=""){$(".editDiv").html(backup_html)}});$(document).on("click","#journal_load_more",function(){initJournals()});$(document).on("click","#headbutinfo",function(){if(!$(this).hasClass("active")){$(this).addClass("active");$("#headbutinfocontent").animate({width:440+"px"},500)}});$(document).on("click","#headbutinfocontentclose",function(){$("#headbutinfocontent").animate({width:0+"px"},500);$("#headbutinfo").removeClass("active")});$(document).on("click",".item_img_container",function(){initExpandPanel($(".social_data_all"))});$(document).on("click","#expand_save_btn",function(){journal_items_order="";$(".images_container .img_box").each(function(c,b){journal_items_order+=$(this).attr("data-id")+","});journal_items_order=journal_items_order.substr(0,(journal_items_order.length-1));editJournalDetails($(".social_data_all"),"orderitems")});$(document).on("click","#expand_cancel_btn,#expand_container",function(){$("#expand_div,#expand_container").hide()});var a="";$(document).on("click","#edit_btn",function(){a=$(this).parent().parent().attr("data-id");objclicked=$(this).closest(".img_box")});$(document).on("click","#cancel_save_btn",function(){$(".fancybox-close").click()});$(document).on("click","#image_save_btn",function(){resetValue($(this).parent().parent().find("#image_title"));resetValue($(this).parent().parent().find("#image_description"));resetValue($(this).parent().parent().find("#image_keywords"));resetValue($(this).parent().parent().find("#image_location"));editJournalItem(a,"edit")});$(document).on("click","#delete_btn",function(){a=$(this).parent().parent().attr("data-id");editJournalItem(a,"delete")});$("#edit_btn").fancybox({padding:0,margin:0,beforeLoad:function(){$("#fancy_edit_item").html("");var b='<div class="edit_image">';b+='<div class="left_side"><div class="edit_image_label">'+t("title")+'</div><input type="text" id="image_title" class="edit_image_textfield" value="'+t("title...")+'" onblur="addValue2(this)" onfocus="removeValue2(this)" data-value="'+t("title...")+'" /><div class="edit_image_label">'+t("description")+'</div><textarea id="image_description" class="edit_image_textarea" value="'+t("description...")+'" onblur="addValue2(this)" onfocus="removeValue2(this)" data-value="'+t("description...")+'"></textarea></div>';b+='<div class="right_side"><div class="edit_image_label">'+t("keywords")+' <span class="details_span">'+t("e.g. nature, restaurant, food)")+'(</span></div><input type="text" id="image_keywords" class="edit_image_textfield" value="'+t("keywords...")+'" onblur="addValue2(this)" onfocus="removeValue2(this)" data-value="'+t("keywords...")+'" /><div class="edit_image_label">'+t("place taken at")+'</div><input type="text" id="image_location" class="edit_image_textfield" value="'+t("place taken at...")+'" onblur="addValue2(this)" onfocus="removeValue2(this)" data-value="'+t("place taken at...")+'" /></div>';b+='<div class="set_icon_container"><div id="setIconBox" class="uploadinfocheckbox_upload"><div class="uploadinfocheckboxpic"></div><div class="uploadinfocheckboxtxt">'+t("set as icon for the journal")+"</div></div></div>";b+='<div class="save_icons_container"><div id="image_save_btn" class="save_btn"></div><div id="cancel_save_btn" class="cancel_btn"></div></div>';b+="</div>";$("#fancy_edit_item").html(b);$.ajax({url:ReturnLink("/ajax/ajax_journal_item_details.php"),data:{item_id:a},type:"post",success:function(c){var m=null;try{m=$.parseJSON(c)}catch(e){$(".upload-overlay-loading-fix").hide();return}if(m.error){TTAlert({msg:m.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}else{var l=m.name;var h=m.journal_id;var f=m.item_desc;var g=m.item_order;var d=m.default_pic;var k=m.location_name;var j=m.keywords;$("#image_title").val(l);$("#image_description").val(f);$("#image_keywords").val(j);$("#image_location").val(k);if(d==1){$("#setIconBox").addClass("active")}$("#image_title").blur();$("#image_description").blur();$("#image_keywords").blur();$("#image_location").blur()}}})},afterLoad:function(){}});initResetSelectedUsers($("#addmoretext_privacy"));$("#privacy_select").change(function(){var b=parseInt($(this).val());if(b==5){$(this).parent().find(".privacy_picker").removeClass("displaynone")}else{initResetSelectedUsers($(this).parent().find(".addmore input"));$(this).parent().find(".uploadinfocheckbox_upload").removeClass("active");$(this).parent().find(".addmore input").val("");$(this).parent().find(".addmore input").blur();$(this).parent().find(".peoplesdata").each(function(){var c=$(this);c.remove()});$(this).parent().find(".privacy_picker").addClass("displaynone")}initResetIcon($(this).parent().find(".privacy_icon"));$(this).parent().find(".privacy_icon").addClass("privacy_icon"+b)});$("#privacy_select").change();$("#privacy_close_button").click(function(){$("#privacy_box").hide()});$("#privacy_text").click(function(){$("#privacy_box").show()});$(document).on("click","#report_journal_close, #report_journal_button_cancel",function(){$("#report_journal").hide()});$(document).on("click","#report_journal_button_report",function(){$("#report_journal_report_message").show();$("#report_journal_button_ok").show()});$(document).on("click","#report_journal_button_ok",function(){$("#report_journal").hide()});$(document).on("click","#template1_icon",function(){$("#template1_icon").addClass("template1_icon_active");$("#template2_icon").removeClass("template2_icon_active")});$(document).on("click","#template2_icon",function(){$("#template2_icon").addClass("template2_icon_active");$("#template1_icon").removeClass("template1_icon_active")});$(document).on("mouseover","#template1_icon",function(){$("#template1_popup").show()});$(document).on("mouseout","#template1_icon",function(){$("#template1_popup").hide()});$(document).on("mouseover","#template2_icon",function(){$("#template2_popup").show()});$(document).on("mouseout","#template2_icon",function(){$("#template2_popup").hide()});$(document).on("click","#hide_text",function(){var b=$(".social_data_all").attr("data-id");var e=$("#item_"+b);var d=e.index();if(d==0){d=1}else{d=d-1}var c=$(".body_item_list").eq(d);e.remove();c.find(".item_details").click();if($(".item_details")){$(".item_details").click()}else{$(".item_details").first().click()}});$("#searchCalendarbut").click(function(){if($("#fromtxt").html()!=""||$("#totxt").html()!=""){fr_txt=""+$("#fromtxt").attr("data-cal");to_txt=""+$("#totxt").attr("data-cal");currentpage=0;$(".list_container").attr("data-skip",0);$(".list_container").html("");initJournals(1)}});$(document).on("click",".uploadinfocheckbox_upload",function(){if($(this).hasClass("active")){$(this).removeClass("active");if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friendsdata").remove()}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friends_of_friends_data").remove()}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#followersdata").remove()}}}}}else{if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){var c='<div class="peoplesdata formttl13" id="friendsdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(c)}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){var b='<div class="peoplesdata formttl13" id="friends_of_friends_data" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends of friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(b)}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){var b='<div class="peoplesdata formttl13" id="followersdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("followers")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(b)}}}}$(this).addClass("active")}});$(document).on("click",".privacyclass",function(){privacyValue=$(".privacy_menu").find(".privacyclass.active").attr("data-value");$(".privacyclass",$(this).parent().parent()).removeClass("active");$(this).addClass("active");var c=parseInt($(this).attr("data-value"));var b=$(this).parent().parent().parent();$(".uploadinfomandatory span",b).html("");switch(c){case USER_PRIVACY_PRIVATE:initResetSelectedUsers($(this).closest(".editDiv").find(".peoplecontainer_custom"));$(".uploadinfomandatory",b).addClass("inactive");$(".uploadinfomandatorytitle",b).removeClass("inactive");break;case USER_PRIVACY_SELECTED:$(".peoplecontainer_custom").show();$(".uploadinfomandatory",b).addClass("inactive");$(".uploadinfomandatorytitle",b).removeClass("inactive");$(".uploadinfomandatorycategory",b).removeClass("inactive");$(".uploadinfomandatorycountry",b).removeClass("inactive");$(".uploadinfomandatorycitynameaccent",b).removeClass("inactive");saveCustomPrivacy();resetSelectedUsers($("#addmoretext_custum_privacy_detailed"));$(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){if($(this).attr("data-id")!=""){SelectedUsersAdd($(this).attr("data-id"),$("#addmoretext_custum_privacy_detailed"))}});break;default:initResetSelectedUsers($(this).closest(".editDiv").find(".peoplecontainer_custom"));$(".uploadinfomandatory",b).addClass("inactive");$(".uploadinfomandatorytitle",b).removeClass("inactive");$(".uploadinfomandatorycategory",b).removeClass("inactive");$(".uploadinfomandatorycountry",b).removeClass("inactive");$(".uploadinfomandatorycitynameaccent",b).removeClass("inactive");break}});$(document).on("click","#cancel_custom_privacy",function(){$(".peoplecontainer_custom").hide();resetCustomPrivacy()});$(document).on("click","#okeventdata",function(){$(".peoplecontainer_custom").hide()});$(document).on("mouseover","#item_details",function(){$(this).find("#journal_hide_button").show()});$(document).on("mouseout","#item_details",function(){$(this).find("#journal_hide_button").hide()});$(document).on("click","#journal_hide_button",function(){$(this).parent().parent().hide()});$(".item_details").first().click()});function hideScrollBar(){if($("#body_div .itemList").size()<=8){$("#body_div .jspVerticalBar").hide()}}function showScrollBar(){if($("#body_div .itemList").size()<=8){$("#body_div .jspVerticalBar").show()}}function saveCustomPrivacy(){privacyArray=new Array();if(privacyValue==USER_PRIVACY_SELECTED){$(".privacy_menu").find(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){var a=$(this);if(a.attr("id")=="friendsdata"){privacyArray.push({friends:1})}else{if(a.attr("id")=="friends_of_friends_data"){privacyArray.push({friends_of_friends:1})}else{if(a.attr("id")=="followersdata"){privacyArray.push({followers:1})}else{if(parseInt(a.attr("data-id"))!=0){privacyArray.push({id:a.attr("data-id")});custom_privacy_names[a.attr("data-id")]=$(this).find(".peoplesdatainside").html()}}}}})}}function resetCustomPrivacy(){$(".emailcontainer").html(add_more_box);addmoreusersautocomplete_custom_journal($("#addmoretext_custum_privacy_detailed"));$(".uploadinfocheckbox4").removeClass("active");$(".uploadinfocheckbox_friends_of_friends").removeClass("active");$(".uploadinfocheckbox3").removeClass("active");for(i=0;i<privacyArray.length;i++){if(privacyArray[i]["followers"]&&privacyArray[i]["followers"]==1){$(".uploadinfocheckbox4").addClass("active");$(".emailcontainer").append(followers_box)}else{if(privacyArray[i]["friends_of_friends"]&&privacyArray[i]["friends_of_friends"]==1){$(".uploadinfocheckbox_friends_of_friends").addClass("active");$(".emailcontainer").append(friends_of_friends_box)}else{if(privacyArray[i]["friends"]&&privacyArray[i]["friends"]==1){$(".uploadinfocheckbox3").addClass("active");$(".emailcontainer").append(friends_box)}else{if(privacyArray[i]["id"]){var a=user_box.replace("%user_id%",privacyArray[i]["id"]);var a=a.replace("%username%",custom_privacy_names[privacyArray[i]["id"]]);$(".emailcontainer").append(a)}}}}}}function InitCalendar(){Calendar.setup({inputField:"fromtxt",noScroll:true,trigger:"frombutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());TO_CAL.args.min=a;TO_CAL.redraw();$("#fromtxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"});TO_CAL=Calendar.setup({inputField:"totxt",noScroll:true,trigger:"tobutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());$("#totxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"})}function addCalToEvent(a){if(new Date($("#fromtxt").attr("data-cal"))>new Date($("#totxt").attr("data-cal"))){$("#totxt").attr("data-cal",$("#fromtxt").attr("data-cal"));$("#totxt").val($("#fromtxt").val())}}function resetValue(a){if(a.attr("data-value")==a.val()){a.val("")}}function initResetIcon(a){a.removeClass("privacy_icon1");a.removeClass("privacy_icon2");a.removeClass("privacy_icon3");a.removeClass("privacy_icon4");a.removeClass("privacy_icon5")}function initResetSelectedUsers(a){resetSelectedUsers(a);resetSelectedChannels(a)}function initscrollPane(){$(".body_div").jScrollPane();jscrollpane_apiJ=$(".body_div").data("jsp")}function getJournalDetails(b){var a=b.attr("data-id");$.ajax({url:ReturnLink("/ajax/ajax_journal_details.php"),data:{journal_id:a},type:"post",success:function(h){var A=null;try{A=$.parseJSON(h)}catch(l){return}if(A.error){TTAlert({msg:A.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}else{var q=A.journal_name;var o=A.journal_desc;var p=A.journal_desc_init;var m=A.formatted_date;var s=A.location_name;var n=A.is_visible;var g=A.country;var c=A.city;var d=A.city_hidden_value;var f=A.city_hidden_valueid;var r=A.keywords;var k=A.enable_share_comment;var w=A.privacy_kind_type;var v=w;try{var x=w.split(",");if(x.length>1){v=USER_PRIVACY_SELECTED}}catch(j){var x=w}var y=A.privacy_users;var z=A.custom_privacy_users;$("#desc_timestamp").html(t("uploaded ")+m);$("#desc_journal_name").html(q);$("#desc_journal_location").html(s);$(".description_journal").html('<div class="scrollpane_description_journal" style="max-height:405px; float: left; width:255px;"><div class="albumdesc albumdesc_journal">'+o+"</div></div>");var u=$(".privacy_iconDiv");u.removeClass("privacy_icon0");u.removeClass("privacy_icon1");u.removeClass("privacy_icon2");u.removeClass("privacy_icon3");u.removeClass("privacy_icon4");u.removeClass("privacy_icon5");u.attr("data-title",A.privacy_kind_str);u.addClass("privacy_icon"+v);$("#edit_title").attr("value","");$("#edit_description").attr("value","");$("#edit_location").attr("value","");$("#edit_title").attr("value",q);$("#edit_description").attr("value",p);$("#edit_location").attr("value",s);$("#edit_country").attr("value",g);$("#edit_city_text").attr("value",c);$("#edit_city_text_cityname").attr("value",d);$("#edit_city_text_cityname").attr("data-id",f);$("#edit_keywords").attr("value",r);$("#edit_title").blur();$("#edit_description").blur();$("#edit_location").blur();$("#privacyclass_user0").removeClass("active");$("#privacyclass_user1").removeClass("active");$("#privacyclass_user2").removeClass("active");$("#privacyclass_user3").removeClass("active");$("#privacyclass_user4").removeClass("active");$("#privacyclass_user5").removeClass("active");if(parseInt(is_owner)==1){$(".emailcontainer").html(add_more_box);addmoreusersautocomplete_custom_journal($("#addmoretext_custum_privacy_detailed"));$(".uploadinfocheckbox4").removeClass("active");$(".uploadinfocheckbox_friends_of_friends").removeClass("active");$(".uploadinfocheckbox3").removeClass("active")}if(parseInt(is_owner)==1&&(w.length>1||y.length>0)){$("#privacyclass_user4").addClass("active");$(".emailcontainer").html(add_more_box);addmoreusersautocomplete_custom_journal($("#addmoretext_custum_privacy_detailed"));if(x.indexOf("5")!=-1){$(".uploadinfocheckbox4").addClass("active");$(".emailcontainer").append(followers_box)}if(x.indexOf("3")!=-1){$(".uploadinfocheckbox_friends_of_friends").addClass("active");$(".emailcontainer").append(friends_of_friends_box)}if(x.indexOf("1")!=-1){$(".uploadinfocheckbox3").addClass("active");$(".emailcontainer").append(friends_box)}if(y!=""&&y!="undefined"){for(i=0;i<z.length;i++){var B=user_box.replace("%user_id%",z[i]["id"]);var B=B.replace("%username%",z[i]["FullName"]);$(".emailcontainer").append(B);custom_privacy_names[z[i]["id"]]=z[i]["FullName"]}}}else{$("#privacyclass_user"+w).addClass("active")}if(n==1){$("#hide_button").html(t("hide"))}else{$("#hide_button").html(t("unhide"))}if(k==1){$(".overdatabutenable").attr("data-status","1");$(".overdatabutntficon").removeClass("inactive")}else{$(".overdatabutenable").attr("data-status","0");$(".overdatabutntficon").addClass("inactive")}if($(".albumdesc_journal").height()>405){initscrollPaneSocial($(".scrollpane_description_journal"),false)}$(".privacyclass.active").click()}}})}function editJournalDetails(p,a){var l=p.attr("data-id");var q="";var k="";var j="";var g="";var e="";var d="";var b="";var c="";var f="";var h="";var o="";var n="0";var m="0";custom_privacy_kinds="";custom_privacy_users="";if(a=="sharescomments"){q=$(".overdatabutenable").attr("data-status")}else{if(a=="hide"){if($("#hide_button").html()=="hide"){k=0}else{k=1}}else{if(a=="save"){j=$("#edit_title").attr("value");g=$("#edit_location").attr("value");e=$("#edit_description").attr("value");d=$("#edit_country").attr("value");b=$("#edit_city_text_cityname").attr("value");c=$("#edit_city_text_cityname").attr("data-id");f=$("#edit_keywords").attr("value");h=$(".privacy_menu").find(".privacyclass.active").attr("data-value");if(h==4){$(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){if($(this).attr("data-id")!=""){custom_privacy_users+=$(this).attr("data-id")+","}else{if($(this).attr("id")=="followersdata"){custom_privacy_kinds+="5,"}else{if($(this).attr("id")=="friends_of_friends_data"){custom_privacy_kinds+="3,"}else{if($(this).attr("id")=="friendsdata"){custom_privacy_kinds+="1,"}}}}});if(custom_privacy_kinds.indexOf(",")!=-1){custom_privacy_kinds=custom_privacy_kinds.substr(0,custom_privacy_kinds.length-1)}if(custom_privacy_users.indexOf(",")!=-1){custom_privacy_users=custom_privacy_users.substr(0,custom_privacy_users.length-1)}if(custom_privacy_kinds!=""&&custom_privacy_kinds.indexOf(",")==-1&&custom_privacy_users==""){h=custom_privacy_kinds;custom_privacy_kinds=""}}}else{if(a=="delete"){}else{if(a=="orderitems"){if($("#template2_icon").hasClass("template2_icon_active")){o="1"}else{o="0"}if($("#savepdf").hasClass("active")){n="1"}if($("#publish3d").hasClass("active")){m="1"}}}}}}if(a!=""){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/ajax_journal_edit.php"),data:{journal_id:l,command:a,shares_and_comments:q,hide:k,edit_title:j,edit_location:g,edit_description:e,journal_items_order:journal_items_order,edit_country:d,edit_cityid:c,edit_city:b,edit_keywords:f,edit_privacy:h,cpk:custom_privacy_kinds,cpu:custom_privacy_users,journalTemplate:o,journalPdf:n,journalFlash3d:m},type:"post",success:function(r){var u=null;try{u=$.parseJSON(r)}catch(s){$(".upload-overlay-loading-fix").hide();return}if(u.error){$(".upload-overlay-loading-fix").hide();TTAlert({msg:u.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}else{$(".upload-overlay-loading-fix").hide();if(a=="delete"||a=="orderitems"){location.reload()}else{if(a=="orderitems"){$("#expand_cancel_btn").click()}}getJournalDetails($(".social_data_all"))}}})}}function editJournalItem(d,a){var g="";var c="";var e="";var f="";var b="";if(a=="edit"){g=$("#image_title").val();c=$("#image_description").val();e=$("#image_keywords").val();f=$("#image_location").val();if($("#setIconBox").hasClass("active")){b=1}else{b=0}}else{if(a=="delete"){}}if(a=="delete"){TTAlert({msg:t("confirm to remove selected photo from journal"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(h){if(h){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/ajax_journal_item_edit.php"),data:{command:a,item_id:d,name:g,item_desc:c,keywords:e,location_name:f,is_icon:b},type:"post",success:function(j){var l=null;try{l=$.parseJSON(j)}catch(k){$(".upload-overlay-loading-fix").hide();return}if(l.error){$(".upload-overlay-loading-fix").hide();TTAlert({msg:l.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}else{initExpandPanel($(".social_data_all"));$(".upload-overlay-loading-fix").hide()}}})}}})}else{if(a!=""){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/ajax_journal_item_edit.php"),data:{command:a,item_id:d,name:g,item_desc:c,keywords:e,location_name:f,is_icon:b},type:"post",success:function(h){var k=null;try{k=$.parseJSON(h)}catch(j){$(".upload-overlay-loading-fix").hide();return}if(k.error){$(".upload-overlay-loading-fix").hide();TTAlert({msg:k.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}else{$(".upload-overlay-loading-fix").hide();if(a=="edit"){if(objclicked!=""&&b==1&&journal_selected!=""){var l=objclicked.find(".img").attr("src");journal_selected.find(".item_image").attr("src",l)}$(".fancybox-close").click()}initExpandPanel($(".social_data_all"))}}})}}}function initJournals(a){if(!a){a=0}if(a==1){journals_page=0}else{journals_page++}var b=$("#hdata").attr("data-uid");$.ajax({url:ReturnLink("/ajax/ajax_journal_page.php"),data:{page:journals_page,uid:b,from_date:fr_txt,to_date:to_txt},type:"post",success:function(c){var g=null;try{g=$.parseJSON(c)}catch(e){return}if(g.error){TTAlert({msg:g.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{var f=g.data;var d=g.count;if(a==1){$("#body_data").html("")}if(a==1&&d>0){$("#body_data").html('<div class="newsverticalline"></div>')}$("#body_data").append(f);initscrollPane();hideScrollBar();if(d-journals_page*8>8){$(".buttonmorecontainer").show()}else{$(".buttonmorecontainer").hide()}$(".header_journals_count").html("("+d+")");if(a==1){$(".item_details").first().click()}if(d>0){$(".left_panel").show()}else{$(".left_panel").hide()}}}})}function initExpandPanel(b){var a=b.attr("data-id");$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/ajax_journal_expand.php"),data:{journal_id:a},type:"post",success:function(c){var g=null;try{g=$.parseJSON(c)}catch(e){$(".upload-overlay-loading-fix").hide();return}if(g.error){$(".upload-overlay-loading-fix").hide();TTAlert({msg:g.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}else{$(".upload-overlay-loading-fix").hide();var f=g.data;var d=g.count;$("#images_container").html("");$("#images_container").html(f);$("#expand_div,#expand_container").show();$(".images_container").sortable({cursor:"move"});$("#edit_add_photo_link").attr("href",ReturnLink("/upload-journal/id/"+a));$(".expand_div .body").jScrollPane()}}})}var _AutocompleteCities=null;function AutocompleteCitiesReset(){_AutocompleteCities=new Array()}function AutocompleteCitiesAdd(a){_AutocompleteCities.push(a)}function AutocompleteCitiesExists(a){if(_AutocompleteCities===null){return null}var b=removeDiacritics(a);for(var c=0;c<_AutocompleteCities.length;c++){if(b.toLowerCase()===_AutocompleteCities[c].value.toLowerCase()){return _AutocompleteCities[c]}}return null}function addAutoComplete(){var a=$("#edit_city_text");a.autocomplete({appendTo:"#MiddleInsideNormal",search:function(d,e){var b=$("select[name=country]",a.parent()).removeClass("err");var c=$("option:selected",b).val();if(c=="ZZ"){b.addClass("err");d.preventDefault()}else{a.autocomplete("option","source",ReturnLink("/ajax/uploadGetCities.php?cc="+c))}AutocompleteCitiesReset()},select:function(b,c){a.val(ucwords(c.item.value));$("input[name=cityname]",a.parent()).val(c.item.value);$("input[name=cityname]",a.parent()).attr("data-id",c.item.id);b.preventDefault()},change:function(b,d){if(!d.item){var c=AutocompleteCitiesExists(a.val());if(c===null){a.val("");return}a.val(ucwords(c.value));$("input[name=cityname]",a.parent()).val(c.value)}}}).keydown(function(c){var b=(c.keyCode?c.keyCode:c.which);if(AutocompleteCitiesExists(a.val())===null){$("input[name=cityname]",a.parent()).val("");$("input[name=cityname]",a.parent()).attr("data-id")}if(b===13||b===9){if(AutocompleteCitiesExists(a.val())===null){c.preventDefault();return}if(b===13){$(this).blur()}}}).data("ui-autocomplete")._renderItem=function(c,b){AutocompleteCitiesAdd(b);return $("<li></li>").data("item.autocomplete",b).append("<a>"+ucwords(b.value)+"</a>").appendTo(c)}}function verifyForm(d){var c=true;var a=$("#"+d);$(".uploadinfomandatory span",a).html("");$("input,select,textarea",a).removeClass("err").each(function(){var f=$(this).attr("name");var e=$(this).parent();if((f=="location")||(f=="location_name")||(f=="cityname")||(f=="status")||(f=="vid")||$(this).hasClass("filevalue")||(f=="filename")||(f=="addmoretext")||(f=="vpath")){}else{if(($(".uploadinfomandatory"+f,e).css("display")!="none"&&getObjectData($(this))=="")||(f=="country"&&!$(".uploadinfomandatorycountry",e).hasClass("inactive")&&$(this).val()=="0"&&$(".uploadinfomandatorycountry",e).length>0)){$(".uploadinfomandatory"+f+" span",e).html(t("please fill this field correctly"));c=false}}});var b=$("input[name=cityname]",a).parent();if(getObjectData($("input[name=cityname]",a))==""&&!$(".uploadinfomandatorycitynameaccent",b).hasClass("inactive")&&$("input[name=cityname]",a).length>0){$(".uploadinfomandatorycitynameaccent span",b).html(t("please fill this field correctly"));c=false}if(!c){TTAlert({msg:t("Please input mandatory fields"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return false}else{return true}};