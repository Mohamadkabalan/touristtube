(function(a){var b=function(){var y={},z,e=65,S,O='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',g={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},n=function(U,T){var V=x(U);a(T).data("colorpicker").fields.eq(1).val(V.r).end().eq(2).val(V.g).end().eq(3).val(V.b).end()},m=function(U,T){a(T).data("colorpicker").fields.eq(4).val(U.h).end().eq(5).val(U.s).end().eq(6).val(U.b).end()},l=function(U,T){a(T).data("colorpicker").fields.eq(0).val(w(U)).end()},M=function(U,T){a(T).data("colorpicker").selector.css("backgroundColor","#"+w({h:U.h,s:100,b:100}));a(T).data("colorpicker").selectorIndic.css({left:parseInt(150*U.s/100,10),top:parseInt(150*(100-U.b)/100,10)})},K=function(U,T){a(T).data("colorpicker").hue.css("top",parseInt(150-150*U.h/360,10))},J=function(U,T){a(T).data("colorpicker").currentColor.css("backgroundColor","#"+w(U))},L=function(U,T){a(T).data("colorpicker").newColor.css("backgroundColor","#"+w(U))},B=function(U){var V=U.charCode||U.keyCode||-1;if((V>e&&V<=90)||V==32){return false}var T=a(this).parent().parent();if(T.data("colorpicker").livePreview===true){d.apply(this)}},d=function(V){var T=a(this).parent().parent(),U;if(this.parentNode.className.indexOf("_hex")>0){T.data("colorpicker").color=U=t(o(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){T.data("colorpicker").color=U=p({h:parseInt(T.data("colorpicker").fields.eq(4).val(),10),s:parseInt(T.data("colorpicker").fields.eq(5).val(),10),b:parseInt(T.data("colorpicker").fields.eq(6).val(),10)})}else{T.data("colorpicker").color=U=I(q({r:parseInt(T.data("colorpicker").fields.eq(1).val(),10),g:parseInt(T.data("colorpicker").fields.eq(2).val(),10),b:parseInt(T.data("colorpicker").fields.eq(3).val(),10)}))}}if(V){n(U,T.get(0));l(U,T.get(0));m(U,T.get(0))}M(U,T.get(0));K(U,T.get(0));L(U,T.get(0));T.data("colorpicker").onChange.apply(T,[U,w(U),x(U)])},c=function(U){var T=a(this).parent().parent();T.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},r=function(){e=this.parentNode.className.indexOf("_hex")>0?70:65;a(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");a(this).parent().addClass("colorpicker_focus")},i=function(U){var V=a(this).parent().find("input").focus();var T={el:a(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:U.pageY,field:V,val:parseInt(V.val(),10),preview:a(this).parent().parent().data("colorpicker").livePreview};a(document).bind("mouseup",T,Q);a(document).bind("mousemove",T,E)},E=function(T){T.data.field.val(Math.max(0,Math.min(T.data.max,parseInt(T.data.val+T.pageY-T.data.y,10))));if(T.data.preview){d.apply(T.data.field.get(0),[true])}return false},Q=function(T){d.apply(T.data.field.get(0),[true]);T.data.el.removeClass("colorpicker_slider").find("input").focus();a(document).unbind("mouseup",Q);a(document).unbind("mousemove",E);return false},h=function(U){var T={cal:a(this).parent(),y:a(this).offset().top};T.preview=T.cal.data("colorpicker").livePreview;a(document).bind("mouseup",T,P);a(document).bind("mousemove",T,D)},D=function(T){d.apply(T.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(T.pageY-T.data.y))))/150,10)).get(0),[T.data.preview]);return false},P=function(T){n(T.data.cal.data("colorpicker").color,T.data.cal.get(0));l(T.data.cal.data("colorpicker").color,T.data.cal.get(0));a(document).unbind("mouseup",P);a(document).unbind("mousemove",D);return false},j=function(U){var T={cal:a(this).parent(),pos:a(this).offset()};T.preview=T.cal.data("colorpicker").livePreview;a(document).bind("mouseup",T,R);a(document).bind("mousemove",T,F)},F=function(T){d.apply(T.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(T.pageY-T.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(T.pageX-T.data.pos.left))))/150,10)).get(0),[T.data.preview]);return false},R=function(T){n(T.data.cal.data("colorpicker").color,T.data.cal.get(0));l(T.data.cal.data("colorpicker").color,T.data.cal.get(0));a(document).unbind("mouseup",R);a(document).unbind("mousemove",F);return false},k=function(T){a(this).addClass("colorpicker_focus")},C=function(T){a(this).removeClass("colorpicker_focus")},f=function(V){var T=a(this).parent();var U=T.data("colorpicker").color;T.data("colorpicker").origColor=U;J(U,T.get(0));T.data("colorpicker").onSubmit(U,w(U),x(U),T.data("colorpicker").el)},N=function(U){var T=a("#"+a(this).data("colorpickerId"));T.data("colorpicker").onBeforeShow.apply(this,[T.get(0)]);var W=a(this).offset();var Y=s();var X=W.top+this.offsetHeight;var V=W.left;if(X+176>Y.t+Y.h){X-=this.offsetHeight+176}if(V+356>Y.l+Y.w){V-=356}T.css({left:V+"px",top:X+"px"});if(T.data("colorpicker").onShow.apply(this,[T.get(0)])!=false){T.show()}a(document).bind("mousedown",{cal:T},v);return false},v=function(T){if(!A(T.data.cal.get(0),T.target,T.data.cal.get(0))){if(T.data.cal.data("colorpicker").onHide.apply(this,[T.data.cal.get(0)])!=false){T.data.cal.hide()}a(document).unbind("mousedown",v)}},A=function(V,U,T){if(V==U){return true}if(V.contains){return V.contains(U)}if(V.compareDocumentPosition){return !!(V.compareDocumentPosition(U)&16)}var W=U.parentNode;while(W&&W!=T){if(W==V){return true}W=W.parentNode}return false},s=function(){var T=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(T?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(T?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(T?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(T?document.documentElement.clientHeight:document.body.clientHeight)}},p=function(T){return{h:Math.min(360,Math.max(0,T.h)),s:Math.min(100,Math.max(0,T.s)),b:Math.min(100,Math.max(0,T.b))}},q=function(T){return{r:Math.min(255,Math.max(0,T.r)),g:Math.min(255,Math.max(0,T.g)),b:Math.min(255,Math.max(0,T.b))}},o=function(T){var V=6-T.length;if(V>0){var W=[];for(var U=0;U<V;U++){W.push("0")}W.push(T);T=W.join("")}return T},u=function(T){var T=parseInt(((T.indexOf("#")>-1)?T.substring(1):T),16);return{r:T>>16,g:(T&65280)>>8,b:(T&255)}},t=function(T){return I(u(T))},I=function(X){var U={h:0,s:0,b:0};var W=Math.min(X.r,X.g,X.b);var V=Math.max(X.r,X.g,X.b);var T=V-W;U.b=V;if(V!=0){}U.s=V!=0?255*T/V:0;if(U.s!=0){if(X.r==V){U.h=(X.g-X.b)/T}else{if(X.g==V){U.h=2+(X.b-X.r)/T}else{U.h=4+(X.r-X.g)/T}}}else{U.h=-1}U.h*=60;if(U.h<0){U.h+=360}U.s*=100/255;U.b*=100/255;return U},x=function(U){var V={};var T=Math.round(U.h);var W=Math.round(U.s*255/100);var aa=Math.round(U.b*255/100);if(W==0){V.r=V.g=V.b=aa}else{var X=aa;var Y=(255-W)*aa/255;var Z=(X-Y)*(T%60)/60;if(T==360){T=0}if(T<60){V.r=X;V.b=Y;V.g=Y+Z}else{if(T<120){V.g=X;V.b=Y;V.r=X-Z}else{if(T<180){V.g=X;V.r=Y;V.b=Y+Z}else{if(T<240){V.b=X;V.r=Y;V.g=X-Z}else{if(T<300){V.b=X;V.g=Y;V.r=Y+Z}else{if(T<360){V.r=X;V.g=Y;V.b=X-Z}else{V.r=0;V.g=0;V.b=0}}}}}}}return{r:Math.round(V.r),g:Math.round(V.g),b:Math.round(V.b)}},H=function(U){var T=[U.r.toString(16),U.g.toString(16),U.b.toString(16)];a.each(T,function(V,W){if(W.length==1){T[V]="0"+W}});return T.join("")},w=function(T){return H(x(T))},G=function(){var T=a(this).parent();var U=T.data("colorpicker").origColor;T.data("colorpicker").color=U;n(U,T.get(0));l(U,T.get(0));m(U,T.get(0));M(U,T.get(0));K(U,T.get(0));L(U,T.get(0))};return{init:function(T){T=a.extend({},g,T||{});if(typeof T.color=="string"){T.color=t(T.color)}else{if(T.color.r!=undefined&&T.color.g!=undefined&&T.color.b!=undefined){T.color=I(T.color)}else{if(T.color.h!=undefined&&T.color.s!=undefined&&T.color.b!=undefined){T.color=p(T.color)}else{return this}}}return this.each(function(){if(!a(this).data("colorpickerId")){var W=a.extend({},T);W.origColor=T.color;var V="collorpicker_"+parseInt(Math.random()*1000);a(this).data("colorpickerId",V);var U=a(O).attr("id",V);if(W.flat){U.appendTo(this).show()}else{U.appendTo(document.body)}W.fields=U.find("input").bind("keyup",B).bind("change",d).bind("blur",c).bind("focus",r);U.find("span").bind("mousedown",i).end().find(">div.colorpicker_current_color").bind("click",G);W.selector=U.find("div.colorpicker_color").bind("mousedown",j);W.selectorIndic=W.selector.find("div div");W.el=this;W.hue=U.find("div.colorpicker_hue div");U.find("div.colorpicker_hue").bind("mousedown",h);W.newColor=U.find("div.colorpicker_new_color");W.currentColor=U.find("div.colorpicker_current_color");U.data("colorpicker",W);U.find("div.colorpicker_submit").bind("mouseenter",k).bind("mouseleave",C).bind("click",f);n(W.color,U.get(0));m(W.color,U.get(0));l(W.color,U.get(0));K(W.color,U.get(0));M(W.color,U.get(0));J(W.color,U.get(0));L(W.color,U.get(0));if(W.flat){U.css({position:"relative",display:"block"})}else{a(this).bind(W.eventName,N)}}})},showPicker:function(){return this.each(function(){if(a(this).data("colorpickerId")){N.apply(this)}})},hidePicker:function(){return this.each(function(){if(a(this).data("colorpickerId")){a("#"+a(this).data("colorpickerId")).hide()}})},setColor:function(T){if(typeof T=="string"){T=t(T)}else{if(T.r!=undefined&&T.g!=undefined&&T.b!=undefined){T=I(T)}else{if(T.h!=undefined&&T.s!=undefined&&T.b!=undefined){T=p(T)}else{return this}}}return this.each(function(){if(a(this).data("colorpickerId")){var U=a("#"+a(this).data("colorpickerId"));U.data("colorpicker").color=T;U.data("colorpicker").origColor=T;n(T,U.get(0));m(T,U.get(0));l(T,U.get(0));K(T,U.get(0));M(T,U.get(0));J(T,U.get(0));L(T,U.get(0))}})}}}();a.fn.extend({ColorPicker:b.init,ColorPickerHide:b.hidePicker,ColorPickerShow:b.showPicker,ColorPickerSetColor:b.setColor})})(jQuery);