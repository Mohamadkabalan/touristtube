var uploader=null;var requirements_met=true;var upload_started;function InitChannelUploader(c,b){uploader=new plupload.Uploader({runtimes:"html5,flash",button_browse_hover:true,max_file_size:b+"mb",container:"uploadContainer"+c,browse_button:"uploadBtn"+c,drop_element:"uploadDropDiv"+c,url:ReturnLink("/channel-upload-file.php"),flash_swf_url:ReturnLink("/js/plupload/plupload.flash.swf"),multi_selection:false,multipart_params:{channel_id:globchannelid,which_uploader:c,SID:$("#SID").val()},filters:[{title:"Image files",extensions:"jpg,gif,png,tiff,tif,bmp,jpeg"},],init:a});uploader.bind("Init",function(e,d){if((d.runtime=="flash")&&!swfobject.hasFlashPlayerVersion("10")){requirements_met=false;TTAlert({msg:t("Please update your flash installation to at least version 10"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}});uploader.init();function a(d){d.bind("FilesAdded",function(f,e){f.settings.multipart_params={channel_id:globchannelid,which_uploader:c,SID:$("#SID").val()};if(!requirements_met){TTAlert({msg:t("Please update your flash installation to at least version 10"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return false}setTimeout(function(){d.start()},100);$.each(e,function(j,h){var g=h.id;$(".upload-overlay-loading-fix").show()})});d.bind("UploadFile",function(g,f){var e=f.id;upload_started=1;$(".upload-overlay-loading-fix").show()});d.bind("UploadProgress",function(g,f){var e=f.id});d.bind("Error",function(f,e){$(".upload-overlay-loading-fix").hide();if(e.code==-600){TTAlert({msg:e.message+"<br/>maximum size: "+b+"mb",type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{if(e.file&&e.file.name){TTAlert({msg:t("Error: ")+e.file.name+" "+e.message,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{TTAlert({msg:t("Error: ")+e.message,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}}d.refresh()});d.bind("FileUploaded",function(p,i,o){$(".upload-overlay-loading-fix").hide();upload_started=0;var h=i.id;var k;try{k=$.parseJSON(o.response)}catch(g){return}if(k.status!=="ok"){TTAlert({msg:k.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{if(parseInt(k.which_uploader)!=3){$("#picfancyboxbutton").fancybox({padding:0,margin:0,width:k.stanwidth,height:k.stanheight,transitionIn:"none",transitionOut:"none",autoSize:true,type:"iframe"});$("#picfancyboxbutton").attr("href",ReturnLink("/ajax/channel-fancy.php?path="+k.path+"&name="+k.name+"&type="+k.which_uploader+"&h="+k.stanheight));$("#picfancyboxbutton").click()}else{var q=400/k.width;var j=225/k.height;var f=q;if(j<q){f=j}var m=(400-Math.round(f*k.width))/2;var n=(225-Math.round(f*k.height))/2;$("#uploadDropDiv"+k.which_uploader+" .ImageStanInside").attr("data-color","");$("#uploadDropDiv"+k.which_uploader+" .ImageStanInside").css("background-color","#ffffff");var e=ReturnLink("/"+k.path+""+k.name);var l='<img src="'+e+"?x="+Math.random()+'" style="top:'+n+"px; left:"+m+'px;"/>';updateImage("#uploadDropDiv"+k.which_uploader+" .ImageStanInside",l,k.name)}}})}}function setImagesChannelUp(){InitChannelUploader(1,15);InitChannelUploader(2,15);InitChannelUploader(3,15)};