var currentpage=0;var fr_txt="";var to_txt="";var TO_CAL;var itempressed;var jscrollpane_apiB=null;function initscrollPane(){$(".scrollpane").jScrollPane();jscrollpane_apiB=$(".scrollpane").data("jsp")}function addCalTo(a){if(new Date($("#fromtxt").attr("data-cal"))>new Date($("#totxt").attr("data-cal"))){$("#totxt").attr("data-cal",$("#fromtxt").attr("data-cal"));$("#totxt").html($("#fromtxt").html())}}function InitDocument(){$(".channelevtTime").on("click",function(){var a=$(this).parent();if(itempressed==a){return}$("#commentDiv .shadow").each(function(e,d){if(!$(this).hasClass("hide")){$(this).find(".closeDiv").click()}});$(".disabledmessage").addClass("displaynone");$(".meStanDiv").addClass("displaynone");$(".notsigned").val("");$(".notsigned").blur();currentpage_like=0;$(".social_data_all").attr("data-page-like",0);currentpage_comments=0;$(".social_data_all").attr("data-page-comments",0);currentpage_shares=0;$(".social_data_all").attr("data-page-shares",0);if(itempressed!=""){itempressed.find(".butEditChannelRight_data").attr("id","edit_brochure_");itempressed.find(".butEditChannelRight_data").addClass("displaynone");$(".plupload.html5").remove();itempressed.find(".edit_brochuretitle_buts1").click()}$(".social_data_all").attr("data-id",a.attr("data-id"));$(".itemList").removeClass("selected");a.addClass("selected");a.find(".butEditChannelRight_data").removeClass("displaynone");if(parseInt(is_owner)==1){a.find(".butEditChannelRight_data").attr("id","edit_brochure_"+a.attr("data-id"));InitChannelUploaderHome(a.find(".butEditChannelRight_data").attr("id"),"brochure_content",15,0)}var c=a.offset().top-a.parent().offset().top;if(jscrollpane_apiB!=null){jscrollpane_apiB.scrollToY(c,true)}if(a.index()>0){showScrollBar()}else{hideScrollBar()}initLikes($(".social_data_all"));if(parseInt(a.attr("data-enable"))==1||parseInt(is_owner)==1){$(".btn_enabled").show();initComments($(".social_data_all"));initShares($(".social_data_all"))}else{$(".btn_enabled").hide()}var b=parseInt(a.attr("data-enable"));if(b==0){$(".overdatabutenablebrochure").attr("data-status",0);$(".overdatabutenablebrochure .overdatabutntficon").addClass("inactive")}else{$(".overdatabutenablebrochure").attr("data-status",1);$(".overdatabutenablebrochure .overdatabutntficon").removeClass("inactive")}$(".top_button").removeClass("active");itempressed=a})}function InitCalendar(){if($("#fromtxt").length>0){Calendar.setup({inputField:"fromtxt",noScroll:true,trigger:"frombutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());TO_CAL.args.min=a;TO_CAL.redraw();$("#fromtxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalTo(this);this.hide()},disabled:function(b){var a=new Date();a.setHours(12,30,0,0);return(b>a)},dateFormat:"%d / %m / %Y"});TO_CAL=Calendar.setup({inputField:"totxt",noScroll:true,trigger:"tobutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());$("#totxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalTo(this);this.hide()},disabled:function(b){var a=new Date();a.setHours(12,30,0,0);return(b>a)},dateFormat:"%d / %m / %Y"})}}function hideScrollBar(){}function showScrollBar(){if($("#brochure_content .itemList").size()<=7){$("#brochure_content .jspVerticalBar").show()}}$(document).ready(function(){InitCalendar();InitDocument();initscrollPane();hideScrollBar();initSocialFunctions();initReportFunctions($("#report_button"));$("#searchCalendarbut").click(function(){if($("#fromtxt").html()!=""||$("#totxt").html()!=""){fr_txt=""+$("#fromtxt").attr("data-cal");to_txt=""+$("#totxt").attr("data-cal");currentpage=0;$(".newsList .newsAll .newsAll_inside").html("");getBrochuresDataRelated()}});$(".newsList .itemList").first().find(".channelevtTime").click();$(".more").toggle(function(){$(this).text("< less").siblings(".teaser").hide().siblings(".complete").show();initscrollPane()},function(){$(this).text("> more").siblings(".teaser").show().siblings(".complete").hide();initscrollPane()});$(".loadmorebrochure").click(function(a){a.preventDefault();a.stopImmediatePropagation();currentpage++;getBrochuresDataRelated()});$(document).on("click",".topArrow",function(){if($(".top_buttons_container").css("display")!="none"){$(".top_buttons_container").hide()}else{$(".top_buttons_container").show()}});$(document).on("click","#hide_button",function(){if(itempressed!=""){updatebrochurepagedata("is_visible",0,itempressed.attr("data-id"),itempressed)}});$(document).on("click","#hide_buttonviewer",function(){if(itempressed!=""){itempressed.remove();$(".newsAll_inside .itemList").first().find(".channelevtTime").click();if($(".loadmorebrochure").css("display")!="none"){$(".loadmorebrochure").click()}else{initscrollPane()}}});$(document).on("click","#edit_button",function(){if(itempressed!=""){$(this).addClass("active");getbrochurepagedata(itempressed)}});$(document).on("click","#remove_button",function(){if(itempressed!=""){removebrochure(itempressed)}});$(document).on("click",".edit_brochuretitle_buts1",function(){$(".top_button").removeClass("active");$(this).parent().parent().hide()});$(document).on("click",".edit_brochuretitle_buts2",function(){var b=$(this).parent().parent();var c=b.find("#edit_brochuretitle_txt").val();if(!c.length){return}var d=c.replace(/\n/g," ");var a=b.parent();updatebrochurepagedata("name",d,a.attr("data-id"),a)});$(document).on("click",".hideText",function(){var a=$(this).parent().parent();updatebrochurepagedata("is_visible",1,a.attr("data-id"),a)});$(document).on("click",".overdatabutenablebrochure",function(){var a=$(this);if(String(""+a.attr("data-status"))=="1"){if(itempressed!=""){enableSharesComments_brochure(itempressed,0)}a.attr("data-status","0");a.find(".overdatabutntficon").addClass("inactive")}else{if(itempressed!=""){enableSharesComments_brochure(itempressed,1)}a.attr("data-status","1");a.find(".overdatabutntficon").removeClass("inactive")}})});function getBrochuresDataRelated(){$(".upload-overlay-loading-fix").show();$.post(ReturnLink("/ajax/ajax_loadmorebrochure.php"),{txt_srch_init:txt_srch_init,globchannelid:channelGlobalID(),currentpage:currentpage,frtxt:fr_txt,totxt:to_txt},function(b){if(b!=false){$(".newsList .newsAll .newsAll_inside").append(b);var a=$(".newsList .currPageStatus");var d=""+a.attr("data-value");var c=""+a.attr("data-count");if(d=="0"){$(".loadmorebrochure").hide()}else{$(".loadmorebrochure").show()}if(c=="0"){$(".social_data_all").hide();$(".newsverticalline").hide()}else{$(".social_data_all").show();$(".newsverticalline").show()}$("#newsContainer .ttl span.channelyellowevtttl").html("("+a.attr("data-count")+")");a.remove();initscrollPane();InitDocument()}else{$(".loadmorebrochure").hide()}$(".upload-overlay-loading-fix").hide()})}function updateImage(c,b,a){if(a=="editChannelRight_data10"){if(itempressed!=""){itempressed.find(".channelevtImg img").remove();itempressed.find(".channelevtImg").append(c);updatebrochurepagedata("photo",b,itempressed.attr("data-id"),itempressed)}}closeFancyBox()}function updatebrochurepagedata(c,d,a,b){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_brochure_update.php"),data:{globchannelid:channelGlobalID(),str:c,data:d,id:a},type:"post",success:function(e){if(c=="name"){b.find(".brochureName").html(d);b.find(".edit_brochuretitle_buts1").click()}else{if(c=="is_visible"){if(parseInt(d)==0){b.find(".hideitems").removeClass("displaynone");b.addClass("inactive");b.find(".edit_brochuretitle_buts1").click()}else{b.find(".hideitems").addClass("displaynone");b.removeClass("inactive")}}}$(".upload-overlay-loading-fix").hide()}})}function getbrochurepagedata(a){$(".upload-overlay-loading-fix").show();var b=a.attr("data-id");$.ajax({url:ReturnLink("/ajax/info_brochure_title.php"),data:{globchannelid:channelGlobalID(),data:b},type:"post",success:function(c){if(c){a.find("#edit_brochuretitle_container #edit_brochuretitle_txt").val(c);a.find("#edit_brochuretitle_container").show();a.addClass("inactive")}$(".upload-overlay-loading-fix").hide()}})}function removebrochure(b){var a=b.attr("data-id");TTAlert({msg:t("confirm to remove selected brochure"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(c){if(c){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_brochure_remove.php"),data:{globchannelid:channelGlobalID(),id:a},type:"post",success:function(d){if(d){var g=b.index();if(g==0){g=1}else{g=g-1}var f=$(".newsAll_inside .itemList").eq(g);b.remove();initscrollPane();f.find(".channelevtTime").click()}$(".upload-overlay-loading-fix").hide()}})}}})}function enableSharesComments_brochure(a,b){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_brochure_update.php"),data:{globchannelid:channelGlobalID(),str:"enable_share_comment",data:b,id:a.attr("data-id")},type:"post",success:function(c){a.attr("data-enable",b);$(".upload-overlay-loading-fix").hide()}})};