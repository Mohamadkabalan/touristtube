(function(a){a.widget("ui.textareainputsupport",a.ui.autocomplete.prototype);a.extend(a.ui.textareainputsupport.prototype,{search:function(g,f){g=g!=null?g:b(this.element).text;if(g.length<this.options.minLength){return this.close(f)}clearTimeout(this.closing);if(this._trigger("search")===false){return undefined}return this._search(g)},_initSource:function(){var f,g;if(a.isArray(this.options.source)){f=this.options.source;this.source=function(l,m){var j=a(this.element).val().split(" ");var h=this.options.source.clone();for(var k=0;k<h.length;k++){if(j.elementExists(h[k])){h.remove(k);k--}}m(a.ui.textareainputsupport.filter(h,l.term))}}else{if(typeof this.options.source==="string"){g=this.options.source;this.source=function(h,i){a.getJSON(g,h,i)}}else{this.source=this.options.source}}},_create:function(){var g=this,f=this.element[0].ownerDocument;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",g.keydownFunc(g)).bind("focus.autocomplete",function(){if(g.options.disabled){return}g.selectedItem=null;g.previous=g.element.val()}).bind("blur.autocomplete",function(h){if(g.options.disabled){return}clearTimeout(g.searching);g.closing=setTimeout(function(){g.close(h);g._change(h)},150)});this._initSource();this.response=function(){return g._response.apply(g,arguments)};this.valueMethod=function(){};this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo||"body",f)[0]).mousedown(function(h){var i=g.menu.element[0];if(h.target===i){setTimeout(function(){a(document).on("mousedown",function(j){if(j.target!==g.element[0]&&j.target!==i&&!a.ui.contains(i,j.target)){g.close()}})},1)}setTimeout(function(){clearTimeout(g.closing)},13)}).menu(this.menuOpt(g,f)).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("ui-menu");this.liveRegion=a("",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element);if(a.fn.bgiframe){this.menu.element.bgiframe()}},keydownFunc:function(f){return function(g){if(f.options.disabled){return}var h=a.ui.keyCode;switch(g.keyCode){case h.PAGE_UP:f._move("previousPage",g);break;case h.PAGE_DOWN:f._move("nextPage",g);break;case h.UP:f._move("previous",g);g.preventDefault();break;case h.DOWN:f._move("next",g);g.preventDefault();break;case h.ENTER:case h.NUMPAD_ENTER:if(f.menu.element.is(":visible")){g.preventDefault()}case h.TAB:if(!f.menu.active){f._move("next",g)}f.menu.select(g);break;case h.ESCAPE:f.element.val(f.term);f.close(g);break;default:clearTimeout(f.searching);f.searching=setTimeout(function(){if(f.term!=f.element.val()){f.selectedItem=null;f.search(null,g)}},f.options.delay);break}}},menuOpt:function(g,f){return{focus:function(h,j){return false;var i=j.item.data("ui-autocomplete-item");if(false!==g._trigger("focus",null,{item:i})){if(/^key/.test(h.originalEvent.type)){g.element.val(i.value)}}},select:function(i,l){var j=l.item.data("ui-autocomplete-item"),k=g.previous;var h=l.item.index();if(g.element[0]!==f.activeElement){g.element.focus();g.previous=k}if(false!==g._trigger("select",i,{item:j})){g.element.val(j.value)}g.close(i);g.selectedItem=j;g.currentIndex=h;if(g.options.onselect){g.options.onselect(g,j)}},blur:function(h,i){return false;if(g.menu.element.is(":visible")&&(g.element.val()!==g.term)){g.element.val(g.term)}}}}});a.extend(a.ui.textareainputsupport,{escapeRegex:function(f){return f.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(f,g){return e(f,g)}});a.extend(a.ui.textareainputsupport.prototype.options,{select:function(g,i){var f=b(this);a(this).setSelection(f.start,f.end);if(!i.item){return false}if(a(this).val().indexOf(i.item.value)==-1){a(this).replaceSelectedText(i.item.value+" ")}else{var h=a(this).val().substr(f.start,f.end-f.start);if(h!=i.item.value){a(this).replaceSelectedText("")}else{a(this).replaceSelectedText(i.item.value+" ")}}return false},focus:function(f,i){return false;var g=a(this).getSelection();var h=b(this);a(this).setSelection(h.start,h.end);a(this).replaceSelectedText(i.item.value);a(this).setSelection(g.start,h.start+i.item.value.length);return false}});function c(g){var f=["@","+"];d(f,g[0])}function d(f,g){var h=a.grep(f,function(k,j){return(k==g)});return h.length>0}a.getPositionWord=function(m,j){var l,g;var f=[" "," ","\n"];for(var h=j;h>=0;h--){var k=d(f,m[h-1]);if(k){break}l=h-1;l=l>0?l:0}for(h=j;h<=m.length;h++){g=h;if(d(f,m[h])){break}}return{start:l,end:g,text:m.slice(l,g)}};function b(g){var f=a(g);var i=f.getSelection();var j=f.val();var h=a.getPositionWord(j,i.start);return h}function e(f,h){var g=RegExp("^"+h,"i");return a.grep(f,function(k,j){return g.test(k)})}})(jQuery);