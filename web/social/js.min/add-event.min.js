$(document).ready(function(){InitChannelUploaderHome("TT_uploadBtnevent","formContainersubaddid",15,1);addmoreusersautocomplete_custom_journal($("#addmoretext"));$("#defaultEntry").timeEntry({show24Hours:true});$("#defaultEntry").val(getCurrentTime());$("#defaultEntryTo").timeEntry({show24Hours:true});$("#defaultEntryTo").val(getCurrentTime());Calendar.setup({inputField:"fromdate",noScroll:true,trigger:"fromdate",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());TO_CAL.args.min=a;TO_CAL.redraw();$("#fromdate").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"});TO_CAL=Calendar.setup({inputField:"todate",noScroll:true,trigger:"todate",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());$("#todate").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"});$(document).on("click",".uploadinfocheckbox",function(){if($(this).hasClass("active")){$(this).removeClass("active");if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friendsdata").remove()}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friends_of_friends_data").remove()}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#followersdata").remove()}}}}}else{if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){var b='<div class="peoplesdata formttl13" id="friendsdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(b)}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){var a='<div class="peoplesdata formttl13" id="friends_of_friends_data" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends of friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(a)}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){var a='<div class="peoplesdata formttl13" id="followersdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("followers")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(a)}}}}$(this).addClass("active")}});$(document).on("click",".privacyclass",function(){$(".privacyclass").removeClass("active");$(this).addClass("active");var a=parseInt($(this).attr("data-value"));if(a==USER_PRIVACY_SELECTED){$(".peoplecontainer").removeClass("displaynone")}else{$(".peoplecontainer").addClass("displaynone")}});$(document).on("click",".peoplesdataclose",function(){var a=$(this).parent();var b=a.parent().parent();a.remove();if(a.attr("data-id")!=""){SelectedUsersDelete(a.attr("data-id"),b.find(".addmore input"))}if(a.attr("id")=="friendsdata"){b.find(".uploadinfocheckbox3").removeClass("active")}else{if(a.attr("id")=="friends_of_friends_data"){b.find(".uploadinfocheckbox_friends_of_friends").removeClass("active")}else{if(a.attr("id")=="followersdata"){b.find(".uploadinfocheckbox4").removeClass("active")}}}});$(document).on("click","#event_buts_save",function(){var b=$(this).parent().parent();var n=getObjectData(b.find("#nameevents"));var i=getObjectData(b.find("#descriptionevent"));var m=getObjectData(b.find("#locationevent"));var f=b.find("#locationevent").attr("data-location");var c=b.find("#locationevent").attr("data-country");var e=b.find("#locationevent").attr("data-lng");var d=b.find("#locationevent").attr("data-lat");var k=getObjectData(b.find("#fromdate"));var g=b.find("#defaultEntry").val();var u=getObjectData(b.find("#todate"));var h=b.find("#defaultEntryTo").val();var s=b.find(".themephotoStanInside").attr("data-value");var l=b.find("#guestevent").val();var r=b.find("#themelist").val();var q=(b.find(".uploadinfocheckbox_event1").hasClass("active"))?1:0;var a=(b.find(".uploadinfocheckbox_event2").hasClass("active"))?1:0;var j=(b.find(".uploadinfocheckbox_event3").hasClass("active"))?1:0;var p=b.find(".privacyclass.active").attr("data-value");var o=new Array();if(p==USER_PRIVACY_SELECTED){b.find(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){var v=$(this);if(v.attr("id")=="friendsdata"){o.push({friends:1})}else{if(v.attr("id")=="friends_of_friends_data"){o.push({friends_of_friends:1})}else{if(v.attr("id")=="followersdata"){o.push({followers:1})}else{if(parseInt(v.attr("data-id"))!=0){o.push({id:v.attr("data-id")})}}}}})}if(checkEventInfo_Add(n,i,m,k,u,g,h,e,d,f,b)){if((p==USER_PRIVACY_SELECTED&&o.length>0)||p!=USER_PRIVACY_SELECTED){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_event_manage_user.php"),data:{privacyValue:p,nameevents:n,descriptionevent:i,locationevent:m,data_country:c,fromdate:k,fromdatetime:g,todate:u,todatetime:h,themephotoStanInside:s,guestevent:l,caninvite:a,showguests:q,themelist:r,enablesharecomments:j,data_lng:e,data_lat:d,data_location:f},type:"post",success:function(v){var x=null;try{x=$.parseJSON(v)}catch(w){$(".upload-overlay-loading-fix").hide();return}if(!x){$(".upload-overlay-loading-fix").hide();b.find("#brochureerror").html(t("Couldnt save please try again later"));return}if(x.status=="ok"){TTCallAPI({what:"user/privacy_extand/add",data:{privacyValue:p,privacyArray:o,entity_type:SOCIAL_ENTITY_USER_EVENTS,entity_id:x.value},callback:function(y){TTAlert({msg:t("Event created"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:function(){window.location.reload()}})}});$(".upload-overlay-loading-fix").hide()}else{$(".upload-overlay-loading-fix").hide();b.find("#brochureerror").html(x.error)}}})}}});$(document).on("click","#event_buts_cancel",function(){window.location.reload()})});function checkEventInfo_Add(i,f,h,g,k,d,e,b,a,c,j){j.find("#brochureerror").html("");j.find("input").removeClass("InputErr");j.find("textarea").removeClass("InputErr");if(i.length==0){j.find("#brochureerror").html(t("Invalid event name"));j.find("#nameevents").addClass("InputErr");j.find("#nameevents").focus();return false}else{if(f.length==0){j.find("#brochureerror").html(t("Invalid event description"));j.find("#descriptionevent").addClass("InputErr");j.find("#descriptionevent").focus();return false}else{if(h.length==0||b.length==0||a.length==0||c.length==0){j.find("#brochureerror").html(t("Invalid event location"));j.find("#locationevent").addClass("InputErr");j.find("#locationevent").focus();return false}else{if(g.length==0){j.find("#brochureerror").html(t("Invalid event date from"));j.find("#fromdate").addClass("InputErr");j.find("#fromdate").focus();return false}else{if(k.length==0){j.find("#brochureerror").html(t("Invalid event date to"));j.find("#todate").addClass("InputErr");j.find("#todate").focus();return false}else{if(d.length==0){j.find("#brochureerror").html(t("Invalid event time"));j.find("#defaultEntry").addClass("InputErr");j.find("#defaultEntry").focus();return false}else{if(e.length==0){j.find("#brochureerror").html(t("Invalid event time"));j.find("#defaultEntryTo").addClass("InputErr");j.find("#defaultEntryTo").focus();return false}}}}}}}return true}function getObjectData(b){var a=""+b.val();if(a==b.attr("data-value")){a=""}return a}function updateImage_Add_Brochure(c,b,a){if(a=="TT_uploadBtnevent"){$(".themephotoStanInside").attr("data-value",b);$(".themephotoStanInside").html(c)}closeFancyBox()}function getCurrentTime(){var c=new Date();var a=c.getHours();if(a<10){a="0"+a}var b=c.getMinutes();if(b<10){b="0"+b}var d=a+":"+b;return d}function addCalToEvent(a){if(new Date($("#fromdate").attr("data-cal"))>new Date($("#todate").attr("data-cal"))){$("#todate").attr("data-cal",$("#fromdate").attr("data-cal"));$("#todate").val($("#fromdate").val())}}function isNumberKey(b){var a=(b.which)?b.which:event.keyCode;if(a>31&&(a<48||a>57)){return false}return true};