(function(a){var d=10;var e=0.95;function b(x){var f=null,A=null,w=null,s=null,g=null,h=null,z=false,j=null;var p=[];x.hooks.processOptions.push(function(E,D){if(D.series.pie.show){D.grid.show=false;if(D.series.pie.label.show=="auto"){if(D.legend.show){D.series.pie.label.show=false}else{D.series.pie.label.show=true}}if(D.series.pie.radius=="auto"){if(D.series.pie.label.show){D.series.pie.radius=3/4}else{D.series.pie.radius=1}}if(D.series.pie.tilt>1){D.series.pie.tilt=1}else{if(D.series.pie.tilt<0){D.series.pie.tilt=0}}}});x.hooks.bindEvents.push(function(F,D){var E=F.getOptions();if(E.series.pie.show){if(E.grid.hoverable){D.unbind("mousemove").mousemove(v)}if(E.grid.clickable){D.unbind("click").click(u)}}});x.hooks.processDatapoints.push(function(G,H,D,E){var F=G.getOptions();if(F.series.pie.show){y(G,H,D,E)}});x.hooks.drawOverlay.push(function(F,D){var E=F.getOptions();if(E.series.pie.show){m(F,D)}});x.hooks.draw.push(function(F,D){var E=F.getOptions();if(E.series.pie.show){k(F,D)}});function y(E,F,D){if(!z){z=true;f=E.getCanvas();A=a(f).parent();w=E.getOptions();E.setData(i(E.getData()))}}function i(F){var J=0,E=0,I=0,D=w.series.pie.combine.color,H=[];for(var G=0;G<F.length;++G){var K=F[G].data;if(a.isArray(K)&&K.length==1){K=K[0]}if(a.isArray(K)){if(!isNaN(parseFloat(K[1]))&&isFinite(K[1])){K[1]=+K[1]}else{K[1]=0}}else{if(!isNaN(parseFloat(K))&&isFinite(K)){K=[1,+K]}else{K=[1,0]}}F[G].data=[K]}for(var G=0;G<F.length;++G){J+=F[G].data[0][1]}for(var G=0;G<F.length;++G){var K=F[G].data[0][1];if(K/J<=w.series.pie.combine.threshold){E+=K;I++;if(!D){D=F[G].color}}}for(var G=0;G<F.length;++G){var K=F[G].data[0][1];if(I<2||K/J>w.series.pie.combine.threshold){H.push(a.extend(F[G],{data:[[1,K]],color:F[G].color,label:F[G].label,angle:K*Math.PI*2/J,percent:K/(J/100)}))}}if(I>1){H.push({data:[[1,E]],color:D,label:w.series.pie.combine.label,angle:E*Math.PI*2/J,percent:E/(J/100)})}return H}function k(L,K){if(!A){return}var F=L.getPlaceholder().width(),E=L.getPlaceholder().height(),J=A.children().filter(".legend").children().width()||0;j=K;z=false;s=Math.min(F,E/w.series.pie.tilt)/2;h=E/2+w.series.pie.offset.top;g=F/2;if(w.series.pie.offset.left=="auto"){if(w.legend.position.match("w")){g+=J/2}else{g-=J/2}if(g<s){g=s}else{if(g>F-s){g=F-s}}}else{g+=w.series.pie.offset.left}var M=L.getData(),D=0;do{if(D>0){s*=e}D+=1;G();if(w.series.pie.tilt<=0.8){I()}}while(!H()&&D<d);if(D>=d){G();A.prepend(t("<div class='error'>Could not draw pie with labels contained inside canvas</div>"))}if(L.setSeries&&L.insertLegend){L.setSeries(M);L.insertLegend()}function G(){j.clearRect(0,0,F,E);A.children().filter(".pieLabel, .pieLabelBackground").remove()}function I(){var R=w.series.pie.shadow.left;var S=w.series.pie.shadow.top;var O=10;var N=w.series.pie.shadow.alpha;var Q=w.series.pie.radius>1?w.series.pie.radius:s*w.series.pie.radius;if(Q>=F/2-R||Q*w.series.pie.tilt>=E/2-S||Q<=O){return}j.save();j.translate(R,S);j.globalAlpha=N;j.fillStyle="#000";j.translate(g,h);j.scale(1,w.series.pie.tilt);for(var P=1;P<=O;P++){j.beginPath();j.arc(0,0,Q,0,Math.PI*2,false);j.fill();Q-=P}j.restore()}function H(){var S=Math.PI*w.series.pie.startAngle;var R=w.series.pie.radius>1?w.series.pie.radius:s*w.series.pie.radius;j.save();j.translate(g,h);j.scale(1,w.series.pie.tilt);j.save();var N=S;for(var Q=0;Q<M.length;++Q){M[Q].startAngle=N;P(M[Q].angle,M[Q].color,true)}j.restore();if(w.series.pie.stroke.width>0){j.save();j.lineWidth=w.series.pie.stroke.width;N=S;for(var Q=0;Q<M.length;++Q){P(M[Q].angle,w.series.pie.stroke.color,false)}j.restore()}l(j);j.restore();if(w.series.pie.label.show){return O()}else{return true}function P(T,U,V){if(T<=0||isNaN(T)){return}if(V){j.fillStyle=U}else{j.strokeStyle=U;j.lineJoin="round"}j.beginPath();if(Math.abs(T-Math.PI*2)>1e-09){j.moveTo(0,0)}j.arc(0,0,R,N,N+T/2,false);j.arc(0,0,R,N+T/2,N+T,false);j.closePath();N+=T;if(V){j.fill()}else{j.stroke()}}function O(){var T=S;var W=w.series.pie.label.radius>1?w.series.pie.label.radius:s*w.series.pie.label.radius;for(var V=0;V<M.length;++V){if(M[V].percent>=w.series.pie.label.threshold*100){if(!U(M[V],T,V)){return false}}T+=M[V].angle}return true;function U(ah,ai,aa){if(ah.data[0][1]==0){return true}var ae=w.legend.labelFormatter,aj,af=w.series.pie.label.formatter;if(ae){aj=ae(ah.label,ah)}else{aj=ah.label}if(af){aj=af(aj,ah)}var Y=((ai+ah.angle)+ai)/2;var ak=g+Math.round(Math.cos(Y)*W);var al=h+Math.round(Math.sin(Y)*W)*w.series.pie.tilt;var Z="<span class='pieLabel' id='pieLabel"+aa+"' style='position:absolute;top:"+al+"px;left:"+ak+"px;'>"+aj+"</span>";A.append(Z);var ab=A.children("#pieLabel"+aa);var ad=(al-ab.height()/2);var ac=ak;if(ak>g){ac=ak}else{ac=(ak-ab.width())}ab.css("top",ad);ab.css("left",ac);if(0-ad>0||0-ac>0||E-(ad+ab.height())<0||F-(ac+ab.width())<0){return false}if(w.series.pie.label.background.opacity!=0){var X=w.series.pie.label.background.color;if(X==null){X=ah.color}var ag="top:"+ad+"px;left:"+ac+"px;";a("<div class='pieLabelBackground' style='position:absolute;width:"+ab.width()+"px;height:"+ab.height()+"px;"+ag+"background-color:"+X+";'></div>").css("opacity",w.series.pie.label.background.opacity).insertBefore(ab)}return true}}}}function l(E){if(w.series.pie.innerRadius>0){E.save();var D=w.series.pie.innerRadius>1?w.series.pie.innerRadius:s*w.series.pie.innerRadius;E.globalCompositeOperation="destination-out";E.beginPath();E.fillStyle=w.series.pie.stroke.color;E.arc(0,0,D,0,Math.PI*2,false);E.fill();E.closePath();E.restore();E.save();E.beginPath();E.strokeStyle=w.series.pie.stroke.color;E.arc(0,0,D,0,Math.PI*2,false);E.stroke();E.closePath();E.restore()}}function r(H,I){for(var D=false,E=-1,G=H.length,F=G-1;++E<G;F=E){((H[E][1]<=I[1]&&I[1]<H[F][1])||(H[F][1]<=I[1]&&I[1]<H[E][1]))&&(I[0]<(H[F][0]-H[E][0])*(I[1]-H[E][1])/(H[F][1]-H[E][1])+H[E][0])&&(D=!D)}return D}function n(G,H){var V=x.getData(),I=x.getOptions(),T=I.series.pie.radius>1?I.series.pie.radius:s*I.series.pie.radius,W,X;for(var F=0;F<V.length;++F){var U=V[F];if(U.pie.show){j.save();j.beginPath();j.moveTo(0,0);j.arc(0,0,T,U.startAngle,U.startAngle+U.angle/2,false);j.arc(0,0,T,U.startAngle+U.angle/2,U.startAngle+U.angle,false);j.closePath();W=G-g;X=H-h;if(j.isPointInPath){if(j.isPointInPath(G-g,H-h)){j.restore();return{datapoint:[U.percent,U.data],dataIndex:0,series:U,seriesIndex:F}}}else{var J=T*Math.cos(U.startAngle),K=T*Math.sin(U.startAngle),L=T*Math.cos(U.startAngle+U.angle/4),M=T*Math.sin(U.startAngle+U.angle/4),N=T*Math.cos(U.startAngle+U.angle/2),O=T*Math.sin(U.startAngle+U.angle/2),P=T*Math.cos(U.startAngle+U.angle/1.5),Q=T*Math.sin(U.startAngle+U.angle/1.5),R=T*Math.cos(U.startAngle+U.angle),S=T*Math.sin(U.startAngle+U.angle),E=[[0,0],[J,K],[L,M],[N,O],[P,Q],[R,S]],D=[W,X];if(r(E,D)){j.restore();return{datapoint:[U.percent,U.data],dataIndex:0,series:U,seriesIndex:F}}}j.restore()}}return null}function v(D){B("plothover",D)}function u(D){B("plotclick",D)}function B(G,F){var K=x.offset();var D=parseInt(F.pageX-K.left);var E=parseInt(F.pageY-K.top);var J=n(D,E);if(w.grid.autoHighlight){for(var I=0;I<p.length;++I){var H=p[I];if(H.auto==G&&!(J&&H.series==J.series)){C(H.series)}}}if(J){o(J.series,G)}var L={pageX:F.pageX,pageY:F.pageY};A.trigger(G,[L,J])}function o(F,D){var E=q(F);if(E==-1){p.push({series:F,auto:D});x.triggerRedrawOverlay()}else{if(!D){p[E].auto=false}}}function C(E){if(E==null){p=[];x.triggerRedrawOverlay()}var D=q(E);if(D!=-1){p.splice(D,1);x.triggerRedrawOverlay()}}function q(F){for(var E=0;E<p.length;++E){var D=p[E];if(D.series==F){return E}}return -1}function m(H,F){var G=H.getOptions();var I=G.series.pie.radius>1?G.series.pie.radius:s*G.series.pie.radius;F.save();F.translate(g,h);F.scale(1,G.series.pie.tilt);for(var E=0;E<p.length;++E){D(p[E].series)}l(F);F.restore();function D(J){if(J.angle<=0||isNaN(J.angle)){return}F.fillStyle="rgba(255, 255, 255, "+G.series.pie.highlight.opacity+")";F.beginPath();if(Math.abs(J.angle-Math.PI*2)>1e-09){F.moveTo(0,0)}F.arc(0,0,I,J.startAngle,J.startAngle+J.angle/2,false);F.arc(0,0,I,J.startAngle+J.angle/2,J.startAngle+J.angle,false);F.closePath();F.fill()}}}var c={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(f,g){return"<div class='labelContainer' style='color:#fff;background-color:"+g.color+";'><div class='labeltitle'>"+f+"</div><div class='labelVal'>"+Math.round(g.percent)+"%</div></div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};a.plot.plugins.push({init:b,options:c,name:"pie",version:"1.1"})})(jQuery);