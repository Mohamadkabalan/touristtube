/*
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.4.5
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 * 
 */
(function(d){var c={init:function(a){return this.each(function(){var b=this,l=d(b).empty();b.opt=d.extend(true,{},d.fn.raty.defaults,a);l.data("settings",b.opt);b.opt.number=c.between(b.opt.number,0,20);if(b.opt.path.substring(b.opt.path.length-1,b.opt.path.length)!="/"){b.opt.path+="/"}if(typeof b.opt.score=="function"){b.opt.score=b.opt.score.call(b)}if(b.opt.score){b.opt.score=c.between(b.opt.score,0,b.opt.number)}for(var i=1;i<=b.opt.number;i++){d("<img />",{src:b.opt.path+((!b.opt.score||b.opt.score<i)?b.opt.starOff:b.opt.starOn),alt:i,title:(i<=b.opt.hints.length&&b.opt.hints[i-1]!==null)?b.opt.hints[i-1]:i}).appendTo(b);if(b.opt.space){l.append((i<b.opt.number)?"&#160;":"")}}b.stars=l.children('img:not(".raty-cancel")');b.score=d("<input />",{type:"hidden",name:b.opt.scoreName}).appendTo(b);if(b.opt.score&&b.opt.score>0){b.score.val(b.opt.score);c.roundStar.call(b,b.opt.score)}if(b.opt.iconRange){c.fill.call(b,b.opt.score)}c.setTarget.call(b,b.opt.score,b.opt.targetKeep);var k=b.opt.space?4:0,j=b.opt.width||(b.opt.number*b.opt.size+b.opt.number*k);if(b.opt.cancel){b.cancel=d("<img />",{src:b.opt.path+b.opt.cancelOff,alt:"x",title:b.opt.cancelHint,"class":"raty-cancel"});if(b.opt.cancelPlace=="left"){l.prepend("&#160;").prepend(b.cancel)}else{l.append("&#160;").append(b.cancel)}j+=(b.opt.size+k)}if(b.opt.readOnly){c.fixHint.call(b);if(b.cancel){b.cancel.hide()}}else{l.css("cursor","pointer");c.bindAction.call(b)}l.css("width",j)})},between:function(f,b,a){return Math.min(Math.max(parseFloat(f),b),a)},bindAction:function(){var a=this,f=d(a);f.mouseleave(function(){var e=a.score.val()||undefined;c.initialize.call(a,e);c.setTarget.call(a,e,a.opt.targetKeep);if(a.opt.mouseover){a.opt.mouseover.call(a,e)}});var b=a.opt.half?"mousemove":"mouseover";if(a.opt.cancel){a.cancel.mouseenter(function(){d(this).attr("src",a.opt.path+a.opt.cancelOn);a.stars.attr("src",a.opt.path+a.opt.starOff);c.setTarget.call(a,null,true);if(a.opt.mouseover){a.opt.mouseover.call(a,null)}}).mouseleave(function(){d(this).attr("src",a.opt.path+a.opt.cancelOff);if(a.opt.mouseover){a.opt.mouseover.call(a,a.score.val()||null)}}).click(function(e){a.score.removeAttr("value");if(a.opt.click){a.opt.click.call(a,null,e)}})}a.stars.bind(b,function(j){var k=parseInt(this.alt,10);if(a.opt.half){var e=parseFloat((j.pageX-d(this).offset().left)/a.opt.size),l=(e>0.5)?1:0.5;k=parseFloat(this.alt)-1+l;c.fill.call(a,k);if(a.opt.precision){k=k-l+e}c.showHalf.call(a,k)}else{c.fill.call(a,k)}f.data("score",k);c.setTarget.call(a,k,true);if(a.opt.mouseover){a.opt.mouseover.call(a,k,j)}}).click(function(e){a.score.val((a.opt.half||a.opt.precision)?f.data("score"):this.alt);if(a.opt.click){a.opt.click.call(a,a.score.val(),e)}})},cancel:function(a){return d(this).each(function(){var b=this,f=d(b);if(f.data("readonly")===true){return this}if(a){c.click.call(b,null)}else{c.score.call(b,null)}b.score.removeAttr("value")})},click:function(a){return d(this).each(function(){if(d(this).data("readonly")===true){return this}c.initialize.call(this,a);if(this.opt.click){this.opt.click.call(this,a)}else{c.error.call(this,'you must add the "click: function(score, evt) { }" callback.')}c.setTarget.call(this,a,true)})},error:function(a){d(this).html(a);d.error(a)},fill:function(p){var a=this,n=a.stars.length,m=0,b,o,l;for(var i=1;i<=n;i++){b=a.stars.eq(i-1);if(a.opt.iconRange&&a.opt.iconRange.length>m){o=a.opt.iconRange[m];if(a.opt.single){l=(i==p)?(o.on||a.opt.starOn):(o.off||a.opt.starOff)}else{l=(i<=p)?(o.on||a.opt.starOn):(o.off||a.opt.starOff)}if(i<=o.range){b.attr("src",a.opt.path+l)}if(i==o.range){m++}}else{if(a.opt.single){l=(i==p)?a.opt.starOn:a.opt.starOff}else{l=(i<=p)?a.opt.starOn:a.opt.starOff}b.attr("src",a.opt.path+l)}}},fixHint:function(){var a=d(this),f=parseInt(this.score.val(),10),b=this.opt.noRatedMsg;if(!isNaN(f)&&f>0){b=(f<=this.opt.hints.length&&this.opt.hints[f-1]!==null)?this.opt.hints[f-1]:f}a.data("readonly",true).css("cursor","default").attr("title",b);this.score.attr("readonly","readonly");this.stars.attr("title",b)},getScore:function(){var b=[],a;d(this).each(function(){a=this.score.val();b.push(a?parseFloat(a):undefined)});return(b.length>1)?b:b[0]},readOnly:function(a){return this.each(function(){var b=d(this);if(b.data("readonly")===a){return this}if(this.cancel){if(a){this.cancel.hide()}else{this.cancel.show()}}if(a){b.unbind();b.children("img").unbind();c.fixHint.call(this)}else{c.bindAction.call(this);c.unfixHint.call(this)}b.data("readonly",a)})},reload:function(){return c.set.call(this,{})},roundStar:function(f){var b=(f-Math.floor(f)).toFixed(2);if(b>this.opt.round.down){var a=this.opt.starOn;if(b<this.opt.round.up&&this.opt.halfShow){a=this.opt.starHalf}else{if(b<this.opt.round.full){a=this.opt.starOff}}this.stars.eq(Math.ceil(f)-1).attr("src",this.opt.path+a)}},score:function(){return arguments.length?c.setScore.apply(this,arguments):c.getScore.call(this)},set:function(a){this.each(function(){var b=d(this),h=b.data("settings"),g=b.clone().removeAttr("style").insertBefore(b);b.remove();g.raty(d.extend(h,a))});return d(this.selector)},setScore:function(a){return d(this).each(function(){if(d(this).data("readonly")===true){return this}c.initialize.call(this,a);c.setTarget.call(this,a,true)})},setTarget:function(g,b){if(this.opt.target){var a=d(this.opt.target);if(a.length==0){c.error.call(this,"target selector invalid or missing!")}var h=g;if(!b||h===undefined){h=this.opt.targetText}else{if(this.opt.targetType=="hint"){h=(h===null&&this.opt.cancel)?this.opt.cancelHint:this.opt.hints[Math.ceil(h-1)]}else{h=this.opt.precision?parseFloat(h).toFixed(1):parseInt(h,10)}}if(this.opt.targetFormat.indexOf("{score}")<0){c.error.call(this,'template "{score}" missing!')}if(g!==null){h=this.opt.targetFormat.toString().replace("{score}",h)}if(a.is(":input")){a.val(h)}else{a.html(h)}}},showHalf:function(b){var a=(b-Math.floor(b)).toFixed(1);if(a>0&&a<0.6){this.stars.eq(Math.ceil(b)-1).attr("src",this.opt.path+this.opt.starHalf)}},initialize:function(a){a=!a?0:c.between(a,0,this.opt.number);c.fill.call(this,a);if(a>0){if(this.opt.halfShow){c.roundStar.call(this,a)}this.score.val(a)}},unfixHint:function(){for(var a=0;a<this.opt.number;a++){this.stars.eq(a).attr("title",(a<this.opt.hints.length&&this.opt.hints[a]!==null)?this.opt.hints[a]:a)}d(this).data("readonly",false).css("cursor","pointer").removeAttr("title");this.score.attr("readonly","readonly")}};d.fn.raty=function(a){if(c[a]){return c[a].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof a==="object"||!a){return c.init.apply(this,arguments)}else{d.error("Method "+a+" does not exist!")}}};d.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseover:undefined,noRatedMsg:"not rated yet",number:5,path:"img/",precision:false,round:{down:0.25,full:0.6,up:0.76},readOnly:false,score:undefined,scoreName:"score",single:false,size:16,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:false,targetText:"",targetType:"hint",width:undefined}})(jQuery);