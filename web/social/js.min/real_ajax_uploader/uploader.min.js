var applyalbumcheckcount=0;var counterfilepubleshed=0;var boolloderappear=false;var countfileupload=0;var countfileuploadnumber=0;var defaultheight=487;var fileCount=0;var searchdescriptiontext=t("for better visibility and online search, please fill here");function uniqueid(){var b=String.fromCharCode(Math.floor((Math.random()*25)+65));do{var a=Math.floor((Math.random()*42)+48);if(a<58||a>64){b+=String.fromCharCode(a)}}while(b.length<32);return(b)}function verifyForm(d){var c=true;var a=$("#"+d);if(currentsection=="upload-album"&&(d=="logalbumadd"||d=="logalbumelected")){a=$("."+d)}$(".uploadinfomandatory span",a).html("");$("input,select,textarea",a).removeClass("err").each(function(){var f=$(this).attr("name");var e=$(this).parent();if((f=="location")||(f=="location_name")||(f=="cityname")||(f=="status")||(f=="vid")||$(this).hasClass("filevalue")||(f=="filename")||(f=="addmoretext")||(f=="vpath")){}else{if(($(".uploadinfomandatory"+f,e).css("display")!="none"&&getObjectData($(this))=="")||(f=="category"&&!$(".uploadinfomandatorycategory",e).hasClass("inactive")&&$(this).val()=="0")||(f=="country"&&!$(".uploadinfomandatorycountry",e).hasClass("inactive")&&$(this).val()=="0")){$(".uploadinfomandatory"+f+" span",e).html(t("please fill this field correctly"));c=false}}});var b=$("input[name=cityname]",a).parent();if(getObjectData($("input[name=cityname]",a))==""&&!$(".uploadinfomandatorycitynameaccent",b).hasClass("inactive")&&$("input[name=cityname]",a).length>0){$(".uploadinfomandatorycitynameaccent span",b).html(t("please fill this field correctly"));c=false}if(!c){TTAlert({msg:t("Please input mandatory fields"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return false}else{return true}}function getIsImage(a){var b=a.split(".");if(b.length<2){return}b=b[b.length-1].toLowerCase();var c="false";if((b==="png")||(b==="jpg")||(b==="jpeg")||(b==="bmp")||(b==="tiff")||(b==="tif")){var c="true"}return c}var _AutocompleteCities=null;function AutocompleteCitiesReset(){_AutocompleteCities=new Array()}function AutocompleteCitiesAdd(a){_AutocompleteCities.push(a)}function AutocompleteCitiesExists(a){if(_AutocompleteCities===null){return null}var b=removeDiacritics(a);for(var c=0;c<_AutocompleteCities.length;c++){if(b.toLowerCase()===_AutocompleteCities[c].value.toLowerCase()){return _AutocompleteCities[c]}}return null}function addAutoComplete(b){var a=$("input[name=citynameaccent]",$("#realupload_"+b));if(currentsection=="upload-album"&&(b=="logalbumadd"||b=="logalbumelected")){a=$("#log_2 #"+b+"citynameaccent")}a.autocomplete({appendTo:"#MiddleInsideNormal",search:function(e,f){var c=$("select[name=country]",a.parent()).removeClass("err");var d=$("option:selected",c).val();if(d=="ZZ"){c.addClass("err");e.preventDefault()}else{a.autocomplete("option","source",ReturnLink("/ajax/uploadGetCities.php?cc="+d))}AutocompleteCitiesReset()},select:function(c,d){a.val(ucwords(d.item.value));$("input[name=cityname]",a.parent()).val(d.item.value);$("input[name=cityname]",a.parent()).attr("data-id",d.item.id);c.preventDefault()},change:function(c,e){if(!e.item){var d=AutocompleteCitiesExists(a.val());if(d===null){a.val("");return}a.val(ucwords(d.value));$("input[name=cityname]",a.parent()).val(d.value)}}}).keydown(function(d){var c=(d.keyCode?d.keyCode:d.which);if(AutocompleteCitiesExists(a.val())===null){$("input[name=cityname]",a.parent()).val("");$("input[name=cityname]",a.parent()).attr("data-id","")}if(c===13||c===9){if(AutocompleteCitiesExists(a.val())===null){d.preventDefault();return}if(c===13){$(this).blur()}}}).data("ui-autocomplete")._renderItem=function(d,c){AutocompleteCitiesAdd(c);return $("<li></li>").data("item.autocomplete",c).append("<a>"+ucwords(c.value)+"</a>").appendTo(d)}}function FileUploadCompleted(a){$("#realupload_"+a+" .pause").hide();$("#realupload_"+a+" .resume").hide()}function FileUploadSaved(){$(".ax-file-list li .licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3.active").each(function(){$(this).parent().parent().parent().remove()});$(".ax-file-list li").each(function(){$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").hide();$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").removeClass("active")});$(".ax-file-list li").first().find(".togb").click();$(".upload-overlay-loading-fix-file").hide()}function FileUploadIsSaved(a){return($(".ax-file-list li#uploadreal_"+a).find("span.status2").html()=="Saved!")}var upload_started=0;function SetPageLeave(){if((uploader.total.queued==0)&&(upload_started==0)){setConfirmUnload(false,t('Some media files are being processed. Leaving this page will result in loss of data. Press "Cancel" to continue uploading.'))}else{setConfirmUnload(true,t('Some media files are being processed. Leaving this page will result in loss of data. Press "Cancel" to continue uploading.'))}}function ShowError(b,d){var a=b.id;var c=$("#SWFUpload_2_"+a);$("#SWFUpload_2_"+a+" .pause").hide();$("#SWFUpload_2_"+a+" .resume").hide();c.find("div.progress").css({width:"100%","background-color":"red","background-image":"none"});c.find("span.progressvalue").text("").css({color:"#686868"});c.addClass("success").find("span.status").html('<span class="status2">'+d+"</span>");if(countfileupload==countfileuploadnumber){if(!$(".ax-file-list li").find(".togb").hasClass("closeclose")){$(".ax-file-list li").first().find(".togb").click()}countfileupload=countfileuploadnumber=0;$(".upload-loading-txt-file").hide();$(".stop_all_upload").hide();$(".upload-loading-sep").hide()}}function SaveError(a,c){var b=$("#"+a);$("#"+a+" .pause").hide();$("#"+a+" .resume").hide();b.find("div.progress").css({width:"100%","background-color":"red","background-image":"none"});b.find("span.progressvalue").text("").css({color:"#686868"});b.addClass("success").find("span.status").find("span.status2").html(c);$(".upload-overlay-loading-fix-file").hide()}function createImage(a,c){var b=a.ext;var d=false;if((b=="png")||(b=="jpg")||(b=="jpeg")||(b=="bmp")||(b=="tiff")||(b=="tif")){d=true}var e='<script type="text/javascript">$(document).ready(function(){$("#realupload_'+c+' .preloader").hide();$("#realupload_'+c+' .preloader").ajaxStart(function(){$(".preloader").hide();$(this).show();$("#realupload_'+c+'").css({opacity: 0.4});}).ajaxStop(function(){$(this).hide();$("#realupload_'+c+'").css({opacity: 1});});$("#realupload_'+c+'fancy").fancybox({"padding"	:0,"margin"	:0,"width"			: 375,"height"			: 146,"transitionIn"		: "none","transitionOut"	: "none","type"				: "iframe"});});</script><div class="licorner"><div class="uploadinfocheckboxAllcontainer"><div class="uploadinfocheckbox uploadinfocheckbox_apply3" style="display:none;"><div class="uploadinfocheckboxpic"></div></div></div><div class="licornericon'+d+'"></div><div class="stanleft"><div class="stanleftin"></div></div><div class="togb openclose"><div class="openclose_over"><div class="openclose_overtxt">'+t("expand")+'</div></div></div><span class="pause" >&nbsp;</span><span class="resume" >&nbsp;</span></div></div><input type="hidden" name="realupload_'+c+'" value="" class="filevalue">';a.li.append(e);$("#realupload_"+c+" .cancel").bind("click",function(){if(FileUploadIsSaved(c)){$("li#realupload_"+c).slideUp("fast").remove();showHideSameDescription()}else{TTAlert({msg:t("Are you sure you want to cancel this upload?"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(h){if(h){var g=$("#real_upload").data("AU");var i=g.files;if(!a){}else{if(a.status!=1){if($("#realupload_"+c).find(".ax-upload")&&$("#realupload_"+c).find(".ax-abort")){$("#realupload_"+c).find(".ax-upload").click()}for(var f=0;f<i.length;f++){if(i[f].id===c){g.removeFile(f);if(fileCount!=0){fileCount--}}}}else{for(var f=0;f<i.length;f++){if(i[f].id===c){g.removeFile(f);if(fileCount!=0){fileCount--}}}}}deletefile("realupload_"+c);$("li#realupload_"+c).slideUp("fast").remove();showHideSameDescription()}}})}});$("#realupload_"+c+" .pause").bind("click",function(){var g=uploader.getFile(c);if(!g||g.status!=plupload.UPLOADING){return}var f=$(this);f.hide();$("#realupload_"+c+" .resume").show();$("#realupload_"+c+" span.status").html(t("Paused"));$("#realupload_"+c).find("div.progress").css("width",0+"%");$("#realupload_"+c).find("span.progressvalue").text(0+"%");PauseUpload()});$("#realupload_"+c+" .resume").bind("click",function(){var f=uploader.getFile(c);if(!f||f.status==plupload.UPLOADING){return}$(this).hide();$("#realupload_"+c+" .pause").show();$("#realupload_"+c+" span.status").html(t("Uploading"));ResumeUpload()})}function addDescriptionRelated(a,b){if(!$("#realupload_"+a).hasClass("desc")){var c=addanotherappend("realupload_"+a,b);$("#realupload_"+a).append(c);addAutoComplete(a);$("#realupload_"+a).addClass("desc");addButtonSave("realupload_"+a,b);if(currentsection=="upload-album"){$("#realupload_"+a).find(".privacyclass").click()}showHideSameDescription()}}function addButtonSave(c,b){var a="#"+c;$(""+a+" .SaveButton").unbind("click");$(""+a+" .SaveButton").click(function(g){$(".upload-overlay-loading-fix-file").show();var h=CopyForm($(a));if(!verifyForm(c)){$(".upload-overlay-loading-fix-file").hide();return}var f=$(this).closest(".tableform");if(currentsection=="upload-album"){f=$(".uploadalbumselected").find(".tableform")}var j=f.find(".privacyclass.active").attr("data-value");var i=new Array();if(j==USER_PRIVACY_SELECTED){f.find(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){var e=$(this);if(e.attr("id")=="friendsdata"){i.push({friends:1})}else{if(e.attr("id")=="friends_of_friends_data"){i.push({friends_of_friends:1})}else{if(e.attr("id")=="followersdata"){i.push({followers:1})}else{if(parseInt(e.attr("data-id"))!=0){i.push({id:e.attr("data-id")})}}}}})}if((j==USER_PRIVACY_SELECTED&&i.length==0)){TTAlert({msg:t("Invalid privacy data"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});$(".upload-overlay-loading-fix-file").hide();return}if(h==""&&currentsection!="upload-album"){h=CopyFormtab1($(a))}var d=CatalogID();if(currentsection=="upload"&&$(a+" .catalog_class").length>0){d=$(a+" .catalog_class").val()}$.ajax({url:ReturnLink("/up_savenew.php"),type:"post",data:{S:$("#S").val(),myformarr:h,privacyValue:j,privacyArray:i,title:getObjectData($(a+" input[name=title]")),cityname:$(a+" input[name=cityname]").val(),cityid:$(a+" input[name=cityname]").attr("data-id"),citynameaccent:$(a+" input[name=citynameaccent]").val(),is_public:$(a+" div.privacyclass.active").attr("data-value"),description:getObjectData($(a+" textarea[name=description]")),catalog_id:d,category:$(a+" select[name=category] option:selected").val(),placetakenat:getObjectData($(a+" input[name=placetakenat]")),keywords:getObjectData($(a+" input[name=keywords]")),country:$(a+" select[name=country] option:selected").val(),location:$(a+" input[name=location]").val(),defaultcatalogicon:$(a+" .uploadinfocheckbox2").hasClass("active")?1:0},success:function(e){if(e!=""){if(String(""+b)=="false"){appendfancy(c+"",e)}FileUploadSaved()}},error:function(k,l,e){SaveError(c,"Error: "+l+" "+((e)?e:""))}})})}var uploader=null;var requirements_met=true;var pausemode=0;function PauseUpload(){pausemode=1;uploader.stop()}function ResumeUpload(){pausemode=0;uploader.start()}$(document).ready(function(){if(currentsection=="upload-album"){defaultheight=412}$(document).on("change","select[name=country]",function(){var a=$(this).closest(".UploadMediaRightTF");a.find("input[name=citynameaccent]").val("");a.find("input[name=cityname]").val("");a.find("input[name=cityname]").attr("data-id","")});$(".stop_all_upload").bind("click",function(){TTAlert({msg:t("Are you sure you want to cancel pending uploads?"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(a){if(a){PauseUpload();uploader.splice();uploader.refresh();ResumeUpload();countfileupload=countfileuploadnumber=0;$(".upload-loading-txt-file").hide();$(".stop_all_upload").hide();$(".upload-loading-sep").hide();$(".ax-file-list li").each(function(){if(!$(this).hasClass("success")){$(this).remove()}});$(".uploadinsidemenu").attr("target","");$("#slot-machine-tabs #tabsmain li a").attr("target","")}}})});$(document).on("click",".ax-file-list .licorner .togb",function(){var c=$(this);var b=c.parent().parent();if(c.parent().find(".uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").hasClass("active")&&c.parent().find(".uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").css("display")!="none"){return 0}if(c.hasClass("openclose")){var a=false;if(currentsection=="upload-album"){if($(".uploadalbumselected .uploadinfocheckbox_apply4").hasClass("active")){$(".uploadalbumselected .uploadinfocheckbox_apply4").click()}}$(".ax-file-list li").each(function(){var d=$(this);if(d.hasClass("desc")&&!a){a=true;if(formIsFilled(d)){TTAlert({msg:t("You are about to remove your filled data.<br/>Would you like to proceed?"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(e){if(e){removeCheckBoxSameDescription();d.removeClass("desc");d.find(".formcontainer").remove();d.animate({height:"92px"},500,function(){d.find(".togb").removeClass("closeclose").addClass("openclose")});addDescriptionRelated(b.attr("data-id"),b.attr("data-isImage"));$("div.formcontainer",b).show();b.animate({height:defaultheight+"px"},500,function(){if(currentsection!="upload-album"){addmoreusersautocomplete_custom_journal(b.find("#addmoretext_privacy"))}c.removeClass("openclose").addClass("closeclose");$(window).resize()})}}})}else{removeCheckBoxSameDescription();d.removeClass("desc");d.find(".formcontainer").remove();d.animate({height:"92px"},500,function(){d.find(".togb").removeClass("closeclose").addClass("openclose")});addDescriptionRelated(b.attr("data-id"),b.attr("data-isImage"));$("div.formcontainer",b).show();b.animate({height:defaultheight+"px"},500,function(){if(currentsection!="upload-album"){addmoreusersautocomplete_custom_journal(b.find("#addmoretext_privacy"))}c.removeClass("openclose").addClass("closeclose");$(window).resize()})}}});if(!a){addDescriptionRelated(b.attr("data-id"),b.attr("data-isImage"));$("div.formcontainer",b).show();b.animate({height:defaultheight+"px"},500,function(){if(currentsection!="upload-album"){addmoreusersautocomplete_custom_journal(b.find("#addmoretext_privacy"))}c.removeClass("openclose").addClass("closeclose");$(window).resize()})}}else{if(formIsFilled(b)){TTAlert({msg:t("You are about to remove your filled data.<br/>Would you like to proceed?"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(d){if(d){removeCheckBoxSameDescription();b.removeClass("desc");b.find(".formcontainer").remove();b.animate({height:"92px"},500,function(){c.removeClass("closeclose").addClass("openclose");$(window).resize()})}else{setTimeout(function(){b.find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").removeClass("active");b.find(".licorner .togb").show()},100)}}})}else{removeCheckBoxSameDescription();b.removeClass("desc");b.find(".formcontainer").remove();b.animate({height:"92px"},500,function(){c.removeClass("closeclose").addClass("openclose");$(window).resize()})}}});$(".upload-overlay-loading-fix-file .loadingbuttons").bind("click",function(){var a=uploader.getFile($(this).attr("data-id"));if($(this).hasClass("loadingpause")){if(!a||a.status!=plupload.UPLOADING){return}$(this).removeClass("loadingpause");$(this).addClass("loadingresume");PauseUpload()}else{if(!a||a.status==plupload.UPLOADING){return}$(this).removeClass("loadingresume");$(this).addClass("loadingpause");ResumeUpload()}});if(currentsection=="upload-album"){$("#uploadnewalbum").mouseover(function(){$("#uploadnewalbumover").show()});$("#uploadnewalbum").mouseout(function(){$("#uploadnewalbumover").hide()});$(document).on("click","#uploadnewalbum",function(){if($(".uploadalbum").css("display")=="none"){$(".upload2 #log").html("");$(".uploadalbumselected .logalbumelected li").html("");$(".uploadalbumselected").hide();$("#uploadSection").hide();$("#albumlist").val("0");$(".uploadalbumselected .logalbumelected li").css("height","76px");$(".UploadMediaRightTF .ClearNewAlbumButton").click();$(".uploadalbum").show();$(".uploadalbum").animate({height:"450px"},500);$(window).resize()}});$(document).on("click","."+currentlogalbumaddid+" .UploadMediaRightTF .ClearNewAlbumButton",function(){$("#privacyclass_user"+USER_PRIVACY_PUBLIC).click();$("."+currentlogalbumaddid+" .inputuploadformTF").val("");$("."+currentlogalbumaddid+" #logalbumaddcountry, ."+currentlogalbumaddid+" #logalbumaddcategory").val("0");$("."+currentlogalbumaddid+" .inputuploaddescriptionTF").val("");$("."+currentlogalbumaddid+" .inputuploadformTF").blur();$("."+currentlogalbumaddid+" .inputuploaddescriptionTF").blur()});$(document).on("click","."+currentlogalbumaddid+" .UploadMediaRightTF .SaveNewAlbumButton",function(){if(verifyForm(currentlogalbumaddid)){var a=$(this).closest(".tableform");var c=a.find(".privacyclass.active").attr("data-value");var b=new Array();if(c==USER_PRIVACY_SELECTED){a.find(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){var d=$(this);if(d.attr("id")=="friendsdata"){b.push({friends:1})}else{if(d.attr("id")=="friends_of_friends_data"){b.push({friends_of_friends:1})}else{if(d.attr("id")=="followersdata"){b.push({followers:1})}else{if(parseInt(d.attr("data-id"))!=0){b.push({id:d.attr("data-id")})}}}}})}if((c==USER_PRIVACY_SELECTED&&b.length==0)){TTAlert({msg:t("Invalid privacy data"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});$(".upload-overlay-loading-fix-file").hide();return}$(".upload-overlay-loading-fix").show();$.post(ReturnLink("/ajax/ajax_addnewalbumupload.php"),{title:getObjectData($("."+currentlogalbumaddid+" input[name=title]")),cityname:$("."+currentlogalbumaddid+" input[name=cityname]").val(),cityid:$("."+currentlogalbumaddid+" input[name=cityname]").attr("data-id"),citynameaccent:$("."+currentlogalbumaddid+" input[name=citynameaccent]").val(),is_public:$("."+currentlogalbumaddid+" div.privacyclass.active").attr("data-value"),description:getObjectData($("."+currentlogalbumaddid+" textarea[name=description]")),category:$("."+currentlogalbumaddid+" select[name=category] option:selected").val(),placetakenat:getObjectData($("."+currentlogalbumaddid+" input[name=placetakenat]")),keywords:getObjectData($("."+currentlogalbumaddid+" input[name=keywords]")),country:$("."+currentlogalbumaddid+" select[name=country] option:selected").val(),location:$("."+currentlogalbumaddid+" input[name=location]").val()},function(d){if(d!=false){$("#albumlist option:eq(0)").after(d);TTCallAPI({what:"user/privacy_extand/add",data:{privacyValue:c,privacyArray:b,entity_type:SOCIAL_ENTITY_ALBUM,entity_id:$("#albumlist option:eq(1)").attr("id")},callback:function(e){}});$(".uploadalbum").hide();$(".uploadalbum").css("height","0px");$("."+currentlogalbumaddid+" .UploadMediaRightTF .ClearNewAlbumButton").click();$("#albumlist").val($("#albumlist option:eq(1)").val());$("#albumlist").change()}})}});$(document).on("click",".uploadalbumselected .UploadMediaRightTF .SaveNewAlbumButton",function(){if(verifyForm("logalbumelected")){var a=$(this).closest(".tableform");var c=a.find(".privacyclass.active").attr("data-value");var b=new Array();if(c==USER_PRIVACY_SELECTED){a.find(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){var d=$(this);if(d.attr("id")=="friendsdata"){b.push({friends:1})}else{if(d.attr("id")=="friends_of_friends_data"){b.push({friends_of_friends:1})}else{if(d.attr("id")=="followersdata"){b.push({followers:1})}else{if(parseInt(d.attr("data-id"))!=0){b.push({id:d.attr("data-id")})}}}}})}if((c==USER_PRIVACY_SELECTED&&b.length==0)){TTAlert({msg:t("Invalid privacy data"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});$(".upload-overlay-loading-fix-file").hide();return}$(".upload-overlay-loading-fix-file").show();$.post(ReturnLink("/ajax/ajax_updatealbumupload.php"),{privacyValue:c,privacyArray:b,catalog_id:CatalogID(),title:getObjectData($(".logalbumelected input[name=title]")),cityname:$(".logalbumelected input[name=cityname]").val(),cityid:$(".logalbumelected input[name=cityname]").attr("data-id"),citynameaccent:$(".logalbumelected input[name=citynameaccent]").val(),is_public:$(".logalbumelected div.privacyclass.active").attr("data-value"),description:getObjectData($(".logalbumelected textarea[name=description]")),category:$(".logalbumelected select[name=category] option:selected").val(),placetakenat:getObjectData($(".logalbumelected input[name=placetakenat]")),keywords:getObjectData($(".logalbumelected input[name=keywords]")),country:$(".logalbumelected select[name=country] option:selected").val(),location:$(".logalbumelected input[name=location]").val()},function(d){if(d!=false){$(".albumuploaddescription").html($(".uploadalbumselected .logalbumelected li").html());$(".albumuploaddescription input[name=title]").val($(".logalbumelected input[name=title]").val());$(".albumuploaddescription textarea[name=description]").val($(".logalbumelected textarea[name=description]").val());$(".albumuploaddescription input[name=keywords]").val($(".logalbumelected input[name=keywords]").val());$(".albumuploaddescription input[name=cityname]").val($(".logalbumelected input[name=cityname]").val());$(".albumuploaddescription input[name=cityname]").attr("data-id",$(".logalbumelected input[name=cityname]").attr("data-id"));$(".albumuploaddescription input[name=citynameaccent]").val($(".logalbumelected input[name=citynameaccent]").val());$(".albumuploaddescription select[name=category]").val($(".logalbumelected select[name=category] option:selected").val());$(".albumuploaddescription select[name=country]").val($(".logalbumelected select[name=country] option:selected").val());$(".albumuploaddescription input[name=placetakenat]").val($(".logalbumelected input[name=placetakenat]").val());$(".albumuploaddescription input[name=location]").val($(".logalbumelected input[name=location]").val());$(".uploadalbumselected .logalbumelected li .formcontainercreatealbum").attr("data-value",$(".logalbumelected div.privacyclass.active").attr("data-value"));$(".ax-file-list .privacyclass").each(function(){$(this).attr("id",$(".logalbumelected div.privacyclass.active").attr("id"));$(this).attr("data-value",$(".logalbumelected div.privacyclass.active").attr("data-value"));$(this).click()});$("#albumlist").find("#"+CatalogID()).html($(".logalbumelected input[name=title]").val());$(".uploadalbumselected .logalbumelected li .formcontainercreatealbum").html(t("ALBUM NAME:")+" "+$(".logalbumelected input[name=title]").val());if($(".uploadalbumselected .uploadinfocheckbox_apply4").hasClass("active")){var e=CopyFormtab2($(".uploadalbumselected"));if(e!=""){$.ajax({url:ReturnLink("/up_savenew.php"),type:"post",data:{S:$("#S").val(),privacyArray:b,privacyValue:c,myformarr:e,title:getObjectData($(".logalbumelected input[name=title]")),cityname:$(".logalbumelected input[name=cityname]").val(),cityid:$(".logalbumelected input[name=cityname]").attr("data-id"),citynameaccent:$(".logalbumelected input[name=citynameaccent]").val(),is_public:$(".logalbumelected div.privacyclass.active").attr("data-value"),description:getObjectData($(".logalbumelected textarea[name=description]")),catalog_id:CatalogID(),category:$(".logalbumelected select[name=category] option:selected").val(),placetakenat:getObjectData($(".logalbumelected input[name=placetakenat]")),keywords:getObjectData($(".logalbumelected input[name=keywords]")),country:$(".logalbumelected select[name=country] option:selected").val(),location:$(".logalbumelected input[name=location]").val(),defaultcatalogicon:0},success:function(f){if(f!=""){FileUploadSaved()}$(".uploadalbumselected .uploadinfocheckbox").removeClass("active")},error:function(g,h,f){$(".uploadalbumselected .uploadinfocheckbox").removeClass("active")}})}else{$(".upload-overlay-loading-fix-file").hide();$(".uploadalbumselected .uploadinfocheckbox").removeClass("active")}}else{$(".upload-overlay-loading-fix-file").hide()}}})}});$(document).on("click",".uploadalbumselected .togb",function(){var b=$(this);var a=$(this).parent().parent();if(b.hasClass("openclose")){$("div.formcontainer",$(".uploadalbumselected")).show();a.animate({height:"450px"},500,function(){b.removeClass("openclose").addClass("closeclose");$(window).resize()})}else{$("div.formcontainer",$(".uploadalbumselected")).hide();a.animate({height:"76px"},500,function(){b.removeClass("closeclose").addClass("openclose");$(window).resize()})}});$(document).on("click",".uploadalbumselected .ClearNewAlbumButton",function(){var a=$(this).parent().parent().parent().parent().find(".licorner").find(".togb");a.click()})}$(document).on("mouseover",".openclose",function(){$(this).find(".openclose_overtxt").html(t("expand"))});$(document).on("mouseover",".closeclose",function(){$(this).find(".openclose_overtxt").html(t("collapse"))});$(document).on("click",".uploadinfocheckbox",function(){if($(this).hasClass("active")){$(this).removeClass("active");if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friendsdata").remove()}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friends_of_friends_data").remove()}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#followersdata").remove()}}else{if($(this).hasClass("uploadinfocheckbox_apply4")){$(".ax-file-list li").each(function(){$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").hide();$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").removeClass("active");$(this).find(".licorner .togb").show()})}else{if($(this).hasClass("uploadinfocheckbox_apply3")){$(this).parent().parent().parent().find(".togb").show()}}}}}}else{if(!$(this).hasClass("uploadinfocheckbox_apply3")){$(this).addClass("active")}if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){var c='<div class="peoplesdata formttl13" id="friendsdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(c)}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){var b='<div class="peoplesdata formttl13" id="friends_of_friends_data" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends of friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(b)}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){var b='<div class="peoplesdata formttl13" id="followersdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("followers")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(b)}}else{if($(this).hasClass("uploadinfocheckbox_apply4")){TTAlert({msg:t("All checked entries are taking now the same description. You can uncheck the entry for which another description applies."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});var a=$(this).parent().parent().parent().parent().parent().attr("id");$(".ax-file-list li").each(function(){if($(this).find(".togb").css("display")!="none"){if($(this).attr("id")!=a){var e=$(this).find(".togb.closeclose");e.click();$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").addClass("active");$(this).find(".uploadinfocheckboxcontainer .uploadinfocheckbox_apply4").removeClass("active");$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").show();$(this).find(".licorner .togb").hide()}else{$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").hide();$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").addClass("active")}}})}else{if($(this).hasClass("uploadinfocheckbox_apply3")){var d=$(this).parent().parent().parent().find(".togb.closeclose");d.click();$(this).parent().parent().parent().find(".togb").hide();$(this).addClass("active")}}}}}}});$(document).on("click",".peoplesdataclose",function(){var a=$(this).parent();var b=a.parent().parent();a.remove();if(a.attr("data-id")!=""){SelectedUsersDelete(a.attr("data-id"),b.find(".addmore input"))}if(a.attr("id")=="friendsdata"){b.find(".uploadinfocheckbox3").removeClass("active")}else{if(a.attr("id")=="followersdata"){b.find(".uploadinfocheckbox4").removeClass("active")}else{if(a.attr("id")=="connectionsdata"){b.find(".uploadinfocheckbox5").removeClass("active")}else{if(a.attr("id")=="sponsorssdata"){b.find(".uploadinfocheckbox6").removeClass("active")}else{if(a.attr("id")=="friends_of_friends_data"){b.find(".uploadinfocheckbox_friends_of_friends").removeClass("active")}}}}}});$(document).on("click",".UploadMediaRightTF .LaterButton",function(){var a=$(this).closest("li");if(formIsFilled(a)){updatePicDataLater(a)}else{if(currentsection=="upload-album"&&a.find(".uploadinfocheckbox1").hasClass("active")){updatePicDataLater(a)}else{a.remove();removeCheckBoxSameDescription()}}TTAlert({msg:t("To view this photo or video check your pending list."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})});$(document).on("click",".UploadMediaLeftTF .privacyclass",function(){$(".privacyclass",$(this).parent().parent()).removeClass("active");$(this).addClass("active");var b=parseInt($(this).attr("data-value"));var a=$(this).parent().parent().parent();$(".uploadinfomandatory span",a).html("");switch(b){case USER_PRIVACY_PRIVATE:initResetSelectedUsers($(this).closest(".tableform").find(".peoplecontainer_custom"));$(".uploadinfomandatory",a).addClass("inactive");$(".uploadinfomandatorytitle",a).removeClass("inactive");break;case USER_PRIVACY_SELECTED:$(this).closest(".tableform").find(".peoplecontainer_custom").show();$(".uploadinfomandatory",a).addClass("inactive");$(".uploadinfomandatorytitle",a).removeClass("inactive");$(".uploadinfomandatorycategory",a).removeClass("inactive");$(".uploadinfomandatorycountry",a).removeClass("inactive");$(".uploadinfomandatorycitynameaccent",a).removeClass("inactive");break;default:initResetSelectedUsers($(this).closest(".tableform").find(".peoplecontainer_custom"));$(".uploadinfomandatory",a).addClass("inactive");$(".uploadinfomandatorytitle",a).removeClass("inactive");$(".uploadinfomandatorycategory",a).removeClass("inactive");$(".uploadinfomandatorycountry",a).removeClass("inactive");$(".uploadinfomandatorycitynameaccent",a).removeClass("inactive");break}});if((typeof currentsection==="undefined")||(currentsection!=="upload-album")){if(parseInt(txt_id)!=0&&txt_id!=""&&currentsection=="upload-album"){$("#albumlist").val($("#albumlist #"+txt_id).val());$("#albumlist").change()}}});function initResetSelectedUsers(a){a.hide();resetSelectedUsers(a.find(".addmore input"));a.find(".uploadinfocheckbox").removeClass("active");a.find(".addmore input").val("");a.find(".addmore input").blur();a.find(".peoplesdata").each(function(){var b=$(this);b.remove()})}var MAX_AUTO_RETRY=3;function showHideSameDescription(){if(currentsection=="upload-album"){if($(".ax-file-list li.success").length>0){$(".uploadinfocheckbox_apply4").show()}else{$(".uploadinfocheckbox_apply4").hide()}}else{if($(".ax-file-list li.success").length>1){$(".uploadinfocheckbox_apply4").show()}else{$(".uploadinfocheckbox_apply4").hide()}}}function setDragElement(c,a,d,b){}var global_catalog_id=null;function CatalogID(a){if(typeof a=="undefined"){return global_catalog_id}else{global_catalog_id=a}}function doalbumdatadisplay(b){var a=parseInt($(b).val());boolloderappear=false;if(a!=0){$(".upload-overlay-loading-fix").show();$(".upload2 #log").html("");$(".uploadalbum").hide();$(".uploadalbum").css("height","0px");$("."+currentlogalbumaddid+" .UploadMediaRightTF .ClearNewAlbumButton").click();$("div.formcontainer",$(".uploadalbumselected")).hide();$(".uploadalbumselected .logalbumelected li").animate({height:"76px"},500,function(){$(".uploadalbumselected .logalbumelected li .togb").removeClass("closeclose").addClass("openclose");$(window).resize()});CatalogID(a);$.post(ReturnLink("/ajax/ajax_getalbumuploaddata.php"),{id:a},function(c){if(c!=false){$(".uploadalbumselected .logalbumelected li").html(c);$(".uploadalbumselected .logalbumelected li textarea[name=description]").blur();$(".uploadalbumselected .logalbumelected li input[name=placetakenat]").blur();$(".uploadalbumselected .logalbumelected li input[name=keywords]").blur();addAutoComplete("logalbumelected");var d=parseInt($(".uploadalbumselected .logalbumelected li .formcontainercreatealbum").attr("data-value"));$(".uploadalbumselected .logalbumelected li #privacyclass_user"+d).click();$(".uploadalbumselected").show();$("#real_upload").show();if(d==USER_PRIVACY_SELECTED){$(".uploadalbumselected .logalbumelected li").find(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){var e=$(this);if(e.attr("id")=="friendsdata"){}else{if(e.attr("id")=="friends_of_friends_data"){}else{if(e.attr("id")=="followersdata"){}else{if(parseInt(e.attr("data-id"))!=0){SelectedUsersAdd(e.attr("data-id"))}}}}})}$(".upload-overlay-loading-fix").hide();boolloderappear=true;$(".albumuploaddescription").html($(".uploadalbumselected .logalbumelected li").html());addmoreusersautocomplete_custom_journal($(".uploadalbumselected .logalbumelected li #addmoretext_privacy"))}})}}function getImagesAlbum(){$(".upload-overlay-loading-fix").show();$.post(ReturnLink("/ajax/ajax_getalbumuploaddatapics.php"),{id:CatalogID()},function(a){if(a!=false){$(".getalbumuploaddatapics").html(a);if(boolloderappear){$(".upload-overlay-loading-fix").hide()}boolloderappear=true}})}function CopyForm(d){var a=new Array();var b="";if(currentsection=="upload-album"){d.find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").addClass("active");if(d.find(".uploadinfocheckbox1").hasClass("active")){d.find(".tableform input[name=title]").val($(".albumuploaddescription input[name=title]").val());d.find(".tableform input[name=cityname]").val($(".albumuploaddescription input[name=cityname]").val());d.find(".tableform input[name=cityname]").attr("data-id",$(".albumuploaddescription input[name=cityname]").attr("data-id"));d.find(".tableform input[name=citynameaccent]").val($(".albumuploaddescription input[name=citynameaccent]").val());d.find(".tableform textarea[name=description]").val($(".albumuploaddescription textarea[name=description]").val());d.find(".tableform input[name=placetakenat]").val($(".albumuploaddescription input[name=placetakenat]").val());d.find(".tableform input[name=keywords]").val($(".albumuploaddescription input[name=keywords]").val());d.find(".tableform input[name=location]").val($(".albumuploaddescription input[name=location]").val());d.find(".tableform select[name=category]").val($(".albumuploaddescription select[name=category] option:selected").val());d.find(".tableform select[name=country]").val($(".albumuploaddescription select[name=country] option:selected").val())}var e="#"+d.attr("id");var c=$(e+" input[name=vName]").val()+"[*]"+$(e+" input[name=vPath]").val()+"[*]"+$(e+" input[name=vSize]").val()+"[*]"+$(e+" input[name=lattitude]").val()+"[*]"+$(e+" input[name=longitude]").val()+"[*]"+$(e+" input[name=vid]").val()+"[*]"+e;a.push(c);b=a.join("/*/")}return b}function CopyFormLater(b){var a="";if(currentsection=="upload-album"){if(b.find(".uploadinfocheckbox1").hasClass("active")){b.find(".tableform input[name=title]").val($(".albumuploaddescription input[name=title]").val());b.find(".tableform input[name=cityname]").val($(".albumuploaddescription input[name=cityname]").val());b.find(".tableform input[name=cityname]").attr("data-id",$(".albumuploaddescription input[name=cityname]").attr("data-id"));b.find(".tableform input[name=citynameaccent]").val($(".albumuploaddescription input[name=citynameaccent]").val());b.find(".tableform textarea[name=description]").val($(".albumuploaddescription textarea[name=description]").val());b.find(".tableform input[name=placetakenat]").val($(".albumuploaddescription input[name=placetakenat]").val());b.find(".tableform input[name=keywords]").val($(".albumuploaddescription input[name=keywords]").val());b.find(".tableform input[name=location]").val($(".albumuploaddescription input[name=location]").val());b.find(".tableform select[name=category]").val($(".albumuploaddescription select[name=category] option:selected").val());b.find(".tableform select[name=country]").val($(".albumuploaddescription select[name=country] option:selected").val())}}var c="#"+b.attr("id");var a=getObjectData($(c+" input[name=title]"));a+="[*]"+getObjectData($(c+" textarea[name=description]"));a+="[*]"+getObjectData($(c+" input[name=keywords]"));a+="[*]"+$(c+" select[name=category] option:selected").val();a+="[*]"+$(c+" select[name=country] option:selected").val();a+="[*]"+$(c+" input[name=cityname]").val();a+="[*]"+$(c+" input[name=citynameaccent]").val();a+="[*]"+getObjectData($(c+" input[name=placetakenat]"))+"[*]";a+=($(c+" .uploadinfocheckbox2").hasClass("active"))?1:0;a+="[*]"+$(c+" input[name=cityname]").attr("data-id");return a}function CopyFormtab2(c){var a=new Array();var b="";if(currentsection=="upload-album"){c.find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").addClass("active");if(c.find(".uploadinfocheckbox_apply4").hasClass("active")){c.find(".tableform .showthumblink_album").remove()}$(".ax-file-list li .licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3.active").each(function(){var e="#"+$(this).parent().parent().parent().attr("id");var d=$(e+" input[name=vName]").val()+"[*]"+$(e+" input[name=vPath]").val()+"[*]"+$(e+" input[name=vSize]").val()+"[*]"+$(e+" input[name=lattitude]").val()+"[*]"+$(e+" input[name=longitude]").val()+"[*]"+$(e+" input[name=vid]").val()+"[*]"+e;a.push(d)});b=a.join("/*/")}return b}function CopyFormtab1(c){var a=new Array();var b="";if(currentsection!="upload-album"){c.find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").addClass("active");if(c.find(".uploadinfocheckbox_apply4").hasClass("active")){c.find(".tableform .showthumblink_album").remove()}$(".ax-file-list li .licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3.active").each(function(){var e="#"+$(this).parent().parent().parent().attr("id");var d=$(e+" input[name=vName]").val()+"[*]"+$(e+" input[name=vPath]").val()+"[*]"+$(e+" input[name=vSize]").val()+"[*]"+$(e+" input[name=lattitude]").val()+"[*]"+$(e+" input[name=longitude]").val()+"[*]"+$(e+" input[name=vid]").val()+"[*]"+e;a.push(d)});b=a.join("/*/")}return b}function formIsFilled(a){var b=false;if(getObjectData($("input[name=title]",a))!=""&&$("input[name=title]",a).length>0){b=true}else{if(getObjectData($("input[name=citynameaccent]",a))!=""&&$("input[name=citynameaccent]",a).length>0){b=true}else{if(getObjectData($("textarea[name=description]",a))!=""&&$("textarea[name=description]",a).length>0){b=true}else{if(getObjectData($("input[name=placetakenat]",a))!=""&&$("input[name=placetakenat]",a).length>0){b=true}else{if(getObjectData($("input[name=keywords]",a))!=""&&$("input[name=keywords]",a).length>0){b=true}else{if(getObjectData($("select[name=category]",a))!="0"){b=true}}}}}}return b}function removeCheckBoxSameDescription(){if(currentsection!="upload-album"){$(".ax-file-list li").each(function(){if($(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox3").css("display")!="none"){var a=$(this).find(".togb");a.show()}$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").hide();$(this).find(".licorner .uploadinfocheckboxAllcontainer .uploadinfocheckbox_apply3").removeClass("active")})}}function updatePicDataLater(d){var c=CopyFormLater(d);var b=d.find(".tableform");var g=b.find(".privacyclass.active").attr("data-value");var e=new Array();var i=new Array();if(g==USER_PRIVACY_SELECTED){b.find(".peoplecontainer_custom .emailcontainer .peoplesdata").each(function(){var j=$(this);if(j.attr("id")=="friendsdata"){e.push(USER_PRIVACY_COMMUNITY)}else{if(j.attr("id")=="followersdata"){e.push(USER_PRIVACY_FOLLOWERS)}else{if(parseInt(j.attr("data-id"))!=0){i.push(j.attr("data-id"))}}}});if(e.length>=2){i=new Array()}if(e.length>=1){g=e.join(",")}e=i}var f=""+e.join(",");var a=CatalogID();if(currentsection=="upload"&&d.find(".catalog_class").length>0){a=d.find(".catalog_class").val()}$(".upload-overlay-loading-fix").show();var h="#"+d.attr("id");$.post(ReturnLink("/ajax/up_savelater.php"),{myformarr:c,filename:$(h+" input[name=vName]").val(),catalog_id:a,privacyValue:g,privacyArray:f},function(j){d.remove();removeCheckBoxSameDescription();$(".upload-overlay-loading-fix").hide()})}$(document).ready(function(){var a=false;$("#real_upload").ajaxupload({allowExt:["jpeg","jpg","tif","tiff","bmp","png","gif","wmv","mov","flv","mp4","avi","mts","m4v"],autoStart:false,async:true,chunkSize:1048576,enable:true,maxFiles:9999,maxConnections:6,maxFileSize:ServerMaxFileSize+"M",url:ReturnLink("/upload_real2.php"),previews:false,onStart:function(b){},onPreview:function(){},onInit:function(b){$(".ax-upload-all").remove();$(".ax-clear").remove();$(".ax-upload").hide()},onSelect:function(e){for(var f=0;f<e.length;f++){var b=new Date();var h=b.getTime();e[f].id=h;e[f].originalName=e[f].name;var c=h+"."+e[f].ext;e[f].name=c;var g=getIsImage(e[f].name);e[f].li.attr({id:"realupload_"+e[f].id,"data-isimage":g,"data-id":e[f].id}).css({height:"92px"});e[f].li.find(".ax-upload").click();createImage(e[f],e[f].id)}},beforeUpload:function(c,b){return true},beforeUploadAll:function(b){return true},onProgress:function(b){console.log("progress bar");console.log(b)},success:function(g){var b=$("#real_upload").data("AU");var f=b.files;for(var d=0;d<f.length;d++){var e=f[d];if(e.name==g){console.log(e);var h=e.info;if(!h){return}e.details.html(h.msg);e.li.addClass("success");e.li.find("div.ax-progress-bar").css({width:"100%","background-color":"#73c563","background-image":"none"});e.li.find("div.licorner .openclose").show();e.li.find(".ax-toolbar .ax-upload").remove();showHideSameDescription();var i=e.details[0].childNodes[3].defaultValue;e.li.find(".ax-prev-container").html("<img class='stanleftin' src='"+i+"'>");fileCount++}}if(!$(".ax-file-list li").find(".togb").hasClass("closeclose")&&!a){$(".ax-file-list li.success").first().find(".togb").click();a=true}},finish:function(c,b){console.log(b)},error:function(e,i){if(!e){console.log(i);var b=$("#real_upload").data("AU");var h=b.files;for(var d=0;d<h.length;d++){var g=h[d];if(g.name==i){setTimeout(function(){g.li.find(".ax-toolbar .ax-upload").click()},1000)}}return false}var f=e.split(":");if(f.length<2){return}f=f[0];if(f=="File size now allowed"){TTAlert({msg:f+"<br/>maximum size: "+ServerMaxFileSize+"mb",type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{if(f=="Extension not allowed"){TTAlert({msg:"File extension error, Please use: jpg,gif,png,tiff,tif,bmp,jpeg,wmv,mov,flv,mp4,avi,mts,m4v",type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{if(f=="ReferenceError"){TTAlert({msg:t("Error: ")+i+" "+f,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}}}}})});