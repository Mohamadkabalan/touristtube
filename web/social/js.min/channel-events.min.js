var currentpage=0;var fr_txt="";var to_txt="";var TO_CAL;var jscrollpane_apiE=null;function initscrollPane(){$(".scrollpane").jScrollPane();jscrollpane_apiE=$(".scrollpane").data("jsp")}function addCalTo(a){if(new Date($("#fromtxt").attr("data-cal"))>new Date($("#totxt").attr("data-cal"))){$("#totxt").attr("data-cal",$("#fromtxt").attr("data-cal"));$("#totxt").html($("#fromtxt").html())}}function InitDocument(){$(".channelevtTime").on("click",function(){var a=$(this).parent();if(itempressed==a){return}$("#commentDiv .shadow").each(function(e,d){if(!$(this).hasClass("hide")){$(this).find(".closeDiv").click()}});$(".disabledmessage").addClass("displaynone");$(".meStanDiv").addClass("displaynone");$(".notsigned").val("");$(".notsigned").blur();currentpage_like=0;$(".social_data_all").attr("data-page-like",0);currentpage_comments=0;$(".social_data_all").attr("data-page-comments",0);currentpage_shares=0;$(".social_data_all").attr("data-page-shares",0);if(itempressed!=""){itempressed.find(".butEditChannelRight_data").attr("id","edit_event_");itempressed.find(".butEditChannelRight_data").addClass("displaynone");$(".plupload.html5").remove();itempressed.find(".edit_eventtitle_buts1").click()}$(".social_data_all").attr("data-id",a.attr("data-id"));$(".itemList").removeClass("selected");a.addClass("selected");a.find(".butEditChannelRight_data").removeClass("displaynone");if(parseInt(is_owner)==1){a.find(".butEditChannelRight_data").attr("id","edit_event_"+a.attr("data-id"));InitChannelUploaderHome(a.find(".butEditChannelRight_data").attr("id"),"event_content",15,0)}var c=a.offset().top-a.parent().parent().offset().top;if(jscrollpane_apiE!=null){jscrollpane_apiE.scrollToY(c,true)}if(a.index()>0){showScrollBar()}else{hideScrollBar()}initLikes($(".social_data_all"));initJoins($(".social_data_all"));initSponsors($(".social_data_all"));if(parseInt(a.attr("data-enable"))==1||parseInt(is_owner)==1){$(".btn_enabled").show();initComments($(".social_data_all"));initShares($(".social_data_all"))}else{$(".btn_enabled").hide()}if(parseInt(a.attr("data-enable-sponsor"))==0){$(".btn_sponsors,.btn_txt_sponsors").hide()}else{$(".btn_sponsors,.btn_txt_sponsors").show()}var b=parseInt(a.attr("data-enable"));if(b==0){$(".overdatabutenableevents").attr("data-status",0);$(".overdatabutenableevents .overdatabutntficon").addClass("inactive")}else{$(".overdatabutenableevents").attr("data-status",1);$(".overdatabutenableevents .overdatabutntficon").removeClass("inactive")}itempressed=a})}function InitCalendar(){if($("#fromtxt").length>0){Calendar.setup({inputField:"fromtxt",noScroll:true,trigger:"frombutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());TO_CAL.args.min=a;TO_CAL.redraw();$("#fromtxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalTo(this);this.hide()},disabled:function(b){var a=new Date();a.setHours(12,30,0,0);return(b>a)},dateFormat:"%d / %m / %Y"});TO_CAL=Calendar.setup({inputField:"totxt",noScroll:true,trigger:"tobutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());$("#totxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalTo(this);this.hide()},disabled:function(b){var a=new Date();a.setHours(12,30,0,0);return(b>a)},dateFormat:"%d / %m / %Y"})}}function hideScrollBar(){}function showScrollBar(){if($("#event_content .itemList").size()<=7){$("#event_content .jspVerticalBar").show()}}$(document).ready(function(){initCalendarEvents();InitCalendar();InitDocument();initscrollPane();hideScrollBar();initSocialFunctions();initReportFunctions($("#report_button"));$("#searchCalendarbut").click(function(){if($("#fromtxt").html()!=""||$("#totxt").html()!=""){fr_txt=""+$("#fromtxt").attr("data-cal");to_txt=""+$("#totxt").attr("data-cal");currentpage=0;$("#container_upcoming_events").html("");$("#container_past_events").html("");getEventsDataRelated()}});$(".newsList .itemList").first().find(".channelevtTime").click();$(".more").toggle(function(){$(this).text("< less").siblings(".teaser").hide().siblings(".complete").show();initscrollPane()},function(){$(this).text("> more").siblings(".teaser").show().siblings(".complete").hide();initscrollPane()});$(document).on("click",".topArrow",function(){if($(".top_buttons_container").css("display")!="none"){$(".top_buttons_container").hide()}else{$(".top_buttons_container").show()}});$(document).on("click","#hide_button",function(){if(itempressed!=""){updateeventpagedata("is_visible",0,itempressed.attr("data-id"),itempressed)}});$(document).on("click","#hide_buttonviewer",function(){if(itempressed!=""){itempressed.remove();$(".newsAll_inside .itemList").first().find(".channelevtTime").click();if($(".loadmoreevents").css("display")!="none"){$(".loadmoreevents").click()}else{initscrollPane()}}});$(document).on("click","#edit_button",function(){if(itempressed!=""){var a=itempressed.find(".channelevtImg").closest("a").attr("href");window.location.href=a}});$(document).on("click","#remove_button",function(){if(itempressed!=""){removeevent(itempressed)}});$(document).on("click",".edit_eventtitle_buts1",function(){$(this).parent().parent().hide()});$(document).on("click",".edit_eventtitle_buts2",function(){var b=$(this).parent().parent();var c=b.find("#edit_eventtitle_txt").val();if(!c.length){return}var d=c.replace(/\n/g," ");var a=b.parent();updateeventpagedata("name",d,a.attr("data-id"),a)});$(document).on("click",".hideText",function(){var a=$(this).parent().parent();updateeventpagedata("is_visible",1,a.attr("data-id"),a)});$(document).on("click",".overdatabutenableevents",function(){var a=$(this);if(String(""+a.attr("data-status"))=="1"){if(itempressed!=""){enableSharesComments_event(itempressed,0)}a.attr("data-status","0");a.find(".overdatabutntficon").addClass("inactive")}else{if(itempressed!=""){enableSharesComments_event(itempressed,1)}a.attr("data-status","1");a.find(".overdatabutntficon").removeClass("inactive")}});$(".loadmoreevents").click(function(a){a.preventDefault();a.stopImmediatePropagation();currentpage++;getEventsDataRelated()})});function updateeventpagedata(c,d,a,b){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_event_update.php"),data:{globchannelid:channelGlobalID(),str:c,data:d,id:a},type:"post",success:function(e){if(c=="name"){b.find(".eventName").html(d);b.find(".edit_eventtitle_buts1").click()}else{if(c=="is_visible"){if(parseInt(d)==0){b.find(".hideitems").removeClass("displaynone");b.addClass("inactive");b.find(".edit_eventtitle_buts1").click()}else{b.find(".hideitems").addClass("displaynone");b.removeClass("inactive")}}}$(".upload-overlay-loading-fix").hide()}})}function removebrochure(b){var a=b.attr("data-id");TTAlert({msg:t("confirm to remove selected brochure"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(c){if(c){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_brochure_remove.php"),data:{globchannelid:channelGlobalID(),id:a},type:"post",success:function(d){if(d){var g=b.index();if(g==0){g=1}else{g=g-1}var f=$(".newsAll_inside .itemList").eq(g);b.remove();initscrollPane();f.find(".channelevtTime").click()}$(".upload-overlay-loading-fix").hide()}})}}})}function removeevent(b){var a=b.attr("data-id");TTAlert({msg:t("Canceling this event cannot be undone.<br/>This action deletes it from all joining people's event's list."),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(c){if(c){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_event_remove.php"),data:{globchannelid:channelGlobalID(),id:a},type:"post",success:function(d){if(d){var g=b.index();if(g==0){g=1}else{g=g-1}var f=$(".newsAll_inside .itemList").eq(g);b.remove();initscrollPane();f.find(".channelevtTime").click()}$(".upload-overlay-loading-fix").hide()}})}}})}function enableSharesComments_event(a,b){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/info_event_update.php"),data:{globchannelid:channelGlobalID(),str:"enable_share_comment",data:b,id:a.attr("data-id")},type:"post",success:function(c){a.attr("data-enable",b);$(".upload-overlay-loading-fix").hide()}})}function share_selectDisabled(b){var a=$(b).parent();a.find(".disabledmessage").removeClass("displaynone")}function getEventsDataRelated(){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/ajax_loadmoreevents.php"),data:{txt_srch_init:txt_srch_init,globchannelid:channelGlobalID(),currentpage:currentpage,frtxt:fr_txt,totxt:to_txt},type:"post",success:function(a){var c=null;try{c=$.parseJSON(a)}catch(b){return}if(c.error){TTAlert({msg:c.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{$("#container_upcoming_events").append(c.upcoming_events);$("#container_past_events").append(c.past_events);if(c.hide_loadmore_button==1){$(".loadmoreevents").hide()}else{$(".loadmoreevents").show()}if(c.ev_count==0){$(".social_data_all").hide();$(".newsAll_inside .channelyellowevsubTttl").hide();$(".newsverticalline").hide()}else{$(".social_data_all").show();$(".newsAll_inside .channelyellowevsubTttl").show();$(".newsverticalline").show()}initscrollPane();InitDocument()}}});$(".upload-overlay-loading-fix").hide()}function updateImage(c,b,a){if(a=="edit_event"){if(itempressed!=""){itempressed.find(".channelevtImg img").remove();itempressed.find(".channelevtImg").append(c);updateeventpagedata("photo",b,itempressed.attr("data-id"),itempressed)}}closeFancyBox()};