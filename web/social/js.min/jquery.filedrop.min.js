(function(a){jQuery.event.props.push("dataTransfer");var v={},d={url:"",refresh:1000,paramname:"userfile",maxfiles:25,maxfilesize:1,data:{},drop:p,dragEnter:p,dragOver:p,dragLeave:p,docEnter:p,docOver:p,docLeave:p,beforeEach:p,afterAll:p,rename:p,error:function(e,A,B){alert(e)},uploadStarted:p,uploadFinished:p,progressUpdated:p,speedUpdated:p,cancelUpload:p},q=["BrowserNotSupported","TooManyFiles","FileTooLarge"],f,y=false,s=0,r;a.fn.filedrop=function(e){v=a.extend({},d,e);this.bind("drop",n).bind("dragenter",k).bind("dragover",m).bind("dragleave",l);a(document).bind("drop",g).bind("dragenter",h).bind("dragover",j).bind("dragleave",i)};function n(A){v.drop(A);r=A.dataTransfer.files;if(r===null||r===undefined){v.error(q[0]);return false}s=r.length;z();A.preventDefault();return false}function t(E,D,e){var C="--",B="\r\n",A="";a.each(v.data,function(F,G){if(typeof G==="function"){G=G()}A+=C;A+=e;A+=B;A+='Content-Disposition: form-data; name="'+F+'"';A+=B;A+=B;A+=G;A+=B});A+=C;A+=e;A+=B;A+='Content-Disposition: form-data; name="'+v.paramname+'"';A+='; filename="'+E+'"';A+=B;A+="Content-Type: application/octet-stream";A+=B;A+=B;A+=D;A+=B;A+=C;A+=e;A+=C;A+=B;return A}function w(C){if(C.lengthComputable){var E=Math.round((C.loaded*100)/C.total);if(this.currentProgress!=E){this.currentProgress=E;v.progressUpdated(this.index,this.file,this.currentProgress);var D=new Date().getTime();var B=D-this.currentStart;if(B>=v.refresh){var A=C.loaded-this.startData;var F=A/B;v.speedUpdated(this.index,this.file,F);this.startData=C.loaded;this.currentStart=D}}}}function z(){y=false;if(!r){v.error(q[0]);return false}var A=0,B=0;if(s>v.maxfiles){v.error(q[1]);return false}for(var C=0;C<s;C++){if(y){return false}try{if(c(r[C])!=false){if(C===s){return}var E=new FileReader(),D=1048576*v.maxfilesize;E.index=C;if(r[C].size>D){v.error(q[2],r[C],C);B++;continue}E.onloadend=F;E.readAsBinaryString(r[C])}else{B++}}catch(e){v.error(q[0]);return false}}function F(I){if(I.target.index==undefined){I.target.index=u(I.total)}var N=new XMLHttpRequest(),M=N.upload,J=r[I.target.index],K=I.target.index,L=new Date().getTime(),G="------multipartformboundary"+(new Date).getTime(),H;newName=x(J.name);if(typeof newName==="string"){H=t(newName,I.target.result,G)}else{H=t(J.name,I.target.result,G)}M.index=K;M.file=J;M.downloadStartTime=L;M.currentStart=L;M.currentProgress=0;M.startData=0;M.addEventListener("progress",w,false);N.open("POST",v.url,true);N.setRequestHeader("content-type","multipart/form-data; boundary="+G);N.sendAsBinary(H);v.uploadStarted(K,J,s);N.onload=function(){if(N.responseText){var O=new Date().getTime(),Q=O-L,P=v.uploadFinished(K,J,N.responseText,Q);A++;if(A==s-B){b()}if(P===false){y=true}}}}}function u(A){for(var e=0;e<s;e++){if(r[e].size==A){return e}}return undefined}function x(e){return v.rename(e)}function c(e){return v.beforeEach(e)}function b(){return v.afterAll()}function k(A){clearTimeout(f);A.preventDefault();v.dragEnter(A)}function m(A){clearTimeout(f);A.preventDefault();v.docOver(A);v.dragOver(A)}function l(A){clearTimeout(f);v.dragLeave(A);A.stopPropagation()}function g(A){A.preventDefault();v.docLeave(A);return false}function h(A){clearTimeout(f);A.preventDefault();v.docEnter(A);return false}function j(A){clearTimeout(f);A.preventDefault();v.docOver(A);return false}function i(A){f=setTimeout(function(){v.docLeave(A)},200)}function p(){}try{if(XMLHttpRequest.prototype.sendAsBinary){return}XMLHttpRequest.prototype.sendAsBinary=function(A){function e(D){return D.charCodeAt(0)&255}var B=Array.prototype.map.call(A,e);var C=new Uint8Array(B);this.send(C.buffer)}}catch(o){}})(jQuery);