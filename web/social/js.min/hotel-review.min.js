var reviews_page=0;var one_object=0;var firstPageView=true;var shareFadeoutTimeout;function initReviewsDocuments(){$(".social_data_all").each(function(b,a){if($(this).find(".social_not_refreshed").length>0){initComments($(this));initLikes($(this));initShares($(this))}});$(".hotel_infos_imgbig1Up").each(function(c,b){var a=$(this);a.mouseover(function(){$(this).find(".clsimg.mediabuttons").show()});a.mouseout(function(){$(this).find(".clsimg.mediabuttons").hide()})});$(".mediabuttons").mouseover(function(){var a=$(this).closest(".hotel_infos_imgbig1Up");var b=a.offset().left-$("#thotel").offset().left-122;var c=a.offset().top-$("#thotel").offset().top-21;$(".evContainer2Over .ProfileHeaderOverin").html($(this).attr("data-title"));$(".evContainer2Over").css("left",b+"px");$(".evContainer2Over").css("top",c+"px");$(".evContainer2Over").stop().show()});$(".mediabuttons").mouseout(function(){$(".evContainer2Over").hide()});initReportsLog()}function initReportsLog(){$(".report_button_log_reason").each(function(){var b=$(this);var a=b.closest(".hotelReviewsContainer");b.removeClass("report_button_log_reason");initTTLogReportFunctions(b,a.find(".social_data_all"))})}function initscrollPane(a){a.jScrollPane()}var apiBig2=null;function initscrollPaneBig2(a){a.jScrollPane();apiBig2=a.data("jsp")}function getMoreReviews(){$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/ajax_load_reviews.php"),data:{page:reviews_page,entity_id:dataId,entity_type:dataType,one_object:one_object},type:"post",success:function(a){one_object=0;$(".upload-overlay-loading-fix").hide();var e=null;try{e=$.parseJSON(a)}catch(c){return}if(e.error){TTAlert({msg:e.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{var d=e.data;var b=e.count;$(".oldReviewsList").append(d);initReviewsDocuments();initCommentData();if(b-reviews_page*6>6){$(".reviews_more").show()}else{$(".reviews_more").hide()}}}})}function checkActive(){$(".oldReviewsImg a.active").each(function(){var a=$(this);var b=a.index();if(a.is(":last-child")){$(".img_next").hide()}else{$(".img_next").show()}if(b===0){$(".img_prev").hide()}else{$(".img_prev").show()}})}function centerImage(){var c=$(".review_large_img img");var a=530;var b=994;var e=a;var g=b;var h=$(".oldReviewsImg a.active").attr("data-height");var i=$(".oldReviewsImg a.active").attr("data-width");var k=g/i;var j=e/h;if(k<j){g=i*k;e=h*k}else{g=i*j;e=h*j}g=Math.round(g);e=Math.round(e);var d=(b-g)/2;var l=(a-e)/2;l=Math.round(l);d=Math.round(d);var f={top:l,width:g,height:e};c.css(f)}$(document).ready(function(){initscrollPane($(".scrollpane"));initscrollPaneBig2($(".oldReviewsImg_scroll"));initSocialActions();initReviewsDocuments();checkActive();centerImage();$(document).on("click",".addtomychannelBut",function(){var b=$("#channel_code").val();if(b==""){TTAlert({msg:t("please select one of your channels..."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}var c=$(".hotelsContainer").attr("data-id");var d=$(".hotelsContainer").attr("data-type");$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/ajax_add_discover_tochannel.php"),data:{id:c,data_type:d,channel_id:b},type:"post",success:function(e){$(".upload-overlay-loading-fix").hide();var g=null;try{g=$.parseJSON(e)}catch(f){return}if(g.status=="error"){TTAlert({msg:g.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{$("#channel_code").find("#channel_code"+b).remove()}}})});$(document).on("click","#remove_button_rev",function(){var b=$(this).closest(".hotelReviewsContainer");TTAlert({msg:t("are you sure you want to remove this review"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(c){if(c){$.ajax({url:ReturnLink("/ajax/ajax_remove_review.php"),data:{id:b.attr("data-id"),data_type:$(".hotelsContainer").attr("data-type")},type:"post",success:function(d){$(".upload-overlay-loading-fix").hide();var f=null;try{f=$.parseJSON(d)}catch(e){return}if(f.status=="error"){TTAlert({msg:f.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{b.remove();one_object=1;getMoreReviews()}}})}}})});var a=parent.window.returnIframeDimensions();$(".showOnMap").fancybox({width:a[0],height:a[1],closeBtn:true,autoSize:false,autoScale:true,transitionIn:"elastic",transitionOut:"fadeOut",type:"iframe",padding:0,margin:0,scrolling:"no",helpers:{overlay:{closeClick:true}}});$(document).on("click",".clsimg",function(c){var b=$(this).closest(".hotel_infos_imgbig1Up");var d=$(this).attr("data-id");TTAlert({msg:t("are you sure you want to remove permanently this image?"),type:"action",btn1:t("cancel"),btn2:t("confirm"),btn2Callback:function(e){if(e){$(".upload-overlay-loading-fix").show();TTCallAPI({what:"user/discover/remove_image",data:{id:d,entity_type:$(".hotelsContainer").attr("data-type"),},callback:function(f){$(".upload-overlay-loading-fix").hide();if(f.status==="error"){TTAlert({msg:f.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}b.remove();initscrollPane($(".scrollpane"))}})}}})});$(document).on("click",".hotel_infos_imgbig1",function(b){b.preventDefault();var c=$(this).attr("data-href");$(".hotel_infos_imgbigf1").attr("href",c);$(".hotel_infos_imgbigf1").click()});$(document).on("click",".oldReviewsImg a",function(c){c.preventDefault();var b=$(this);var f=b.index();var d=b.attr("href");$(".oldReviewsImg a").removeClass("active");$(".oldReviewsImg a .youAreHere").animate({bottom:"-44px"},500);b.addClass("active");b.find(".youAreHere").stop();b.find(".youAreHere").animate({bottom:"0px"},500);$(".review_large_img img").remove();$(".review_large_img").prepend('<img alt="" src="'+d+'" >');$(".review_large_img").attr("data-index",f);checkActive();centerImage();var g=b.closest(".jspPane");console.log((b.position().top+g.position().top));if((b.position().top+g.position().top)>300){var h=-(321-b.position().top-103);apiBig2.scrollToY(h,true)}else{if((b.position().top+g.position().top)<0){var h=b.position().top;console.log(h);apiBig2.scrollToY(h,true)}}});$(document).on("click",".img_next",function(){var b=$(".oldReviewsImg a.active").index()+1;$(".oldReviewsImg a:eq("+b+")").click()});$(document).on("click",".img_prev",function(){var b=$(".oldReviewsImg a.active").index()-1;$(".oldReviewsImg a:eq("+b+")").click()});$(".hotel_infos_imgbig").fancybox({helpers:{overlay:{closeClick:true}}});$(".hotel_infos_imgbigf1").fancybox({helpers:{overlay:{closeClick:true}}});if(parseInt(user_is_logged)!=0){InitChannelUploaderHome("uploadReview_Img","upload_posts_container",15,0)}$(document).on("mouseover",".GlobRate .eval_options_glob",function(){var b=$(this).attr("data-text");$(".GlobRate .eval_options_over .eval_options_overtxt").html(b);$(".GlobRate .eval_options_over").show()});$(document).on("mouseout",".GlobRate .eval_options_glob",function(){$(".GlobRate .eval_options_over").hide()});$(document).on("click",".GlobRate .eval_options_glob",function(){var b=$(this).index();if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to evaluate."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(e){if(e){window.location.href=ReturnLink("/register")}}});return}var c=$(this);var d=$(this).attr("data-value");TTCallAPI({what:ReturnLink("/ajax/modal_newsfeed_rate.php"),data:{entity_id:$(".hotelsContainer").attr("data-id"),entity_type:$(".hotelsContainer").attr("data-type"),score:d,globchannelid:null},ret:"json",callback:function(e){if(e.status=="error"){TTAlert({msg:e.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}$(".GlobRate .eval_options_glob").removeClass("active");c.addClass("active");$(".GlobRate .eval_options_glob").each(function(){var f=$(this).index();if(f<=b){$(this).addClass("active")}else{$(this).removeClass("active")}})}})});$(document).on("mouseover",".specificRate .eval_options_glob",function(){var b=$(this);var c=b.attr("data-text");b.parent().find(".eval_options_over .eval_options_overtxt").html(c);b.parent().find(".eval_options_over").show()});$(document).on("mouseout",".specificRate .eval_options_glob",function(){var b=$(this);b.parent().find(".eval_options_over").hide()});$(document).on("click",".specificRate .eval_options_glob",function(){var b=$(this).index();if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to evaluate."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(g){if(g){window.location.href=ReturnLink("/register")}}});return}var d=$(this);var c=d.closest(".specificRate");var f=d.attr("data-value");var e=d.closest(".specificRate").attr("data-type");TTCallAPI({what:ReturnLink("/ajax/modal_newsfeed_rate.php"),data:{entity_id:$(".hotelsContainer").attr("data-id"),entity_type:e,score:f,globchannelid:null},ret:"json",callback:function(g){if(g.status=="error"){TTAlert({msg:g.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}d.siblings().removeClass("active");d.addClass("active");c.find(".eval_options_glob").each(function(){var h=$(this).index();if(h<=b){$(this).addClass("active")}else{$(this).removeClass("active")}})}})});$(".revThemesOption").click(function(){if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to select themes."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(b){if(b){window.location.href=ReturnLink("/register")}}});return}$(this).toggleClass("active")});$(document).on("click",".rev_infocheckbox .uploadinfocheckboxpic",function(){if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to select options."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(c){if(c){window.location.href=ReturnLink("/register")}}});return}var b=$(this).parent();if(b.hasClass("active")){b.removeClass("active")}else{b.addClass("active")}});$(document).on("click",".learnMore",function(b){if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to learn more."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(e){if(e){window.location.href=ReturnLink("/register")}}});return}b.preventDefault();var f=$(this);var c=f.parent();var d=c.attr("data-val");f.hide();c.append(d)});$(document).on("click",".opt",function(){if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to check options."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(c){if(c){window.location.href=ReturnLink("/register")}}});return}var b=$(this);if(b.hasClass("active")){b.removeClass("active")}else{b.addClass("active")}});$(".evalOptionContainer").hover(function(){$(this).find(".toslide").stop().animate({left:"0px"},500)},function(){$(this).find(".toslide").stop().animate({left:"-150px"},500)});$(document).on("click",".reviews_more",function(){reviews_page++;getMoreReviews()});$(document).on("click",".submitReview",function(){if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to add reviews."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(i){if(i){window.location.href=ReturnLink("/register")}}});return}var h=$(".rev_description").val();var f=new Array();var c=$(".rev_select").val();var d=new Array();var b=($(".rev_infocheckbox.active").length==1);if(h===""){TTAlert({msg:t("Your review cannot be empty !"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(!b){TTAlert({msg:t("Your have to certify that this review is based on your own experience !"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}$(".revThemesOption.active").each(function(i){f.push($(this).attr("data-value"))});var g=f.join(",");$(".nearHotelOpt .opt.active").each(function(i){var j=$(this).attr("data-value");d.push(j)});var e=d.join(",");$.ajax({url:ReturnLink("/ajax/ajax_add_review.php"),data:{id:$(".hotelsContainer").attr("data-id"),data_type:$(".hotelsContainer").attr("data-type"),txt:h,themes:g,date:c,near:e},type:"post",success:function(i){$(".upload-overlay-loading-fix").hide();var k=null;try{k=$.parseJSON(i)}catch(j){return}if(k.status=="error"){TTAlert({msg:k.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{TTAlert({msg:k.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:function(l){location.reload()}})}}})});$(document).on("click",".MediaButton_data_share",function(){if($(".share_link_holder").css("display")!="none"){$(".share_link_holder").hide();$(".mediabuttonsOver").removeClass("inactive");$(this).removeClass("active")}else{$(".mediabuttonsOver").addClass("inactive");$(this).addClass("active");$(".share_link_holder").show();$(".mediabuttonsOver").hide();shareFadeoutTimeout=setTimeout(function(){$(".share_link_holder").hide();$(".mediabuttonsOver").removeClass("inactive");$(".MediaButton_data_share").removeClass("active")},1500);$(".share_link_holder").unbind("mouseenter mouseleave").hover(function(){clearTimeout(shareFadeoutTimeout);$(".share_link_holder").stop(true,true);$(".share_link_holder").show()},function(){shareFadeoutTimeout=setTimeout(function(){$(".share_link_holder").hide();$(".mediabuttonsOver").removeClass("inactive");$(".MediaButton_data_share").removeClass("active")},500)})}});$(document).on("change",".rev_select",function(){if(parseInt(user_is_logged)===0){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to select travel date."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(b){if(b){window.location.href=ReturnLink("/register")}}});return}});$(document).on("click",".uploadReviewImg",function(){if(parseInt(user_is_logged)===0){$(".TopRegisterLink").click();TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to add photo."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(b){if(b){window.location.href=ReturnLink("/register")}}});return}});$(".hotel_infos_imgbig2.active").click()});function updateImage(c,b,a){if(a=="uploadReview_Img"){TTCallAPI({what:"user/discover/add_image",data:{entity_type:$(".hotelsContainer").attr("data-type"),item_id:$(".hotelsContainer").attr("data-id"),filename:userGlobalDISName()+""+b},callback:function(d){if(d.status==="error"){TTAlert({msg:d.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}$(".aReviewImg .jspPane").prepend('<div class="hotel_infos_imgbig1Up"><div class="mediabuttonscontainer"><div data-title="remove" data-id="'+d.id+'" class="clsimg mediabuttons"></div></div><div data-href="'+ReturnLink("media/discover/large/"+userGlobalDISName()+b)+'" class="hotel_infos_imgbig1">'+c+"</div></div>");initscrollPane($(".scrollpane"));initReviewsDocuments()}})}closeFancyBox()}$(document).keydown(function(a){if(($(".img_next").length>0&&$(".img_next").css("display")!="none")||($(".img_prev").length>0&&$(".img_prev").css("display")!="none")){if(a.keyCode==39){if($(".img_next").length>0&&$(".img_next").css("display")!="none"){$(".img_next").click()}}else{if(a.keyCode==37){if($(".img_prev").length>0&&$(".img_prev").css("display")!="none"){$(".img_prev").click()}}}}});