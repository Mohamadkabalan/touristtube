var hotel_page=0;var TO_CAL;var destination;var country_code;var state_code;var city_code;var hotel_code;var room_val;var from;var to;var hotelClass;var priceRange;var accomType;var hotelPref;var tuberEvals;var orderBy="id";var direction="DESC";function returnLink(a){return a}function checkboxVal(b){var a=new Array();$("."+b).each(function(){if($(this).hasClass("checkboxActive")){var c=$(this).attr("data-value");a.push(c)}});return a}function setGuests(){var a="";if($("#guests_sel").val()===""){a=$("#guests_sel_rooms").val()+"-"+$("#guests_sel_adults").val()+"-"+$("#guests_sel_children").val()}else{a=$("#guests_sel").val()}$("#guests").val(a)}function setGuestsFields(){var b=$("#guests").val();if(b=="1-1-0"||b=="1-2-0"){$(".guestSelectGroup").hide();$("#guests_sel").val(b)}else{$(".guestSelectGroup").show();$("#guests_sel").val("");var a=b.split("-");$("#guests_sel_rooms").val(a[0]);$("#guests_sel_adults").val(a[1]);$("#guests_sel_children").val(a[2])}}function navigatePhotos(b,a,c){if(c!=""){$.post(ReturnLink("/ajax/ajax_hotel_search_media.php"),{hotel:b,from:a,to:c},function(d){var f=null;try{f=$.parseJSON(d)}catch(e){return}if(f.error){TTAlert({msg:f.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{$(".smallImgListCont[data-value='"+b+"']").html(f.media);$(".smallImgPrev[data-value='"+b+"']").attr("data-page",c);$(".smallImgPrev[data-value='"+b+"']").attr("data-to",f.mediaPrev);$(".smallImgNext[data-value='"+b+"']").attr("data-page",c);$(".smallImgNext[data-value='"+b+"']").attr("data-to",f.mediaNext)}})}}function redirectToThotel(d,c,i,f,g,b,h,a){var e=ReturnLink("/thotel/id/"+parseInt(d));if(c!=""){e+="/from/"+c}if(i!=""){e+="/to/"+i}if(f!=""){e+="/room/"+f}if(g!=""){e+="/s/"+g}if(b!=""){e+="/CO/"+b}if(h!=""){e+="/ST/"+h}if(a!=""){e+="/C/"+a}document.location.href=e}function filterSearch(){destination=$(".destinationInput").val();country_code=$(".destinationInput").attr("data-code");state_code=$(".destinationInput").attr("data-state-code");city_code=$(".destinationInput").attr("data-city");room_val=$("#guests").val();if(typeof $(".destinationInput").attr("data-hotel")!=="undefined"&&$(".destinationInput").attr("data-hotel")!="false"){hotel_code=$(".destinationInput").attr("data-hotel")}else{hotel_code=""}from=$("#fromtxt").attr("data-cal");to=$("#totxt").attr("data-cal");hotelClass=checkboxVal("hotelStarCheckbox");priceRange=checkboxVal("budgetCheckbox");accomType=checkboxVal("accomodationCheckbox");hotelPref=checkboxVal("hotelPrefCheckbox");tuberEvals=checkboxVal("tuberCheckbox");if(hotel_code!=""&&hotel_code!="undefined"){redirectToThotel(hotel_code,from,to,room_val,destination,country_code,state_code,city_code)}else{initHotelSearch(false)}}function initHotelSearch(a){if(!a){a=0;hotel_page=0;$(".allHotelsContainer").html("")}else{hotel_page++}$(".upload-overlay-loading-fix").show();$.post(ReturnLink("/ajax/ajax_hotel_search.php"),{orderBy:orderBy,direction:direction,room_val:room_val,hotel_page:hotel_page,destination:destination,country_code:country_code,city_code:city_code,state_code:state_code,from:from,to:to,hotelClass:hotelClass,priceRange:priceRange,accomType:accomType,hotelPref:hotelPref,tuberEvals:tuberEvals},function(d){var k=null;try{k=$.parseJSON(d)}catch(e){$(".upload-overlay-loading-fix").hide();return}if(k.error){TTAlert({msg:k.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{$(".allHotelsContainer").append(k.hotels);$(".hotelSearchHeadRightDesc").html(k.hotelSearchHeadRightDesc);$(".globDescContainerLeft").html(k.destinationDesc);$(".globDescContainerRightPrecent").html(k.percent);if(k.hotelsCount>(9*(hotel_page+1))){$(".buttonmorebigcontainer").show()}else{$(".buttonmorebigcontainer").hide()}$(".sortingOpt").removeClass("sortingActive");$(".sortElt").removeClass("sortingActive");$(".sortingOpt[data-value='"+orderBy+"']").addClass("sortingActive");$(".sortElt[data-value='"+orderBy+"'][data-direction='"+direction+"']").addClass("sortingActive");var b=$(".leftBlockMap");var c=b.attr("id");var f=new google.maps.MarkerImage(ReturnLink("/images/pin_hot.png"));var j=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];var h={center:new google.maps.LatLng(k.latitude,k.longitude),zoom:12,disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:j};var g=new google.maps.Map(document.getElementById(c),h);var i=new google.maps.Marker({position:new google.maps.LatLng(k.latitude,k.longitude),map:g,icon:f,title:destination})}$(".upload-overlay-loading-fix").hide()})}function setCurrency(a,c,d,e,b){$.fancybox.close();$(".budgetCheckboxGroup").html(a);$(".changeCurrencyBtn").html(b);filterSearch()}$(document).ready(function(){$(document).on("change","#guests_sel",function(){if($(this).val()==""){$(".guestSelectGroup").show()}else{$(".guestSelectGroup").hide()}setGuests()});$(document).on("change","#guests_sel_rooms,#guests_sel_adults,#guests_sel_children",function(){setGuests()});setGuestsFields();autocompleteHotels($("#destinationInput"));filterSearch();$(".sortElt").click(function(){orderBy=$(this).attr("data-value");direction=$(this).attr("data-direction");filterSearch()});$(document).on("click",".smallImgPrev,.smallImgNext",function(){var a="";var c="";var b=0;a=$(this).attr("data-page");c=$(this).attr("data-to");b=$(this).attr("data-value");navigatePhotos(b,a,c)});$(".searchButton").click(function(){filterSearch()});$(document).on("click","#hotel_load_more",function(a){a.preventDefault();initHotelSearch(true)});$(".tuberCheckbox,.hotelPrefCheckbox,.accomodationCheckbox,.budgetCheckbox,.hotelStarCheckbox ").click(function(){var a=$(this);if(a.hasClass("checkboxActive")){a.removeClass("checkboxActive")}else{a.addClass("checkboxActive")}});$("body").on("click",".openHotelCollapsePart",function(){$(this).parent().hide().prev().show()});$("body").on("click",".smallImg",function(){var a=$(this).closest(".aHotelContainer");var b=$(this).attr("data-value");a.find(".LargeSizeImg").css("width",$(this).attr("data-w"));a.find(".LargeSizeImg").css("height",$(this).attr("data-h"));a.find(".LargeSizeImg").attr("src","");a.find(".LargeSizeImg").attr("src",b)});$(".checkOnMap").fancybox({width:800,height:600,closeBtn:true,autoSize:false,autoScale:true,transitionIn:"elastic",transitionOut:"fadeOut",type:"iframe",padding:0,margin:0,scrolling:"no"});$(".changeCurrency").fancybox({width:888,height:650,closeBtn:true,autoSize:false,autoScale:true,transitionIn:"elastic",transitionOut:"fadeOut",type:"iframe",padding:0,margin:0,scrolling:"no"});InitCalendar()});function InitCalendar(){Calendar.setup({inputField:"fromtxt",noScroll:true,trigger:"fromtxt",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());TO_CAL.args.min=a;TO_CAL.redraw();$("#fromtxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"});TO_CAL=Calendar.setup({inputField:"totxt",noScroll:true,trigger:"totxt",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());$("#totxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"})}function addCalToEvent(a){if(new Date($("#fromtxt").attr("data-cal"))>new Date($("#totxt").attr("data-cal"))){$("#totxt").attr("data-cal",$("#fromtxt").attr("data-cal"));$("#totxt").html($("#fromtxt").html())}};