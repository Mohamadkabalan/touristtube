var uploader;var containerDiv;function initUpload(a,b){uploader=new plupload.Uploader({runtimes:"html5,flash",autostart:true,multipart:true,browse_button:b,container:"chatContainer",max_file_size:"200mb",url:ReturnLink("/chat_upload_media.php"),flash_swf_url:ReturnLink("/js/plupload/js/plupload.flash.swf"),filters:[{title:"Image files",extensions:"jpg,gif,png"},{title:"Video files",extensions:"mp4,wmv,flv,f4v"}],init:attachCallbacks});containerDiv=a;uploader.init()}function attachCallbacks(a){a.bind("FilesAdded",function(d,b){for(var c in b){if(c<b.length){$("#"+containerDiv).parent().find(".ChatLog .jspPane").append('<div class="ChatMyMessage"><span class="User">'+t("Me")+'</span><span class="Date">17:25:30</span><span class="Msg"><div class="pending_files" id="'+b[c].id+'"><div class="filename"> '+t("Image File")+" <br> "+t("size")+" : "+plupload.formatSize(b[c].size)+"<b></b></span></div></div>")}initScrollPane($("#"+containerDiv).parent().find(".ChatLog"))}setTimeout(function(){d.start()},500)});a.bind("UploadProgress",function(d,b){var c="<br><span>"+b.percent+"%</span><br>";c+="<div class='progressContainer'><div class='progresss' style='width:"+b.percent+"%;'></div></div>";$("#"+b.id).find("b").html(c)});a.bind("FileUploaded",function(j,b,g){var e=jQuery.parseJSON(g.response);var d="media/chat_media/"+e.filename;var c=b.name.substr(-3);var f=d;$("#"+b.id).delay(1500).prepend('<img src="'+AbsolutePath+"/"+d+'" height="50" alt="'+f+'" width="92">');$("#"+b.id).find("b").html('<a href="'+AbsolutePath+"/"+d+'" target="_blank">'+t("Download")+" </a>");var i=$("#"+b.id).parent().parent().parent().parent().parent().attr("id");i=i.replace("dataTuber","");var h={op:"CHAT",to:i,msg:$("#"+b.id).parent(".Msg").html(),timezone:TimeZone};Communicate(h)});a.bind("BeforeUpload",function(c,b){c.settings.multipart_params={table:"",table_row_id:""}})};