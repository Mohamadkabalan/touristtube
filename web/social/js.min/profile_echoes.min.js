var currentpage=0;var fr_txt="";var to_txt="";var jscrollpane_apiECH;var TO_CAL;var myStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];function initscrollPane(){$(".echoesList").jScrollPane({autoReinitialise:true});jscrollpane_apiECH=$(".echoesList").data("jsp")}$(document).ready(function(){initSocialActions();$("#loadmore").css("width",($("#loadmore span").width()+3)+"px");initscrollPane();InitCalendar();$(document).on("click","#resetpagebut",function(){document.location.reload()});$(document).on("click",".anEcho",function(){if($(this).length>0){var a=$(this);var c=a.offset().top-a.parent().offset().top;var b=a.attr("data-val");$(".social_data_all").attr("data-id",b);initLikes($(".social_data_all"));initComments($(".social_data_all"));initReechoes($(".social_data_all"));$(".echoe_report_top_button").attr("data-id",b);jscrollpane_apiECH.scrollToY(c,true);$(".anEcho").removeClass("selected");a.addClass("selected")}});$(document).on("click",".removeEcho",function(){var a=$(this);var b=a.closest(".anEcho");$(".upload-overlay-loading-fix").show();var c=b.attr("data-val");$.ajax({url:ReturnLink("/ajax/ajax_remove_echo.php"),data:{id:parseInt(c)},type:"post",success:function(d){if(d.trim()=="1"){if(b.siblings.length>0){if(b.prev().length>0){b.prev().click()}else{if(b.next().length>0){b.next().click()}}}else{$('#commentDiv[data-id="'+c+'"]').hide()}b.remove();getEchoesDataRelated(1,0)}else{$(".upload-overlay-loading-fix").hide()}}})});$(document).on("click","#loadmore",function(){currentpage++;getEchoesDataRelated(0,0)});$("#searchCalendarbut").click(function(){if($("#fromtxt").html()!=""||$("#totxt").html()!=""){fr_txt=""+$("#fromtxt").attr("data-cal");to_txt=""+$("#totxt").attr("data-cal");currentpage=0;$(".echoesContent").html("");getEchoesDataRelated(0,1)}});$("#likes").parent().click();$(".echoesContent .anEcho").first().click();refreshFlashData()});function getEchoesDataRelated(b,a){$(".upload-overlay-loading-fix").show();$.post(ReturnLink("/ajax/profile_flash_list.php"),{user_id:userGlobalID(),page:currentpage,frtxt:fr_txt,totxt:to_txt,oneobject:b},function(c){$(".echoesContent").append(c);refreshFlashData();if(b==0&&a==0){setTimeout(function(){jscrollpane_apiECH.scrollToBottom(true)},500)}if(a==1){$(".echoesContent .anEcho").first().click()}$(".upload-overlay-loading-fix").hide()})}function refreshFlashData(){$(".echoImg_link").fancybox({helpers:{overlay:{closeClick:true}}});$(".echoe_googlemap").each(function(e,c){var a=$(this).find(".googlemap_location");var b=a.attr("id");var d=new google.maps.MarkerImage(ReturnLink("/images/map_marker.png"));var g={center:new google.maps.LatLng(a.attr("data-lat"),a.attr("data-lng")),zoom:8,disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:myStyles};var f=new google.maps.Map(document.getElementById(b),g);var h=new google.maps.Marker({position:new google.maps.LatLng(a.attr("data-lat"),a.attr("data-lng")),map:f,icon:d,title:""})})}function InitCalendar(){Calendar.setup({inputField:"fromtxt",noScroll:true,trigger:"frombutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());TO_CAL.args.min=a;TO_CAL.redraw();$("#fromtxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"});TO_CAL=Calendar.setup({inputField:"totxt",noScroll:true,trigger:"tobutcontainer",align:"B",onSelect:function(){var a=Calendar.intToDate(this.selection.get());$("#totxt").attr("data-cal",Calendar.printDate(a,"%Y-%m-%d"));addCalToEvent(this);this.hide()},dateFormat:"%d / %m / %Y"})}function addCalToEvent(a){if(new Date($("#fromtxt").attr("data-cal"))>new Date($("#totxt").attr("data-cal"))){$("#totxt").attr("data-cal","");$("#totxt").html("")}};