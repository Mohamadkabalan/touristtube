/*
 * jScrollPane - v2.0.0beta11 - 2011-07-04
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT and GPL licenses.
 */
(function(a,c,b){a.fn.jScrollPane=function(e){function d(x,an){var at,S=this,Z,ab,aa,o,t,p,ac,ad,R,Q,aA,w,aC,B,v,C,az,aD,ao,aE,aB,m,i,A,E,F,D,j,k,ah,X,Y,ag,aI=true,aG=true,aF=false,aH=false,W=x.clone(false,false).empty(),T=a.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";X=x.css("paddingTop")+" "+x.css("paddingRight")+" "+x.css("paddingBottom")+" "+x.css("paddingLeft");Y=(parseInt(x.css("paddingLeft"),10)||0)+(parseInt(x.css("paddingRight"),10)||0);function I(aR){var aK,aL,aM,aJ,aQ,aP,aN=false,aO=false;at=aR;if(Z===b){aQ=x.scrollTop();aP=x.scrollLeft();x.css({overflow:"hidden",padding:0});ab=x.innerWidth()+Y;aa=x.innerHeight();x.width(ab);Z=a('<div class="jspPane" />').css("padding",X).append(x.children());o=a('<div class="jspContainer" />').css({width:ab+"px",height:aa+"px"}).append(Z).appendTo(x)}else{x.css("width","");aN=at.stickToBottom&&O();aO=at.stickToRight&&P();aJ=x.innerWidth()+Y!=ab||x.outerHeight()!=aa;if(aJ){ab=x.innerWidth()+Y;aa=x.innerHeight();o.css({width:ab+"px",height:aa+"px"})}if(!aJ&&ag==t&&Z.outerHeight()==p){x.width(ab);return}ag=t;Z.css("width","");x.width(ab);o.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end();a(".scrollArrowUp").hide();a(".scrollArrowDown").hide()}Z.css("overflow","auto");if(aR.contentWidth){t=aR.contentWidth}else{t=Z[0].scrollWidth}p=Z[0].scrollHeight;Z.css("overflow","");ac=t/ab;ad=p/aa;R=ad>1;Q=ac>1;if(!(Q||R)){x.removeClass("jspScrollable");Z.css({top:0,width:o.width()-Y});al();aj();ak();ai();aw()}else{x.addClass("jspScrollable");aK=at.maintainPosition&&(aC||C);if(aK){aL=q();aM=r()}K();J();am();if(aK){aq(aO?(t-ab):aL,false);ar(aN?(p-aa):aM,false)}H();M();N();if(at.enableKeyboardNavigation){L()}if(at.clickOnTrack){G()}V();if(at.hijackInternalLinks){z()}}if(at.autoReinitialise&&!ah){ah=setInterval(function(){I(at)},at.autoReinitialiseDelay)}else{if(!at.autoReinitialise&&ah){clearInterval(ah)}}aQ&&x.scrollTop(0)&&ar(aQ,false);aP&&x.scrollLeft(0)&&aq(aP,false);x.trigger("jsp-initialised",[Q||R])}function K(){if(R){o.append(a('<div class="jspVerticalBar" />').append(a('<div class="jspCap jspCapTop" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragTop" />'),a('<div class="jspDragBottom" />'))),a('<div class="jspCap jspCapBottom" />')));az=o.find(">.jspVerticalBar");aD=az.find(">.jspTrack");aA=aD.find(">.jspDrag");if(at.showArrows){m=a('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",y(0,-1)).bind("click.jsp",U);i=a('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",y(0,1)).bind("click.jsp",U);a(".scrollArrowUp").show();a(".scrollArrowDown").show();a(".scrollArrowUp").bind("mousedown.jsp",y(0,-1)).bind("click.jsp",U);a(".scrollArrowDown").bind("mousedown.jsp",y(0,1)).bind("click.jsp",U);if(at.arrowScrollOnHover){m.bind("mouseover.jsp",y(0,-1,m));i.bind("mouseover.jsp",y(0,1,i))}h(aD,at.verticalArrowPositions,m,i)}aE=aa;o.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){aE-=a(this).outerHeight()});aA.hover(function(){aA.addClass("jspHover")},function(){aA.removeClass("jspHover")}).bind("mousedown.jsp",function(s){a("html").bind("dragstart.jsp selectstart.jsp",U);aA.addClass("jspActive");var aJ=s.pageY-aA.position().top;a("html").bind("mousemove.jsp",function(aK){af(aK.pageY-aJ,false)}).bind("mouseup.jsp mouseleave.jsp",n);return false});av()}else{a(".scrollArrowUp").hide();a(".scrollArrowDown").hide()}}function av(){aD.height(aE+"px");aC=0;ao=at.verticalGutter+aD.outerWidth();Z.width(ab-ao-Y);try{if(az.position().left===0){Z.css("margin-left",ao+"px")}}catch(s){}}function J(){if(Q){o.append(a('<div class="jspHorizontalBar" />').append(a('<div class="jspCap jspCapLeft" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragLeft" />'),a('<div class="jspDragRight" />'))),a('<div class="jspCap jspCapRight" />')));A=o.find(">.jspHorizontalBar");E=A.find(">.jspTrack");B=E.find(">.jspDrag");if(at.showArrows){j=a('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",y(-1,0)).bind("click.jsp",U);k=a('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",y(1,0)).bind("click.jsp",U);if(at.arrowScrollOnHover){j.bind("mouseover.jsp",y(-1,0,j));k.bind("mouseover.jsp",y(1,0,k))}h(E,at.horizontalArrowPositions,j,k)}B.hover(function(){B.addClass("jspHover")},function(){B.removeClass("jspHover")}).bind("mousedown.jsp",function(s){a("html").bind("dragstart.jsp selectstart.jsp",U);B.addClass("jspActive");var aJ=s.pageX-B.position().left;a("html").bind("mousemove.jsp",function(aK){ae(aK.pageX-aJ,false)}).bind("mouseup.jsp mouseleave.jsp",n);return false});F=o.innerWidth();au()}}function au(){o.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){F-=a(this).outerWidth()});E.width(F+"px");C=0}function am(){if(Q&&R){var s=E.outerHeight(),aJ=aD.outerWidth();aE-=s;a(A).find(">.jspCap:visible,>.jspArrow").each(function(){F+=a(this).outerWidth()});F-=aJ;aa-=aJ;ab-=s;E.parent().append(a('<div class="jspCorner" />').css("width",s+"px"));av();au()}if(Q){Z.width((o.outerWidth()-Y)+"px")}p=Z.outerHeight();ad=p/aa;if(Q){D=Math.ceil(1/ac*F);if(D>at.horizontalDragMaxWidth){D=at.horizontalDragMaxWidth}else{if(D<at.horizontalDragMinWidth){D=at.horizontalDragMinWidth}}B.width(D+"px");v=F-D;f(C)}if(R){aB=Math.ceil(1/ad*aE);if(aB>at.verticalDragMaxHeight){aB=at.verticalDragMaxHeight}else{if(aB<at.verticalDragMinHeight){aB=at.verticalDragMinHeight}}aA.height(aB+"px");w=aE-aB;g(aC)}}function h(aL,aM,s,aJ){var aN="before",aO="after",aK;if(aM=="os"){aM=/Mac/.test(navigator.platform)?"after":"split"}if(aM==aN){aO=aM}else{if(aM==aO){aN=aM;aK=s;s=aJ;aJ=aK}}aL[aN](s)[aO](aJ)}function y(s,aJ,aK){return function(){l(s,aJ,this,aK);this.blur();return false}}function l(aJ,aK,s,aM){s=a(s).addClass("jspActive");var aN,aP,aO=true,aL=function(){if(aJ!==0){S.scrollByX(aJ*at.arrowButtonSpeed)}if(aK!==0){S.scrollByY(aK*at.arrowButtonSpeed)}aP=setTimeout(aL,aO?at.initialDelay:at.arrowRepeatFreq);aO=false};aL();aN=aM?"mouseout.jsp":"mouseup.jsp";aM=aM||a("html");aM.bind(aN,function(){s.removeClass("jspActive");aP&&clearTimeout(aP);aP=null;aM.unbind(aN)})}function G(){ai();if(R){aD.bind("mousedown.jsp",function(aM){if(aM.originalTarget===b||aM.originalTarget==aM.currentTarget){var aJ=a(this),aO=aJ.offset(),aK=aM.pageY-aO.top-aC,aP,aN=true,aL=function(){var aS=aJ.offset(),aT=aM.pageY-aS.top-aB/2,aQ=aa*at.scrollPagePercent,aR=w*aQ/(p-aa);if(aK<0){if(aC-aR>aT){S.scrollByY(-aQ)}else{af(aT)}}else{if(aK>0){if(aC+aR<aT){S.scrollByY(aQ)}else{af(aT)}}else{s();return}}aP=setTimeout(aL,aN?at.initialDelay:at.trackClickRepeatFreq);aN=false},s=function(){aP&&clearTimeout(aP);aP=null;a(document).unbind("mouseup.jsp",s)};aL();a(document).bind("mouseup.jsp",s);return false}})}if(Q){E.bind("mousedown.jsp",function(aM){if(aM.originalTarget===b||aM.originalTarget==aM.currentTarget){var aJ=a(this),aO=aJ.offset(),aK=aM.pageX-aO.left-C,aP,aN=true,aL=function(){var aS=aJ.offset(),aT=aM.pageX-aS.left-D/2,aQ=ab*at.scrollPagePercent,aR=v*aQ/(t-ab);if(aK<0){if(C-aR>aT){S.scrollByX(-aQ)}else{ae(aT)}}else{if(aK>0){if(C+aR<aT){S.scrollByX(aQ)}else{ae(aT)}}else{s();return}}aP=setTimeout(aL,aN?at.initialDelay:at.trackClickRepeatFreq);aN=false},s=function(){aP&&clearTimeout(aP);aP=null;a(document).unbind("mouseup.jsp",s)};aL();a(document).bind("mouseup.jsp",s);return false}})}}function ai(){if(E){E.unbind("mousedown.jsp")}if(aD){aD.unbind("mousedown.jsp")}}function n(){a("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");if(aA){aA.removeClass("jspActive")}if(B){B.removeClass("jspActive")}}function af(aJ,s){if(!R){return}if(aJ<0){aJ=0}else{if(aJ>w){aJ=w}}if(s===b){s=at.animateScroll}if(s){S.animate(aA,"top",aJ,g)}else{aA.css("top",aJ);g(aJ)}}function g(aJ){if(aJ===b){aJ=aA.position().top}o.scrollTop(0);aC=aJ;var aL=aC===0,aK=aC==w,aM=aJ/w,s=-aM*(p-aa);if(aI!=aL||aF!=aK){aI=aL;aF=aK;x.trigger("jsp-arrow-change",[aI,aF,aG,aH])}ay(aL,aK);Z.css("top",s);x.trigger("jsp-scroll-y",[-s,aL,aK]).trigger("scroll")}function ae(aJ,s){if(!Q){return}if(aJ<0){aJ=0}else{if(aJ>v){aJ=v}}if(s===b){s=at.animateScroll}if(s){S.animate(B,"left",aJ,f)}else{B.css("left",aJ);f(aJ)}}function f(aJ){if(aJ===b){aJ=B.position().left}o.scrollTop(0);C=aJ;var aK=C===0,aL=C==v,aM=aJ/v,s=-aM*(t-ab);if(aG!=aK||aH!=aL){aG=aK;aH=aL;x.trigger("jsp-arrow-change",[aI,aF,aG,aH])}ax(aK,aL);Z.css("left",s);x.trigger("jsp-scroll-x",[-s,aK,aL]).trigger("scroll")}function ay(aJ,s){if(at.showArrows){m[aJ?"addClass":"removeClass"]("jspDisabled");i[s?"addClass":"removeClass"]("jspDisabled")}}function ax(s,aJ){if(at.showArrows){j[s?"addClass":"removeClass"]("jspDisabled");k[aJ?"addClass":"removeClass"]("jspDisabled")}}function ar(aJ,s){var aK=aJ/(p-aa);af(aK*w,s)}function aq(aJ,s){var aK=aJ/(t-ab);ae(aK*v,s)}function ap(aM,aU,s){var aL,aN,aQ,aP=0,aO=0,aW,aV,aT,aS,aK,aJ;try{aL=a(aM)}catch(aR){return}aN=aL.outerHeight();aQ=aL.outerWidth();o.scrollTop(0);o.scrollLeft(0);while(!aL.is(".jspPane")){aP+=aL.position().top;aO+=aL.position().left;aL=aL.offsetParent();if(/^body|html$/i.test(aL[0].nodeName)){return}}aW=r();aT=aW+aa;if(aP<aW||aU){aK=aP-at.verticalGutter}else{if(aP+aN>aT){aK=aP-aa+aN+at.verticalGutter}}if(aK){ar(aK,s)}aV=q();aS=aV+ab;if(aO<aV||aU){aJ=aO-at.horizontalGutter}else{if(aO+aQ>aS){aJ=aO-ab+aQ+at.horizontalGutter}}if(aJ){aq(aJ,s)}}function q(){return -Z.position().left}function r(){return -Z.position().top}function O(){var s=p-aa;return(s>20)&&(s-r()<10)}function P(){var s=t-ab;return(s>20)&&(s-q()<10)}function M(){o.unbind(T).bind(T,function(aN,s,aJ,aK){var aL=C,aM=aC;S.scrollBy(aJ*at.mouseWheelSpeed,-aK*at.mouseWheelSpeed,false);return aL==C&&aM==aC})}function al(){o.unbind(T)}function U(){return false}function H(){Z.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(s){ap(s.target,false)})}function aj(){Z.find(":input,a").unbind("focus.jsp")}function L(){var aJ,s,aL=[];Q&&aL.push(A[0]);R&&aL.push(az[0]);Z.focus(function(){x.focus()});x.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(aO){if(aO.target!==this&&!(aL.length&&a(aO.target).closest(aL).length)){return}var aM=C,aN=aC;switch(aO.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:aJ=aO.keyCode;aK();break;case 35:ar(p-aa);aJ=null;break;case 36:ar(0);aJ=null;break}s=aO.keyCode==aJ&&aM!=C||aN!=aC;return !s}).bind("keypress.jsp",function(aM){if(aM.keyCode==aJ){aK()}return !s});if(at.hideFocus){x.css("outline","none");if("hideFocus" in o[0]){x.attr("hideFocus",true)}}else{x.css("outline","");if("hideFocus" in o[0]){x.attr("hideFocus",false)}}function aK(){var aM=C,aN=aC;switch(aJ){case 40:S.scrollByY(at.keyboardSpeed,false);break;case 38:S.scrollByY(-at.keyboardSpeed,false);break;case 34:case 32:S.scrollByY(aa*at.scrollPagePercent,false);break;case 33:S.scrollByY(-aa*at.scrollPagePercent,false);break;case 39:S.scrollByX(at.keyboardSpeed,false);break;case 37:S.scrollByX(-at.keyboardSpeed,false);break}s=aM!=C||aN!=aC;return s}}function ak(){x.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function V(){if(location.hash&&location.hash.length>1){var s,aL,aK=escape(location.hash);try{s=a(aK)}catch(aJ){return}if(s.length&&Z.find(aK)){if(o.scrollTop()===0){aL=setInterval(function(){if(o.scrollTop()>0){ap(aK,true);a(document).scrollTop(o.position().top);clearInterval(aL)}},50)}else{ap(aK,true);a(document).scrollTop(o.position().top)}}}}function aw(){a("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function z(){aw();a("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var aJ=this.href.split("#"),s;if(aJ.length>1){s=aJ[1];if(s.length>0&&Z.find("#"+s).length>0){ap("#"+s,true);return false}}})}function N(){var aK,aL,aM,aN,s,aJ=false;o.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(aO){var aP=aO.originalEvent.touches[0];aK=q();aL=r();aM=aP.pageX;aN=aP.pageY;s=false;aJ=true}).bind("touchmove.jsp",function(aQ){if(!aJ){return}var aR=aQ.originalEvent.touches[0],aO=C,aP=aC;S.scrollTo(aK+aM-aR.pageX,aL+aN-aR.pageY);s=s||Math.abs(aM-aR.pageX)>5||Math.abs(aN-aR.pageY)>5;return aO==C&&aP==aC}).bind("touchend.jsp",function(aO){aJ=false}).bind("click.jsp-touchclick",function(aO){if(s){s=false;return false}})}function u(){var aJ=r(),s=q();x.removeClass("jspScrollable").unbind(".jsp");x.replaceWith(W.append(Z.children()));W.scrollTop(aJ);W.scrollLeft(s)}a.extend(S,{reinitialise:function(aJ){aJ=a.extend({},at,aJ);I(aJ)},scrollToElement:function(aJ,aK,s){ap(aJ,aK,s)},scrollTo:function(aJ,aK,s){aq(aJ,s);ar(aK,s)},scrollToX:function(aJ,s){aq(aJ,s)},scrollToY:function(aJ,s){ar(aJ,s)},scrollToPercentX:function(aJ,s){aq(aJ*(t-ab),s)},scrollToPercentY:function(aJ,s){ar(aJ*(p-aa),s)},scrollBy:function(aJ,aK,s){S.scrollByX(aJ,s);S.scrollByY(aK,s)},scrollByX:function(aJ,s){var aK=q()+Math[aJ<0?"floor":"ceil"](aJ),aL=aK/(t-ab);ae(aL*v,s)},scrollByY:function(aJ,s){var aK=r()+Math[aJ<0?"floor":"ceil"](aJ),aL=aK/(p-aa);af(aL*w,s)},positionDragX:function(aJ,s){ae(aJ,s)},positionDragY:function(aJ,s){af(aJ,s)},animate:function(s,aK,aM,aL){var aJ={};aJ[aK]=aM;s.animate(aJ,{duration:at.animateDuration,easing:at.animateEase,queue:false,step:aL})},getContentPositionX:function(){return q()},getContentPositionY:function(){return r()},getContentWidth:function(){return t},getContentHeight:function(){return p},getPercentScrolledX:function(){return q()/(t-ab)},getPercentScrolledY:function(){return r()/(p-aa)},getIsScrollableH:function(){return Q},getIsScrollableV:function(){return R},getContentPane:function(){return Z},scrollToBottom:function(s){af(w,s)},hijackInternalLinks:function(){z()},destroy:function(){u()}});I(an)}e=a.extend({},a.fn.jScrollPane.defaults,e);a.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){e[this]=e[this]||e.speed});return this.each(function(){var f=a(this),g=f.data("jsp");if(g){g.reinitialise(e)}else{g=new d(f,e);f.data("jsp",g)}})};a.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,stickToBottom:false,stickToRight:false,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:b,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:0.8}})(jQuery,this);