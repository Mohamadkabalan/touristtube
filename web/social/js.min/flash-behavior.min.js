var LoadedPages=0;var uploader;var requirements_met=true;var jscrollpane_apiFE;var myStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];function initscrollPane(){$(".echoesList").jScrollPane({autoReinitialise:true});jscrollpane_apiFE=$(".echoesList").data("jsp")}function addValue(a,b){if($(a).attr("value")==""){$(a).attr("value",b)}}function removeValue(a,b){if($(a).attr("value")==b){$(a).attr("value","")}}$.fn.searchEvent=function(a){return this.each(function(){$(this).keypress(function(b){if(b.which==13){a.call(this,b)}});$(".searchEchoIco").click(function(b){a.call(this,b)})})};$(document).ready(function(){initSocialActions();$(".selectecho").selectbox();$(".selectecho").change(function(){var f=$(this).val();window.location.href=ReturnLink("/echoes/filter/"+f)});$("#loadmore").css("width",($("#loadmore span").width()+3)+"px");if(!$("#flashPhoto").hasClass("inactive")){InitChannelUploaderHome("flashPhoto","flashTextField_container",15,0)}var c=new Date();if(day_search!=""){var c=new Date(day_search)}var b=Calendar.setup({cont:"archiveCal",noScroll:true,date:c,onSelect:function(f){if(day_search!=""){day_search=""}else{var g=Calendar.intToDate(f.selection.get());var h=Calendar.printDate(g,"%Y-%m-%d");window.location.href=ReturnLink("/echoes/day/"+h)}},showTime:12,dateFormat:"%Y-%m-%d %I:%M %p"});if(day_search!=""){var a=Calendar.dateToInt(c);b.selection.set(a)}initscrollPane();$(".searchEchoField").searchEvent(function(){var f=getObjectData($(".searchEchoField"));if(f!=""){window.location.href=ReturnLink("/echoes/search/"+f)}});$(".aCloudItem").click(function(){var f=$(this).html();f=f.trim();f=ReturnLink("/echoes/tag/"+f);window.location.href=f});$(".echoText").keyup(function(){var g=$(this);var f=g.val();var i=/#(\w*\W)|(#(\w*)) /g;var j=f.match(i);if(j!==null){j.forEach(function(n,l,k){var m=/(\W)$/;if(n.match(m)){n=n.replace(m,"")}f=f.replace(n,"<b>"+n+"</b>")})}$(".toshow").html(f);var h=FLASH_MAX_LENGTH-g.val().length;$(".flashRemaining").html(h)});$(".echoText").on("keyup keypress blur change click scroll keydown focus blur",function(){var f=$(".toshow").height()+38;$(".echoText").css("height",f+"px")});$(document).on("click",".anEchoInside p b",function(){var f=$(this).html();f=f.substr(1);window.location.href=ReturnLink("/echoes/tag/"+f)});$(document).on("click",".clsimg",function(){$("#filename").val("");$("#vpath").val("");$(".ImageStan_flash").html("")});$(".flashTextField, #flashPhoto").click(function(){if($(this).hasClass("inactive")){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to echo."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(f){if(f){window.location.href=ReturnLink("/register")}}});return}});$(".echoSubmit").click(function(){if($(this).hasClass("inactive")){TTAlert({msg:t("you need to have a")+' <a class="black_link" href="'+ReturnLink("/register")+'">'+t("TT account")+"</a> "+t("in order to echo."),type:"action",btn1:t("cancel"),btn2:t("register"),btn2Callback:function(v){if(v){window.location.href=ReturnLink("/register")}}});return}var r="";var m="";var o="";var i=$("#filename").val();var u=$("#vpath").val();var s="";r=getObjectData($(".echoText"));if(r!=""){$(".echoText").val(r+" ");$(".echoText").keyup();if(r!=""){r=$(".toshow").html()}}m=getObjectData($(".echoLink"));if(!ValidURL(m)&&m!=""){TTAlert({msg:t("invalid link"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}o=getObjectData($(".echoLocation"));if(o!=""){$("#FlashLong").val($("#echoLocation").attr("data-lng"));$("#FlashLat").val($("#echoLocation").attr("data-lat"));$("#label").val($("#echoLocation").attr("data-location"))}if(r==""&&m==""&&o==""&&i==""&&u==""){TTAlert({msg:t("invalid data"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}var k=$("#FlashLong").val();var j=$("#FlashLat").val();var l=$("#label").val();if((k==""||j==""||l=="")&&o!=""){TTAlert({msg:t("invalid location"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}var p=$("#ReplyTo").val();var g=$("#city").val();var f=$("#cc").val();var n=$("#loc_id").val();var q=$("#rtype").val();var h={FlashText:r,flash_link:m,flash_location:o,ReplyTo:p,FlashLong:k,FlashLat:j,vpath:u,city:g,cc:f,loc_id:n,rtype:q,label:l,filename:i};$(".upload-overlay-loading-fix").show();$.ajax({url:ReturnLink("/ajax/flash_post.php"),data:h,type:"post",success:function(y){var x;try{x=$.parseJSON(y)}catch(w){$(".upload-overlay-loading-fix").hide();TTAlert({msg:t("Couldn't Process Request. Please try again later."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(x.status!="ok"){$(".upload-overlay-loading-fix").hide();if(x.type=="session"){TTAlert({msg:t("Please login to complete this task."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{if(x.type=="save"){TTAlert({msg:t("Couldn't add the echo. Please try again later."),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}}return}var v=parseInt($("#n_flashes").text());$("#n_flashes").html(v+1);document.location.href=ReturnLink("/echoes");$(".toshow").html("");$(".echoText").val("");$(".echoLink").val("");$(".echoLink").blur();$(".echoLocation").val("");$(".echoLocation").blur();$("#FlashLong").val("");$("#FlashLat").val("");$("#filename").val("");$("#vpath").val("");$(".ImageStan_flash").html("");$(".flashRemaining").html(FLASH_MAX_LENGTH);if($(".flashType.active").attr("id")!="flashPhoto"){$(".flashType.active").click()}else{$(".flashType").removeClass("active");$("#flashText").click()}$(".upload-overlay-loading-fix").hide()}})});$(document).on("click",".anEcho",function(){if($(this).length>0){var f=$(this);var h=f.offset().top-f.parent().offset().top;var g=f.attr("data-val");$(".social_data_all").attr("data-id",g);initLikes($(".social_data_all"));initComments($(".social_data_all"));initReechoes($(".social_data_all"));$(".echoe_report_top_button").attr("data-id",g);jscrollpane_apiFE.scrollToY(h,true);$(".anEcho").removeClass("selected");f.addClass("selected")}});$("#likes").parent().click();var d=document.getElementById("echoLocation");var e=new google.maps.places.SearchBox(d);google.maps.event.addListener(e,"places_changed",function(){var f=e.getPlaces();place=f[0];$("#echoLocation").attr("data-location",place.formatted_address);$("#echoLocation").attr("data-lat",place.geometry.location.lat());$("#echoLocation").attr("data-lng",place.geometry.location.lng())});$(document).on("click",".flashType",function(){var f=$(this);var g=parseInt(f.attr("data-value"));switch(g){case 0:break;case ECHO_TYPE_TEXT:$(".echoText").show();$(".toshowCont").show();$(".flashRemaining").show();$(".echoText").blur();break;case ECHO_TYPE_LINK:$(".echoLink").show();$(".echoLink").blur();break;case ECHO_TYPE_LOCATION:$(".echoLocation").show();$(".echoLocation").blur();break;default:$(".echoText").show();$(".toshowCont").show();$(".flashRemaining").show();$(".echoText").blur();break}});$(document).on("click","#loadmore",function(){getEchoesDataRelated(0)});$(document).on("click",".removeEcho",function(){var f=$(this);var g=f.closest(".anEcho");var h=g.attr("data-val");$.ajax({url:ReturnLink("/ajax/ajax_remove_echo.php"),data:{id:parseInt(h)},type:"post",success:function(i){if(i.trim()=="1"){if(g.siblings.length>0){if(g.prev().length>0){g.prev().click()}else{if(g.next().length>0){g.next().click()}}}else{$('#commentDiv[data-id="'+h+'"]').hide()}g.remove();getEchoesDataRelated(1)}}})});$(".echoesContent .anEcho").first().click();refreshFlashData()});function resetAllItems(){$(".echoLocation").hide();$(".echoLink").hide();$(".echoText").hide();$(".toshowCont").hide();$(".echoText").val("");$(".echoLink").val("");$("#FlashLong").val("");$("#FlashLat").val("");$(".echoLocation").val("");$(".toshowCont .toshow").html("");$("#echoLocation").attr("data-location","");$("#echoLocation").attr("data-lat","");$("#echoLocation").attr("data-lng","")}function updateImage(d,c,b,a){if(a=="flashPhoto"){$("#filename").val(c);$("#vpath").val(b);$(".ImageStan_flash").html('<div class="clsimg mediabuttons" data-title="remove"></div>'+d);$(".ImageStan_flash").each(function(g,f){var e=$(this);e.mouseover(function(){$(this).find(".clsimg.mediabuttons").show()});e.mouseout(function(){$(this).find(".clsimg.mediabuttons").hide()})});$(".mediabuttons").mouseover(function(){var e=$(this).closest(".ImageStan_flash");var f=e.offset().left-$(".flashBlock1").offset().left-184;var g=e.offset().top-$(".flashBlock1").offset().top-21;$(".evContainer2Over .ProfileHeaderOverin").html("remove");$(".evContainer2Over").css("left",f+"px");$(".evContainer2Over").css("top",g+"px");$(".evContainer2Over").stop().show()});$(".mediabuttons").mouseout(function(){$(".evContainer2Over").hide()})}closeFancyBox()}function refreshFlashData(){$(".echoImg_link").fancybox({helpers:{overlay:{closeClick:true}}});$(".echoe_googlemap").each(function(e,c){var a=$(this).find(".googlemap_location");var b=a.attr("id");var d=new google.maps.MarkerImage(ReturnLink("/images/map_marker.png"));var g={center:new google.maps.LatLng(a.attr("data-lat"),a.attr("data-lng")),zoom:8,disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:myStyles};var f=new google.maps.Map(document.getElementById(b),g);var h=new google.maps.Marker({position:new google.maps.LatLng(a.attr("data-lat"),a.attr("data-lng")),map:f,icon:d,title:""})})}function getEchoesDataRelated(a){$(".upload-overlay-loading-fix").show();LoadedPages++;var b=$("#loadmore").attr("rel")+"&oneobject="+a;$.ajax({url:b,success:function(c){$(".echoesContent").append(c);refreshFlashData();if(a==0){setTimeout(function(){jscrollpane_apiFE.scrollToBottom(true)},500)}$(".upload-overlay-loading-fix").hide()}})};