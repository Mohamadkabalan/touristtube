function selectText(){var b;if(document.selection){b=document.body.createTextRange();b.moveToElementText(this);b.select()}else{if(window.getSelection){b=document.createRange();b.selectNode(this);window.getSelection().addRange(b)}}}$(document).ready(function(){$("body").on("click",".CopyCommand",selectText)});(function(){var y=document.createElement("input");try{y.type="range";if(y.type=="range"){return}}catch(w){return}if(!document.mozSetImageElement||!("MozAppearance" in y.style)){return}var s;var v=navigator.platform=="MacIntel";var e={radius:v?9:6,width:v?22:12,height:v?16:20};var q="-moz-linear-gradient(top, transparent "+(v?"6px, #999 6px, #999 7px, #ccc 9px, #bbb 11px, #bbb 12px, transparent 12px":"9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px")+", transparent)";var z={"min-width":e.width+"px","min-height":e.height+"px","max-height":e.height+"px",padding:0,border:0,"border-radius":0,cursor:"default","text-indent":"-999999px"};var x=document.createEvent("HTMLEvents");x.initEvent("change",true,false);if(document.readyState=="loading"){document.addEventListener("DOMContentLoaded",t,true)}else{t()}function t(){Array.forEach(document.querySelectorAll("input[type=range]"),r);document.addEventListener("DOMNodeInserted",u,true)}function u(a){p(a.target);if(a.target.querySelectorAll){Array.forEach(a.target.querySelectorAll("input"),p)}}function p(a,b){if(a.localName!="input"||a.type=="range"){}else{if(a.getAttribute("type")=="range"){r(a)}else{if(!b){setTimeout(p,0,a,true)}}}}function r(h){var U,n,T,m,j,k,S;var i,l,W,d,g=h.value;if(!s){s=document.body.appendChild(document.createElement("hr"));o(s,{"-moz-appearance":v?"scale-horizontal":"scalethumb-horizontal",display:"block",visibility:"visible",opacity:1,position:"fixed",top:"-999999px"});document.mozSetImageElement("__sliderthumb__",s)}var O=function(){return""+g};var N=function N(A){g=""+A;U=true;a();delete h.value;h.value=g;h.__defineGetter__("value",O);h.__defineSetter__("value",N)};h.__defineGetter__("value",O);h.__defineSetter__("value",N);h.__defineGetter__("type",function(){return"range"});["min","max","step"].forEach(function(A){if(h.hasAttribute(A)){n=true}h.__defineGetter__(A,function(){return this.hasAttribute(A)?this.getAttribute(A):""});h.__defineSetter__(A,function(B){B===null?this.removeAttribute(A):this.setAttribute(A,B)})});h.readOnly=true;o(h,z);X();h.addEventListener("DOMAttrModified",function(A){if(A.attrName=="value"&&!U){g=A.newValue;a()}else{if(~["min","max","step"].indexOf(A.attrName)){X();n=true}}},true);h.addEventListener("mousedown",V,true);h.addEventListener("keydown",P,true);h.addEventListener("focus",R,true);h.addEventListener("blur",b,true);function V(C){m=true;setTimeout(function(){m=false},0);if(C.button||!d){return}var B=parseFloat(getComputedStyle(this,0).width);var D=(B-e.width)/d;if(!D){return}var A=C.clientX-this.getBoundingClientRect().left-e.width/2-(g-i)*D;if(Math.abs(A)>e.radius){T=true;this.value-=-A/D}k=g;S=C.clientX;this.addEventListener("mousemove",c,true);this.addEventListener("mouseup",M,true)}function c(B){var A=parseFloat(getComputedStyle(this,0).width);var C=(A-e.width)/d;if(!C){return}k+=(B.clientX-S)/C;S=B.clientX;T=true;this.value=k}function M(){this.removeEventListener("mousemove",c,true);this.removeEventListener("mouseup",M,true)}function P(A){if(A.keyCode>36&&A.keyCode<41){R.call(this);T=true;this.value=g+(A.keyCode==38||A.keyCode==39?W:-W)}}function R(){if(!m){this.style.boxShadow=!v?"0 0 0 2px #fb0":"0 0 2px 1px -moz-mac-focusring, inset 0 0 1px -moz-mac-focusring"}}function b(){this.style.boxShadow=""}function Q(A){return !isNaN(A)&&+A==parseFloat(A)}function X(){i=Q(h.min)?+h.min:0;l=Q(h.max)?+h.max:100;if(l<i){l=i>100?i:100}W=Q(h.step)&&h.step>0?+h.step:1;d=l-i;a(true)}function f(){if(!U&&!n){g=h.getAttribute("value")}if(!Q(g)){g=(i+l)/2}g=Math.round((g-i)/W)*W+i;if(g<i){g=i}else{if(g>l){g=i+~~(d/W)*W}}}function a(C){f();if(T&&g!=j){h.dispatchEvent(x)}T=false;if(!C&&g==j){return}j=g;var A=d?(g-i)/d*100:0;var B="-moz-element(#__sliderthumb__) "+A+"% no-repeat, ";o(h,{background:B+q})}}function o(a,b){for(var c in b){a.style.setProperty(c,b[c],"important")}}})();(function(){var az=this;var ai=az._;var X={};var V=Array.prototype,aa=Object.prototype,au=Function.prototype;var af=V.push,aq=V.slice,aB=V.concat,R=V.unshift,U=aa.toString,ag=aa.hasOwnProperty;var an=V.forEach,at=V.map,Z=V.reduce,S=V.reduceRight,Q=V.filter,T=V.every,ar=V.some,ao=V.indexOf,ak=V.lastIndexOf,ax=Array.isArray,Y=Object.keys,ab=au.bind;var ap=function(a){if(a instanceof ap){return a}if(!(this instanceof ap)){return new ap(a)}this._wrapped=a};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=ap}exports._=ap}else{az._=ap}ap.VERSION="1.4.2";var ah=ap.each=ap.forEach=function(f,e,d){if(f==null){return}if(an&&f.forEach===an){f.forEach(e,d)}else{if(f.length===+f.length){for(var c=0,a=f.length;c<a;c++){if(e.call(d,f[c],c,f)===X){return}}}else{for(var b in f){if(ap.has(f,b)){if(e.call(d,f[b],b,f)===X){return}}}}}};ap.map=ap.collect=function(d,c,b){var a=[];if(d==null){return a}if(at&&d.map===at){return d.map(c,b)}ah(d,function(g,e,f){a[a.length]=c.call(b,g,e,f)});return a};ap.reduce=ap.foldl=ap.inject=function(e,d,a,c){var b=arguments.length>2;if(e==null){e=[]}if(Z&&e.reduce===Z){if(c){d=ap.bind(d,c)}return b?e.reduce(d,a):e.reduce(d)}ah(e,function(h,f,g){if(!b){a=h;b=true}else{a=d.call(c,a,h,f,g)}});if(!b){throw new TypeError("Reduce of empty array with no initial value")}return a};ap.reduceRight=ap.foldr=function(g,d,a,c){var b=arguments.length>2;if(g==null){g=[]}if(S&&g.reduceRight===S){if(c){d=ap.bind(d,c)}return arguments.length>2?g.reduceRight(d,a):g.reduceRight(d)}var f=g.length;if(f!==+f){var e=ap.keys(g);f=e.length}ah(g,function(j,h,i){h=e?e[--f]:--f;if(!b){a=g[h];b=true}else{a=d.call(c,a,g[h],h,i)}});if(!b){throw new TypeError("Reduce of empty array with no initial value")}return a};ap.find=ap.detect=function(d,c,b){var a;P(d,function(g,e,f){if(c.call(b,g,e,f)){a=g;return true}});return a};ap.filter=ap.select=function(d,c,b){var a=[];if(d==null){return a}if(Q&&d.filter===Q){return d.filter(c,b)}ah(d,function(g,e,f){if(c.call(b,g,e,f)){a[a.length]=g}});return a};ap.reject=function(d,c,b){var a=[];if(d==null){return a}ah(d,function(g,e,f){if(!c.call(b,g,e,f)){a[a.length]=g}});return a};ap.every=ap.all=function(d,c,b){c||(c=ap.identity);var a=true;if(d==null){return a}if(T&&d.every===T){return d.every(c,b)}ah(d,function(g,e,f){if(!(a=a&&c.call(b,g,e,f))){return X}});return !!a};var P=ap.some=ap.any=function(d,c,b){c||(c=ap.identity);var a=false;if(d==null){return a}if(ar&&d.some===ar){return d.some(c,b)}ah(d,function(g,e,f){if(a||(a=c.call(b,g,e,f))){return X}});return !!a};ap.contains=ap.include=function(c,b){var a=false;if(c==null){return a}if(ao&&c.indexOf===ao){return c.indexOf(b)!=-1}a=P(c,function(d){return d===b});return a};ap.invoke=function(b,c){var a=aq.call(arguments,2);return ap.map(b,function(d){return(ap.isFunction(c)?c:d[c]).apply(d,a)})};ap.pluck=function(b,a){return ap.map(b,function(c){return c[a]})};ap.where=function(b,a){if(ap.isEmpty(a)){return[]}return ap.filter(b,function(d){for(var c in a){if(a[c]!==d[c]){return false}}return true})};ap.max=function(d,c,b){if(!c&&ap.isArray(d)&&d[0]===+d[0]&&d.length<65535){return Math.max.apply(Math,d)}if(!c&&ap.isEmpty(d)){return -Infinity}var a={computed:-Infinity};ah(d,function(h,e,g){var f=c?c.call(b,h,e,g):h;f>=a.computed&&(a={value:h,computed:f})});return a.value};ap.min=function(d,c,b){if(!c&&ap.isArray(d)&&d[0]===+d[0]&&d.length<65535){return Math.min.apply(Math,d)}if(!c&&ap.isEmpty(d)){return Infinity}var a={computed:Infinity};ah(d,function(h,e,g){var f=c?c.call(b,h,e,g):h;f<a.computed&&(a={value:h,computed:f})});return a.value};ap.shuffle=function(d){var c;var b=0;var a=[];ah(d,function(e){c=ap.random(b++);a[b-1]=a[c];a[c]=e});return a};var O=function(a){return ap.isFunction(a)?a:function(b){return b[a]}};ap.sortBy=function(d,c,a){var b=O(c);return ap.pluck(ap.map(d,function(g,e,f){return{value:g,index:e,criteria:b.call(a,g,e,f)}}).sort(function(h,g){var f=h.criteria;var e=g.criteria;if(f!==e){if(f>e||f===void 0){return 1}if(f<e||e===void 0){return -1}}return h.index<g.index?-1:1}),"value")};var aw=function(f,e,b,d){var a={};var c=O(e);ah(f,function(i,g){var h=c.call(b,i,g,f);d(a,h,i)});return a};ap.groupBy=function(c,b,a){return aw(c,b,a,function(d,e,f){(ap.has(d,e)?d[e]:(d[e]=[])).push(f)})};ap.countBy=function(c,b,a){return aw(c,b,a,function(d,e,f){if(!ap.has(d,e)){d[e]=0}d[e]++})};ap.sortedIndex=function(h,g,d,c){d=d==null?ap.identity:O(d);var f=d.call(c,g);var a=0,e=h.length;while(a<e){var b=(a+e)>>>1;d.call(c,h[b])<f?a=b+1:e=b}return a};ap.toArray=function(a){if(!a){return[]}if(a.length===+a.length){return aq.call(a)}return ap.values(a)};ap.size=function(a){return(a.length===+a.length)?a.length:ap.keys(a).length};ap.first=ap.head=ap.take=function(c,b,a){return(b!=null)&&!a?aq.call(c,0,b):c[0]};ap.initial=function(c,b,a){return aq.call(c,0,c.length-((b==null)||a?1:b))};ap.last=function(c,b,a){if((b!=null)&&!a){return aq.call(c,Math.max(c.length-b,0))}else{return c[c.length-1]}};ap.rest=ap.tail=ap.drop=function(c,b,a){return aq.call(c,(b==null)||a?1:b)};ap.compact=function(a){return ap.filter(a,function(b){return !!b})};var aA=function(b,c,a){ah(b,function(d){if(ap.isArray(d)){c?af.apply(a,d):aA(d,c,a)}else{a.push(d)}});return a};ap.flatten=function(b,a){return aA(b,a,[])};ap.without=function(a){return ap.difference(a,aq.call(arguments,1))};ap.uniq=ap.unique=function(g,f,e,d){var b=e?ap.map(g,e,d):g;var c=[];var a=[];ah(b,function(i,h){if(f?(!h||a[a.length-1]!==i):!ap.contains(a,i)){a.push(i);c.push(g[h])}});return c};ap.union=function(){return ap.uniq(aB.apply(V,arguments))};ap.intersection=function(b){var a=aq.call(arguments,1);return ap.filter(ap.uniq(b),function(c){return ap.every(a,function(d){return ap.indexOf(d,c)>=0})})};ap.difference=function(b){var a=aB.apply(V,aq.call(arguments,1));return ap.filter(b,function(c){return !ap.contains(a,c)})};ap.zip=function(){var a=aq.call(arguments);var d=ap.max(ap.pluck(a,"length"));var c=new Array(d);for(var b=0;b<d;b++){c[b]=ap.pluck(a,""+b)}return c};ap.object=function(e,c){var a={};for(var d=0,b=e.length;d<b;d++){if(c){a[e[d]]=c[d]}else{a[e[d][0]]=e[d][1]}}return a};ap.indexOf=function(e,c,d){if(e==null){return -1}var b=0,a=e.length;if(d){if(typeof d=="number"){b=(d<0?Math.max(0,a+d):d)}else{b=ap.sortedIndex(e,c);return e[b]===c?b:-1}}if(ao&&e.indexOf===ao){return e.indexOf(c,d)}for(;b<a;b++){if(e[b]===c){return b}}return -1};ap.lastIndexOf=function(e,c,d){if(e==null){return -1}var a=d!=null;if(ak&&e.lastIndexOf===ak){return a?e.lastIndexOf(c,d):e.lastIndexOf(c)}var b=(a?d:e.length);while(b--){if(e[b]===c){return b}}return -1};ap.range=function(f,d,e){if(arguments.length<=1){d=f||0;f=0}e=arguments[2]||1;var b=Math.max(Math.ceil((d-f)/e),0);var a=0;var c=new Array(b);while(a<b){c[a++]=f;f+=e}return c};var ad=function(){};ap.bind=function W(d,b){var c,a;if(d.bind===ab&&ab){return ab.apply(d,aq.call(arguments,1))}if(!ap.isFunction(d)){throw new TypeError}a=aq.call(arguments,2);return c=function(){if(!(this instanceof c)){return d.apply(b,a.concat(aq.call(arguments)))}ad.prototype=d.prototype;var f=new ad;var e=d.apply(f,a.concat(aq.call(arguments)));if(Object(e)===e){return e}return f}};ap.bindAll=function(b){var a=aq.call(arguments,1);if(a.length==0){a=ap.functions(b)}ah(a,function(c){b[c]=ap.bind(b[c],b)});return b};ap.memoize=function(c,b){var a={};b||(b=ap.identity);return function(){var d=b.apply(this,arguments);return ap.has(a,d)?a[d]:(a[d]=c.apply(this,arguments))}};ap.delay=function(b,c){var a=aq.call(arguments,2);return setTimeout(function(){return b.apply(null,a)},c)};ap.defer=function(a){return ap.delay.apply(ap,[a,1].concat(aq.call(arguments,1)))};ap.throttle=function(c,d){var b,f,g,h,e,i;var a=ap.debounce(function(){e=h=false},d);return function(){b=this;f=arguments;var j=function(){g=null;if(e){i=c.apply(b,f)}a()};if(!g){g=setTimeout(j,d)}if(h){e=true}else{h=true;i=c.apply(b,f)}a();return i}};ap.debounce=function(c,e,b){var d,a;return function(){var i=this,h=arguments;var g=function(){d=null;if(!b){a=c.apply(i,h)}};var f=b&&!d;clearTimeout(d);d=setTimeout(g,e);if(f){a=c.apply(i,h)}return a}};ap.once=function(c){var a=false,b;return function(){if(a){return b}a=true;b=c.apply(this,arguments);c=null;return b}};ap.wrap=function(a,b){return function(){var c=[a];af.apply(c,arguments);return b.apply(this,c)}};ap.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--){b=[a[c].apply(this,b)]}return b[0]}};ap.after=function(b,a){if(b<=0){return a()}return function(){if(--b<1){return a.apply(this,arguments)}}};ap.keys=Y||function(c){if(c!==Object(c)){throw new TypeError("Invalid object")}var b=[];for(var a in c){if(ap.has(c,a)){b[b.length]=a}}return b};ap.values=function(c){var a=[];for(var b in c){if(ap.has(c,b)){a.push(c[b])}}return a};ap.pairs=function(c){var b=[];for(var a in c){if(ap.has(c,a)){b.push([a,c[a]])}}return b};ap.invert=function(c){var a={};for(var b in c){if(ap.has(c,b)){a[c[b]]=b}}return a};ap.functions=ap.methods=function(c){var b=[];for(var a in c){if(ap.isFunction(c[a])){b.push(a)}}return b.sort()};ap.extend=function(a){ah(aq.call(arguments,1),function(b){for(var c in b){a[c]=b[c]}});return a};ap.pick=function(b){var c={};var a=aB.apply(V,aq.call(arguments,1));ah(a,function(d){if(d in b){c[d]=b[d]}});return c};ap.omit=function(c){var d={};var b=aB.apply(V,aq.call(arguments,1));for(var a in c){if(!ap.contains(b,a)){d[a]=c[a]}}return d};ap.defaults=function(a){ah(aq.call(arguments,1),function(b){for(var c in b){if(a[c]==null){a[c]=b[c]}}});return a};ap.clone=function(a){if(!ap.isObject(a)){return a}return ap.isArray(a)?a.slice():ap.extend({},a)};ap.tap=function(b,a){a(b);return b};var aj=function(h,g,b,c){if(h===g){return h!==0||1/h==1/g}if(h==null||g==null){return h===g}if(h instanceof ap){h=h._wrapped}if(g instanceof ap){g=g._wrapped}var e=U.call(h);if(e!=U.call(g)){return false}switch(e){case"[object String]":return h==String(g);case"[object Number]":return h!=+h?g!=+g:(h==0?1/h==1/g:h==+g);case"[object Date]":case"[object Boolean]":return +h==+g;case"[object RegExp]":return h.source==g.source&&h.global==g.global&&h.multiline==g.multiline&&h.ignoreCase==g.ignoreCase}if(typeof h!="object"||typeof g!="object"){return false}var a=b.length;while(a--){if(b[a]==h){return c[a]==g}}b.push(h);c.push(g);var j=0,k=true;if(e=="[object Array]"){j=h.length;k=j==g.length;if(k){while(j--){if(!(k=aj(h[j],g[j],b,c))){break}}}}else{var f=h.constructor,d=g.constructor;if(f!==d&&!(ap.isFunction(f)&&(f instanceof f)&&ap.isFunction(d)&&(d instanceof d))){return false}for(var i in h){if(ap.has(h,i)){j++;if(!(k=ap.has(g,i)&&aj(h[i],g[i],b,c))){break}}}if(k){for(i in g){if(ap.has(g,i)&&!(j--)){break}}k=!j}}b.pop();c.pop();return k};ap.isEqual=function(b,a){return aj(b,a,[],[])};ap.isEmpty=function(b){if(b==null){return true}if(ap.isArray(b)||ap.isString(b)){return b.length===0}for(var a in b){if(ap.has(b,a)){return false}}return true};ap.isElement=function(a){return !!(a&&a.nodeType===1)};ap.isArray=ax||function(a){return U.call(a)=="[object Array]"};ap.isObject=function(a){return a===Object(a)};ah(["Arguments","Function","String","Number","Date","RegExp"],function(a){ap["is"+a]=function(b){return U.call(b)=="[object "+a+"]"}});if(!ap.isArguments(arguments)){ap.isArguments=function(a){return !!(a&&ap.has(a,"callee"))}}if(typeof(/./)!=="function"){ap.isFunction=function(a){return typeof a==="function"}}ap.isFinite=function(a){return ap.isNumber(a)&&isFinite(a)};ap.isNaN=function(a){return ap.isNumber(a)&&a!=+a};ap.isBoolean=function(a){return a===true||a===false||U.call(a)=="[object Boolean]"};ap.isNull=function(a){return a===null};ap.isUndefined=function(a){return a===void 0};ap.has=function(b,a){return ag.call(b,a)};ap.noConflict=function(){az._=ai;return this};ap.identity=function(a){return a};ap.times=function(d,c,b){for(var a=0;a<d;a++){c.call(b,a)}};ap.random=function(b,a){if(a==null){a=b;b=0}return b+(0|Math.random()*(a-b+1))};var am={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};am.unescape=ap.invert(am.escape);var al={escape:new RegExp("["+ap.keys(am.escape).join("")+"]","g"),unescape:new RegExp("("+ap.keys(am.unescape).join("|")+")","g")};ap.each(["escape","unescape"],function(a){ap[a]=function(b){if(b==null){return""}return(""+b).replace(al[a],function(c){return am[a][c]})}});ap.result=function(a,c){if(a==null){return null}var b=a[c];return ap.isFunction(b)?b.call(a):b};ap.mixin=function(a){ah(ap.functions(a),function(b){var c=ap[b]=a[b];ap.prototype[b]=function(){var d=[this._wrapped];af.apply(d,arguments);return av.call(this,c.apply(ap,d))}})};var aC=0;ap.uniqueId=function(a){var b=aC++;return a?a+b:b};ap.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var ay=/(.)^/;var ac={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var ae=/\\|'|\r|\n|\t|\u2028|\u2029/g;ap.template=function(i,d,c){c=ap.defaults({},c,ap.templateSettings);var e=new RegExp([(c.escape||ay).source,(c.interpolate||ay).source,(c.evaluate||ay).source].join("|")+"|$","g");var f=0;var a="__p+='";i.replace(e,function(m,n,l,k,j){a+=i.slice(f,j).replace(ae,function(o){return"\\"+ac[o]});a+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":l?"'+\n((__t=("+l+"))==null?'':__t)+\n'":k?"';\n"+k+"\n__p+='":"";f=j+m.length});a+="';\n";if(!c.variable){a="with(obj||{}){\n"+a+"}\n"}a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var b=new Function(c.variable||"obj","_",a)}catch(g){g.source=a;throw g}if(d){return b(d,ap)}var h=function(j){return b.call(this,j,ap)};h.source="function("+(c.variable||"obj")+"){\n"+a+"}";return h};ap.chain=function(a){return ap(a).chain()};var av=function(a){return this._chain?ap(a).chain():a};ap.mixin(ap);ah(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=V[a];ap.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);if((a=="shift"||a=="splice")&&c.length===0){delete c[0]}return av.call(this,c)}});ah(["concat","join","slice"],function(a){var b=V[a];ap.prototype[a]=function(){return av.call(this,b.apply(this._wrapped,arguments))}});ap.extend(ap.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);(function(){var P,F,V,X,af,ag,ab,G,K,M,I,L,ah,Q,aa,O,U,H,ae,aj,W,S,R,ad,ac,T,J=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b}}return -1},Z=[].slice,Y={}.hasOwnProperty,ai=function(d,b){for(var a in b){if(Y.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d},N=function(a,b){return function(){return a.apply(b,arguments)}};ad=["extended","included"];O=(function(){function a(){}a["extends"]=function(e){var b,d,c;for(b in e){d=e[b];if(J.call(ad,b)<0){this[b]=d}}if((c=e.extended)!=null){c.apply(this)}return this};a.includes=function(e){var b,d,c;for(b in e){d=e[b];if(J.call(ad,b)<0){this.prototype[b]=d}}if((c=e.included)!=null){c.apply(this)}return this};a.delegate=function(){var d,f,g,e,c,b;d=1<=arguments.length?Z.call(arguments,0):[];g=d.pop();b=[];for(e=0,c=d.length;e<c;e++){f=d[e];b.push(this.prototype[f]=g.prototype[f])}return b};a.aliasFunction=function(d,c){var b=this;return this.prototype[d]=function(){var e;e=1<=arguments.length?Z.call(arguments,0):[];return b.prototype[c].apply(b,e)}};a.aliasProperty=function(c,b){return Object.defineProperty(this.prototype,c,{get:function(){return this[b]},set:function(d){return this[b]=d}})};a.included=function(b){return b.call(this,this.prototype)};return a})();ac=Array.prototype.slice;P=function(b,a){if(a==null){a=document}if(typeof b==="object"||(typeof exports!=="undefined"&&exports!==null)){return b}return a.querySelector(b)};S=(function(){function a(){}a.uniqid=(function(){var b;b=0;return{get:function(){return b++}}})();a.extend=function(){var h,c,e,g,f,d,b;e=arguments[0],f=2<=arguments.length?Z.call(arguments,1):[];c=e;for(d=0,b=f.length;d<b;d++){h=f[d];for(g in h){if(!Y.call(h,g)){continue}c[g]=h[g]}}return c};a.clampRGB=function(b){switch(b>>8){case 0:return b;case -1:return 0;case 1:return 255}};a.copyAttributes=function(i,j,b){var g,e,h,f,d,c;if(b==null){b={}}f=i.attributes;c=[];for(e=0,h=f.length;e<h;e++){g=f[e];if((b.except!=null)&&(d=g.nodeName,J.call(b.except,d)>=0)){continue}c.push(j.setAttribute(g.nodeName,g.nodeValue))}return c};a.dataArray=function(b){if(b==null){b=0}if(af.NodeJS||(window.Uint8Array!=null)){return new Uint8Array(b)}return new Array(b)};return a})();if(typeof exports!=="undefined"&&exports!==null){aj=exports;ab=require("canvas");ah=ab.Image;M=require("fibers");R=require("fs")}else{aj=window}af=(function(b){ai(a,b);a.version={release:"4.1.1",date:"4/8/2013"};a.DEBUG=false;a.allowRevert=true;a.crossOrigin="anonymous";a.remoteProxy="";a.proxyParam="camanProxyUrl";a.NodeJS=typeof exports!=="undefined"&&exports!==null;a.autoload=!a.NodeJS;a.toString=function(){return"Version "+a.version.release+", Released "+a.version.date};a.getAttrId=function(c){if(a.NodeJS){return true}if(typeof c==="string"){c=P(c)}if(!((c!=null)&&(c.getAttribute!=null))){return null}return c.getAttribute("data-caman-id")};function a(){var c,f,e,d=this;if(arguments.length===0){throw"Invalid arguments"}if(this instanceof a){this.finishInit=this.finishInit.bind(this);this.imageLoaded=this.imageLoaded.bind(this);c=arguments[0];if(!a.NodeJS){e=parseInt(a.getAttrId(c[0]),10);f=typeof c[1]==="function"?c[1]:typeof c[2]==="function"?c[2]:function(){};if(!isNaN(e)&&W.has(e)){return W.execute(e,f)}}this.id=S.uniqid.get();this.initializedPixelData=this.originalPixelData=null;this.cropCoordinates={x:0,y:0};this.cropped=false;this.resized=false;this.pixelStack=[];this.layerStack=[];this.canvasQueue=[];this.currentLayer=null;this.scaled=false;this.analyze=new F(this);this.renderer=new ae(this);this.domIsLoaded(function(){d.parseArguments(c);return d.setup()});return this}else{return new a(arguments)}}a.prototype.domIsLoaded=function(c){var d,e=this;if(a.NodeJS){return setTimeout(function(){return c.call(e)},0)}else{if(document.readyState==="complete"){aa.debug("DOM initialized");return setTimeout(function(){return c.call(e)},0)}else{d=function(){if(document.readyState==="complete"){aa.debug("DOM initialized");return c.call(e)}};return document.addEventListener("readystatechange",d,false)}}};a.prototype.parseArguments=function(d){var e,g,f,c;if(d.length===0){throw"Invalid arguments given"}this.initObj=null;this.initType=null;this.imageUrl=null;this.callback=function(){};this.setInitObject(d[0]);if(d.length===1){return}switch(typeof d[1]){case"string":this.imageUrl=d[1];break;case"function":this.callback=d[1]}if(d.length===2){return}this.callback=d[2];if(d.length===4){f=d[4];c=[];for(e in f){if(!Y.call(f,e)){continue}g=f[e];c.push(this.options[e]=g)}return c}};a.prototype.setInitObject=function(c){if(a.NodeJS){this.initObj=c;this.initType="node";return}if(typeof c==="object"){this.initObj=c}else{this.initObj=P(c)}if(this.initObj==null){throw"Could not find image or canvas for initialization."}return this.initType=this.initObj.nodeName.toLowerCase()};a.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}};a.prototype.initNode=function(){var c=this;aa.debug("Initializing for NodeJS");this.image=new ah();this.image.onload=function(){aa.debug("Image loaded. Width = "+(c.imageWidth())+", Height = "+(c.imageHeight()));c.canvas=new ab(c.imageWidth(),c.imageHeight());return c.finishInit()};this.image.onerror=function(d){throw d};return this.image.src=this.initObj};a.prototype.initImage=function(){this.image=this.initObj;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");S.copyAttributes(this.image,this.canvas,{except:["src"]});this.image.parentNode.replaceChild(this.canvas,this.image);this.imageAdjustments();return this.waitForImageLoaded()};a.prototype.initCanvas=function(){this.canvas=this.initObj;this.context=this.canvas.getContext("2d");if(this.imageUrl!=null){this.image=document.createElement("img");this.image.src=this.imageUrl;this.imageAdjustments();return this.waitForImageLoaded()}else{return this.finishInit()}};a.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()){aa.debug(this.image.src,"->",this.hiDPIReplacement());this.swapped=true;this.image.src=this.hiDPIReplacement()}if(L.isRemote(this.image)){this.image.src=L.proxyUrl(this.image.src);return aa.debug("Remote image detected, using URL = "+this.image.src)}};a.prototype.waitForImageLoaded=function(){if(this.isImageLoaded()){return this.imageLoaded()}else{return this.image.onload=this.imageLoaded}};a.prototype.isImageLoaded=function(){if(!this.image.complete){return false}if((this.image.naturalWidth!=null)&&this.image.naturalWidth===0){return false}return true};a.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth};a.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight};a.prototype.imageLoaded=function(){aa.debug("Image loaded. Width = "+(this.imageWidth())+", Height = "+(this.imageHeight()));if(this.swapped){this.canvas.width=this.imageWidth()/this.hiDPIRatio();this.canvas.height=this.imageHeight()/this.hiDPIRatio()}else{this.canvas.width=this.imageWidth();this.canvas.height=this.imageHeight()}return this.finishInit()};a.prototype.finishInit=function(){var e,d,g,c,f;if(this.context==null){this.context=this.canvas.getContext("2d")}this.originalWidth=this.preScaledWidth=this.width=this.canvas.width;this.originalHeight=this.preScaledHeight=this.height=this.canvas.height;this.hiDPIAdjustments();if(!this.hasId()){this.assignId()}if(this.image!=null){this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight)}this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);this.pixelData=this.imageData.data;if(a.allowRevert){this.initializedPixelData=S.dataArray(this.pixelData.length);this.originalPixelData=S.dataArray(this.pixelData.length);f=this.pixelData;for(e=g=0,c=f.length;g<c;e=++g){d=f[e];this.initializedPixelData[e]=d;this.originalPixelData[e]=d}}this.dimensions={width:this.canvas.width,height:this.canvas.height};W.put(this.id,this);this.callback.call(this,this);return this.callback=function(){}};a.prototype.reloadCanvasData=function(){this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);return this.pixelData=this.imageData.data};a.prototype.resetOriginalPixelData=function(){var f,e,h,d,g,c;if(!a.allowRevert){throw"Revert disabled"}this.originalPixelData=S.dataArray(this.pixelData.length);g=this.pixelData;c=[];for(f=h=0,d=g.length;h<d;f=++h){e=g[f];c.push(this.originalPixelData[f]=e)}return c};a.prototype.hasId=function(){return a.getAttrId(this.canvas)!=null};a.prototype.assignId=function(){if(a.NodeJS||this.canvas.getAttribute("data-caman-id")){return}return this.canvas.setAttribute("data-caman-id",this.id)};a.prototype.hiDPIDisabled=function(){return this.canvas.getAttribute("data-caman-hidpi-disabled")!==null};a.prototype.hiDPIAdjustments=function(){var c;if(a.NodeJS||!this.needsHiDPISwap()){return}c=this.hiDPIRatio();if(c!==1){aa.debug("HiDPI ratio = "+c);this.scaled=true;this.preScaledWidth=this.canvas.width;this.preScaledHeight=this.canvas.height;this.canvas.width=this.preScaledWidth*c;this.canvas.height=this.preScaledHeight*c;this.canvas.style.width=""+this.preScaledWidth+"px";this.canvas.style.height=""+this.preScaledHeight+"px";this.context.scale(c,c);this.width=this.originalWidth=this.canvas.width;return this.height=this.originalHeight=this.canvas.height}};a.prototype.hiDPIRatio=function(){var d,c;c=window.devicePixelRatio||1;d=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1;return c/d};a.prototype.hiDPICapable=function(){return(window.devicePixelRatio!=null)&&window.devicePixelRatio!==1};a.prototype.needsHiDPISwap=function(){if(this.hiDPIDisabled()||!this.hiDPICapable()){return false}return this.hiDPIReplacement()!==null};a.prototype.hiDPIReplacement=function(){if(this.image==null){return null}return this.image.getAttribute("data-caman-hidpi")};a.prototype.replaceCanvas=function(d){var c;c=this.canvas;this.canvas=d;this.context=this.canvas.getContext("2d");if(!a.NodeJS){c.parentNode.replaceChild(this.canvas,c)}this.width=this.canvas.width;this.height=this.canvas.height;this.reloadCanvasData();return this.dimensions={width:this.canvas.width,height:this.canvas.height}};a.prototype.render=function(d){var c=this;if(d==null){d=function(){}}K.trigger(this,"renderStart");return this.renderer.execute(function(){c.context.putImageData(c.imageData,0,0);return d.call(c)})};a.prototype.revert=function(f){var e,d,h,c,g;if(f==null){f=true}if(!a.allowRevert){throw"Revert disabled"}g=this.originalVisiblePixels();for(e=h=0,c=g.length;h<c;e=++h){d=g[e];this.pixelData[e]=d}if(f){return this.context.putImageData(this.imageData,0,0)}};a.prototype.reset=function(){var e,k,h,c,d,j,f,i,g;e=document.createElement("canvas");S.copyAttributes(this.canvas,e);e.width=this.originalWidth;e.height=this.originalHeight;k=e.getContext("2d");c=k.getImageData(0,0,e.width,e.height);j=c.data;g=this.initializedPixelData;for(h=f=0,i=g.length;f<i;h=++f){d=g[h];j[h]=d}k.putImageData(c,0,0);this.cropCoordinates={x:0,y:0};this.resized=false;return this.replaceCanvas(e)};a.prototype.originalVisiblePixels=function(){var l,t,s,f,e,u,w,m,n,q,p,c,v,r,i,g,d,o,k,j,h;if(!a.allowRevert){throw"Revert disabled"}q=[];c=this.cropCoordinates.x;f=c+this.width;v=this.cropCoordinates.y;e=v+this.height;if(this.resized){l=document.createElement("canvas");l.width=this.originalWidth;l.height=this.originalHeight;s=l.getContext("2d");w=s.getImageData(0,0,l.width,l.height);n=w.data;o=this.originalPixelData;for(u=i=0,d=o.length;i<d;u=++i){m=o[u];n[u]=m}s.putImageData(w,0,0);p=document.createElement("canvas");p.width=this.width;p.height=this.height;s=p.getContext("2d");s.drawImage(l,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height);n=s.getImageData(0,0,this.width,this.height).data;r=this.width}else{n=this.originalPixelData;r=this.originalWidth}for(u=g=0,k=n.length;g<k;u=g+=4){t=U.locationToCoordinates(u,r);if(((c<=(j=t.x)&&j<f))&&((v<=(h=t.y)&&h<e))){q.push(n[u],n[u+1],n[u+2],n[u+3])}}return q};a.prototype.process=function(c,d){this.renderer.add({type:I.Type.Single,name:c,processFn:d});return this};a.prototype.processKernel=function(d,h,i,c){var e,g,f;if(i==null){i=null}if(c==null){c=0}if(i==null){i=0;for(e=g=0,f=h.length;0<=f?g<f:g>f;e=0<=f?++g:--g){i+=h[e]}}this.renderer.add({type:I.Type.Kernel,name:d,adjust:h,divisor:i,bias:c});return this};a.prototype.processPlugin=function(d,c){this.renderer.add({type:I.Type.Plugin,plugin:d,args:c});return this};a.prototype.newLayer=function(d){var c;c=new Q(this);this.canvasQueue.push(c);this.renderer.add({type:I.Type.LayerDequeue});d.call(c);this.renderer.add({type:I.Type.LayerFinished});return this};a.prototype.executeLayer=function(c){return this.pushContext(c)};a.prototype.pushContext=function(c){this.layerStack.push(this.currentLayer);this.pixelStack.push(this.pixelData);this.currentLayer=c;return this.pixelData=c.pixelData};a.prototype.popContext=function(){this.pixelData=this.pixelStack.pop();return this.currentLayer=this.layerStack.pop()};a.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()};return a})(O);aj.Caman=af;af.Analyze=(function(){function a(b){this.c=b}a.prototype.calculateLevels=function(){var b,g,h,f,d,c,e;g={r:{},g:{},b:{}};for(b=f=0;f<=255;b=++f){g.r[b]=0;g.g[b]=0;g.b[b]=0}for(b=d=0,e=this.c.pixelData.length;d<e;b=d+=4){g.r[this.c.pixelData[b]]++;g.g[this.c.pixelData[b+1]]++;g.b[this.c.pixelData[b+2]]++}h=this.c.pixelData.length/4;for(b=c=0;c<=255;b=++c){g.r[b]/=h;g.g[b]/=h;g.b[b]/=h}return g};return a})();F=af.Analyze;af.DOMUpdated=function(){var c,f,e,d,b,a;f=document.querySelectorAll("img[data-caman]");if(!(f.length>0)){return}a=[];for(d=0,b=f.length;d<b;d++){c=f[d];a.push(e=new ag(c,function(){this.parse();return this.execute()}))}return a};if(af.autoload){(function(){if(document.readyState==="complete"){return af.DOMUpdated()}else{return document.addEventListener("DOMContentLoaded",af.DOMUpdated,false)}})()}ag=(function(){var b;b="(\\w+)\\((.*?)\\)";function a(d,c){this.dataStr=d.getAttribute("data-caman");this.caman=af(d,c.bind(this))}a.prototype.parse=function(){var m,l,d,e,j,n,f,c,k,h,o,i,g;this.ele=this.caman.canvas;c=new RegExp(b,"g");k=this.dataStr.match(c);if(!(k.length>0)){return}c=new RegExp(b);g=[];for(h=0,o=k.length;h<o;h++){j=k[h];i=j.match(c),f=i[0],d=i[1],m=i[2];n=new Function("return function() {        this."+d+"("+m+");      };");try{e=n();g.push(e.call(this.caman))}catch(p){l=p;g.push(aa.debug(l))}}return g};a.prototype.execute=function(){var c;c=this.ele;return this.caman.render(function(){return c.parentNode.replaceChild(this.toImage(),c)})};return a})();af.Blender=(function(){function a(){}a.blenders={};a.register=function(b,c){return this.blenders[b]=c};a.execute=function(b,c,d){return this.blenders[b](c,d)};return a})();V=af.Blender;af.Calculate=(function(){function a(){}a.distance=function(c,e,b,d){return Math.sqrt(Math.pow(b-c,2)+Math.pow(d-e,2))};a.randomRange=function(d,b,c){var e;if(c==null){c=false}e=d+(Math.random()*(b-d));if(c){return e.toFixed(c)}else{return Math.round(e)}};a.luminance=function(b){return(0.299*b.r)+(0.587*b.g)+(0.114*b.b)};a.bezier=function(E,A,x,C,f,al){var e,d,n,m,ak,D,b,q,p,i,g,o,s,c,l,k,j,h,B,z,w,v,u,t,r,am,y;l=E[0];B=E[1];k=A[0];z=A[1];j=x[0];w=x[1];h=C[0];v=C[1];b={};ak=parseInt(3*(k-l),10);n=3*(j-k)-ak;e=h-l-ak-n;D=3*(z-B);m=3*(w-z)-D;d=v-B-D-m;for(i=u=0;u<1000;i=++u){c=i/1000;q=Math.round((e*Math.pow(c,3))+(n*Math.pow(c,2))+(ak*c)+l);p=Math.round((d*Math.pow(c,3))+(m*Math.pow(c,2))+(D*c)+B);if(f&&p<f){p=f}else{if(al&&p>al){p=al}}b[q]=p}if(b.length<C[0]+1){for(i=t=0,am=C[0];0<=am?t<=am:t>=am;i=0<=am?++t:--t){if(b[i]==null){o=[i-1,b[i-1]];for(g=r=i,y=C[0];i<=y?r<=y:r>=y;g=i<=y?++r:--r){if(b[g]!=null){s=[g,b[g]];break}}b[i]=o[1]+((s[1]-o[1])/(s[0]-o[0]))*(i-o[0])}}}if(b[C[0]]==null){b[C[0]]=b[C[0]-1]}return b};return a})();X=af.Calculate;af.Convert=(function(){function a(){}a.hexToRGB=function(e){var b,d,c;if(e.charAt(0)==="#"){e=e.substr(1)}c=parseInt(e.substr(0,2),16);d=parseInt(e.substr(2,2),16);b=parseInt(e.substr(4,2),16);return{r:c,g:d,b:b}};a.rgbToHSL=function(b,f,h){var g,e,c,i,d,j;if(typeof b==="object"){f=b.g;h=b.b;b=b.r}b/=255;f/=255;h/=255;i=Math.max(b,f,h);d=Math.min(b,f,h);c=(i+d)/2;if(i===d){e=j=0}else{g=i-d;j=c>0.5?g/(2-i-d):g/(i+d);e=(function(){switch(i){case b:return(f-h)/g+(f<h?6:0);case f:return(h-b)/g+2;case h:return(b-f)/g+4}})();e/=6}return{h:e,s:j,l:c}};a.hslToRGB=function(e,d,c){var b,g,i,h,f;if(typeof e==="object"){d=e.s;c=e.l;e=e.h}if(d===0){f=g=b=c}else{h=c<0.5?c*(1+d):c+d-c*d;i=2*c-h;f=this.hueToRGB(i,h,e+1/3);g=this.hueToRGB(i,h,e);b=this.hueToRGB(i,h,e-1/3)}return{r:f*255,g:g*255,b:b*255}};a.hueToRGB=function(d,c,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return d+(c-d)*6*b}if(b<1/2){return c}if(b<2/3){return d+(c-d)*(2/3-b)*6}return d};a.rgbToHSV=function(b,e,g){var f,d,h,c,j,i;b/=255;e/=255;g/=255;h=Math.max(b,e,g);c=Math.min(b,e,g);i=h;f=h-c;j=h===0?0:f/h;if(h===c){d=0}else{d=(function(){switch(h){case b:return(e-g)/f+(e<g?6:0);case e:return(g-b)/f+2;case g:return(b-e)/f+4}})();d/=6}return{h:d,s:j,v:i}};a.hsvToRGB=function(f,l,j){var i,h,g,e,d,c,b,k;e=Math.floor(f*6);h=f*6-e;d=j*(1-l);c=j*(1-h*l);k=j*(1-(1-h)*l);switch(e%6){case 0:b=j;g=k;i=d;break;case 1:b=c;g=j;i=d;break;case 2:b=d;g=j;i=k;break;case 3:b=d;g=c;i=j;break;case 4:b=k;g=d;i=j;break;case 5:b=j;g=d;i=c}return{r:Math.floor(b*255),g:Math.floor(g*255),b:Math.floor(i*255)}};a.rgbToXYZ=function(e,d,c){var b,g,f;e/=255;d/=255;c/=255;if(e>0.04045){e=Math.pow((e+0.055)/1.055,2.4)}else{e/=12.92}if(d>0.04045){d=Math.pow((d+0.055)/1.055,2.4)}else{d/=12.92}if(c>0.04045){c=Math.pow((c+0.055)/1.055,2.4)}else{c/=12.92}b=e*0.4124+d*0.3576+c*0.1805;g=e*0.2126+d*0.7152+c*0.0722;f=e*0.0193+d*0.1192+c*0.9505;return{x:b*100,y:g*100,z:f*100}};a.xyzToRGB=function(c,g,f){var b,e,d;c/=100;g/=100;f/=100;d=(3.2406*c)+(-1.5372*g)+(-0.4986*f);e=(-0.9689*c)+(1.8758*g)+(0.0415*f);b=(0.0557*c)+(-0.204*g)+(1.057*f);if(d>0.0031308){d=(1.055*Math.pow(d,0.4166666667))-0.055}else{d*=12.92}if(e>0.0031308){e=(1.055*Math.pow(e,0.4166666667))-0.055}else{e*=12.92}if(b>0.0031308){b=(1.055*Math.pow(b,0.4166666667))-0.055}else{b*=12.92}return{r:d*255,g:e*255,b:b*255}};a.xyzToLab=function(j,g,f){var i,h,e,d,c,b;if(typeof j==="object"){g=j.y;f=j.z;j=j.x}d=95.047;c=100;b=108.883;j/=d;g/=c;f/=b;if(j>0.008856451679){j=Math.pow(j,0.3333333333)}else{j=(7.787037037*j)+0.1379310345}if(g>0.008856451679){g=Math.pow(g,0.3333333333)}else{g=(7.787037037*g)+0.1379310345}if(f>0.008856451679){f=Math.pow(f,0.3333333333)}else{f=(7.787037037*f)+0.1379310345}e=116*g-16;i=500*(j-g);h=200*(g-f);return{l:e,a:i,b:h}};a.labToXYZ=function(e,d,c){var b,g,f;if(typeof e==="object"){d=e.a;c=e.b;e=e.l}g=(e+16)/116;b=g+(d/500);f=g-(c/200);if(b>0.2068965517){b=b*b*b}else{b=0.1284185493*(b-0.1379310345)}if(g>0.2068965517){g=g*g*g}else{g=0.1284185493*(g-0.1379310345)}if(f>0.2068965517){f=f*f*f}else{f=0.1284185493*(f-0.1379310345)}return{x:b*95.047,y:g*100,z:f*108.883}};a.rgbToLab=function(e,d,b){var c;if(typeof e==="object"){d=e.g;b=e.b;e=e.r}c=this.rgbToXYZ(e,d,b);return this.xyzToLab(c)};a.labToRGB=function(d,c,b){};return a})();G=af.Convert;af.Event=(function(){function a(){}a.events={};a.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"];a.trigger=function(i,d,h){var e,g,c,f,b;if(h==null){h=null}if(this.events[d]&&this.events[d].length){f=this.events[d];b=[];for(g=0,c=f.length;g<c;g++){e=f[g];if(e.target===null||i.id===e.target.id){b.push(e.fn.call(i,h))}else{b.push(void 0)}}return b}};a.listen=function(e,d,c){var f,b;if(typeof e==="string"){b=e;f=d;e=null;d=b;c=f}if(J.call(this.types,d)<0){return false}if(!this.events[d]){this.events[d]=[]}this.events[d].push({target:e,fn:c});return true};return a})();K=af.Event;af.Filter=(function(){function a(){}a.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6};a.register=function(b,c){return af.prototype[b]=c};return a})();I=af.Filter;af.IO=(function(){function a(){}a.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/;a.isRemote=function(b){if(b==null){return false}if(this.corsEnabled(b)){return false}return this.isURLRemote(b.src)};a.corsEnabled=function(b){var c;return(b.crossOrigin!=null)&&((c=b.crossOrigin.toLowerCase())==="anonymous"||c==="use-credentials")};a.isURLRemote=function(b){var c;c=b.match(this.domainRegex);if(c){return c[1]!==document.domain}else{return false}};a.remoteCheck=function(b){if(this.isURLRemote(b)){if(!af.remoteProxy.length){aa.info("Attempting to load a remote image without a configured proxy. URL: "+b)}else{if(af.isURLRemote(af.remoteProxy)){aa.info("Cannot use a remote proxy for loading images.");return}return this.proxyUrl(b)}}};a.proxyUrl=function(b){return""+af.remoteProxy+"?"+af.proxyParam+"="+(encodeURIComponent(b))};a.useProxy=function(c){var b;b={ruby:"rb",python:"py",perl:"pl",javascript:"js"};c=c.toLowerCase();if(b[c]!=null){c=b[c]}return"proxies/caman_proxy."+c};return a})();af.prototype.save=function(){if(typeof exports!=="undefined"&&exports!==null){return this.nodeSave.apply(this,arguments)}else{return this.browserSave.apply(this,arguments)}};af.prototype.browserSave=function(a){var b;if(a==null){a="png"}a=a.toLowerCase();b=this.toBase64(a).replace("image/"+a,"image/octet-stream");return document.location.href=b};af.prototype.nodeSave=function(c,a){var d,b;if(a==null){a=true}try{b=R.statSync(c);if(b.isFile()&&!a){return false}}catch(e){d=e;aa.debug("Creating output file "+c)}return R.writeFile(c,this.canvas.toBuffer(),function(){return aa.debug("Finished writing to "+c)})};af.prototype.toImage=function(b){var a;a=document.createElement("img");a.src=this.toBase64(b);a.width=this.dimensions.width;a.height=this.dimensions.height;if(window.devicePixelRatio){a.width/=window.devicePixelRatio;a.height/=window.devicePixelRatio}return a};af.prototype.toBase64=function(a){if(a==null){a="png"}a=a.toLowerCase();return this.canvas.toDataURL("image/"+a)};L=af.IO;af.Layer=(function(){function a(b){this.c=b;this.filter=this.c;this.options={blendingMode:"normal",opacity:1};this.layerID=S.uniqid.get();this.canvas=typeof exports!=="undefined"&&exports!==null?new ab():document.createElement("canvas");this.canvas.width=this.c.dimensions.width;this.canvas.height=this.c.dimensions.height;this.context=this.canvas.getContext("2d");this.context.createImageData(this.canvas.width,this.canvas.height);this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);this.pixelData=this.imageData.data}a.prototype.newLayer=function(b){return this.c.newLayer.call(this.c,b)};a.prototype.setBlendingMode=function(b){this.options.blendingMode=b;return this};a.prototype.opacity=function(b){this.options.opacity=b/100;return this};a.prototype.copyParent=function(){var c,b,e,d;b=this.c.pixelData;for(c=e=0,d=this.c.pixelData.length;e<d;c=e+=4){this.pixelData[c]=b[c];this.pixelData[c+1]=b[c+1];this.pixelData[c+2]=b[c+2];this.pixelData[c+3]=b[c+3]}return this};a.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)};a.prototype.overlayImage=function(b){if(typeof b==="object"){b=b.src}else{if(typeof b==="string"&&b[0]==="#"){b=P(b).src}}if(!b){return this}this.c.renderer.renderQueue.push({type:I.Type.LoadOverlay,src:b,layer:this});return this};a.prototype.applyToParent=function(){var g,i,h,j,b,d,e,f,c;h=this.c.pixelStack[this.c.pixelStack.length-1];i=this.c.pixelData;c=[];for(g=e=0,f=i.length;e<f;g=e+=4){d={r:h[g],g:h[g+1],b:h[g+2],a:h[g+3]};b={r:i[g],g:i[g+1],b:i[g+2],a:i[g+3]};j=V.execute(this.options.blendingMode,b,d);j.r=S.clampRGB(j.r);j.g=S.clampRGB(j.g);j.b=S.clampRGB(j.b);if(j.a==null){j.a=b.a}h[g]=d.r-((d.r-j.r)*(this.options.opacity*(j.a/255)));h[g+1]=d.g-((d.g-j.g)*(this.options.opacity*(j.a/255)));c.push(h[g+2]=d.b-((d.b-j.b)*(this.options.opacity*(j.a/255))))}return c};return a})();Q=af.Layer;af.Logger=(function(){function a(){var c,e,b,d;d=["log","info","warn","error"];for(e=0,b=d.length;e<b;e++){c=d[e];this[c]=(function(f){return function(){var g,h;g=1<=arguments.length?Z.call(arguments,0):[];if(!af.DEBUG){return}try{return console[f].apply(console,g)}catch(i){h=i;return console[f](g)}}})(c)}this.debug=this.log}return a})();aa=new af.Logger();af.Pixel=(function(){a.coordinatesToLocation=function(b,d,c){return(d*c+b)*4};a.locationToCoordinates=function(d,c){var b,e;e=Math.floor(d/(c*4));b=(d%(c*4))/4;return{x:b,y:e}};function a(e,d,b,c,f){this.r=e!=null?e:0;this.g=d!=null?d:0;this.b=b!=null?b:0;this.a=c!=null?c:255;this.c=f!=null?f:null;this.loc=0}a.prototype.setContext=function(b){return this.c=b};a.prototype.locationXY=function(){var b,c;if(this.c==null){throw"Requires a CamanJS context"}c=this.c.dimensions.height-Math.floor(this.loc/(this.c.dimensions.width*4));b=(this.loc%(this.c.dimensions.width*4))/4;return{x:b,y:c}};a.prototype.pixelAtLocation=function(b){if(this.c==null){throw"Requires a CamanJS context"}return new a(this.c.pixelData[b],this.c.pixelData[b+1],this.c.pixelData[b+2],this.c.pixelData[b+3],this.c)};a.prototype.getPixelRelative=function(d,b){var c;if(this.c==null){throw"Requires a CamanJS context"}c=this.loc+(this.c.dimensions.width*4*(b*-1))+(4*d);if(c>this.c.pixelData.length||c<0){return new a(0,0,0,255,this.c)}return this.pixelAtLocation(c)};a.prototype.putPixelRelative=function(e,b,c){var d;if(this.c==null){throw"Requires a CamanJS context"}d=this.loc+(this.c.dimensions.width*4*(b*-1))+(4*e);if(newLoc>this.c.pixelData.length||newLoc<0){return}this.c.pixelData[newLoc]=c.r;this.c.pixelData[newLoc+1]=c.g;this.c.pixelData[newLoc+2]=c.b;this.c.pixelData[newLoc+3]=c.a;return true};a.prototype.getPixel=function(b,d){var c;if(this.c==null){throw"Requires a CamanJS context"}c=this.coordinatesToLocation(b,d,this.width);return this.pixelAtLocation(c)};a.prototype.putPixel=function(b,e,c){var d;if(this.c==null){throw"Requires a CamanJS context"}d=this.coordinatesToLocation(b,e,this.width);this.c.pixelData[d]=c.r;this.c.pixelData[d+1]=c.g;this.c.pixelData[d+2]=c.b;return this.c.pixelData[d+3]=c.a};a.prototype.toString=function(){return this.toKey()};a.prototype.toHex=function(b){var c;if(b==null){b=false}c="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16);if(b){return c+this.a.toString(16)}else{return c}};return a})();U=af.Pixel;af.Plugin=(function(){function a(){}a.plugins={};a.register=function(b,c){return this.plugins[b]=c};a.execute=function(d,c,b){return this.plugins[c].apply(d,b)};return a})();H=af.Plugin;af.Renderer=(function(){a.Blocks=af.NodeJS?require("os").cpus().length:4;function a(b){this.c=b;this.processNext=N(this.processNext,this);this.renderQueue=[];this.modPixelData=null}a.prototype.add=function(b){if(b==null){return}return this.renderQueue.push(b)};a.prototype.processNext=function(){var b;if(this.renderQueue.length===0){K.trigger(this,"renderFinished");if(this.finishedFn!=null){this.finishedFn.call(this.c)}return this}this.currentJob=this.renderQueue.shift();switch(this.currentJob.type){case I.Type.LayerDequeue:b=this.c.canvasQueue.shift();this.c.executeLayer(b);return this.processNext();case I.Type.LayerFinished:this.c.applyCurrentLayer();this.c.popContext();return this.processNext();case I.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case I.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}};a.prototype.execute=function(b){this.finishedFn=b;this.modPixelData=S.dataArray(this.c.pixelData.length);return this.processNext()};a.prototype.eachBlock=function(m){var l,n,o,f,k,i,e,c,b,g,h,d,j=this;this.blocksDone=0;c=this.c.pixelData.length;n=Math.floor((c/4)/a.Blocks);l=n*4;e=l+((c/4)%a.Blocks)*4;d=[];for(i=g=0,h=a.Blocks;0<=h?g<h:g>h;i=0<=h?++g:--g){b=i*l;f=b+(i===a.Blocks-1?e:l);if(af.NodeJS){k=M(function(){return m.call(j,i,b,f)});o=k.run();d.push(this.blockFinished(o))}else{d.push(setTimeout((function(q,r,p){return function(){return m.call(j,q,r,p)}})(i,b,f),0))}}return d};a.prototype.executeFilter=function(){K.trigger(this.c,"processStart",this.currentJob);if(this.currentJob.type===I.Type.Single){return this.eachBlock(this.renderBlock)}else{return this.eachBlock(this.renderKernel)}};a.prototype.executePlugin=function(){aa.debug("Executing plugin "+this.currentJob.plugin);H.execute(this.c,this.currentJob.plugin,this.currentJob.args);aa.debug("Plugin "+this.currentJob.plugin+" finished!");return this.processNext()};a.prototype.renderBlock=function(e,g,b){var d,c,f;aa.debug("Block #"+e+" - Filter: "+this.currentJob.name+", Start: "+g+", End: "+b);K.trigger(this.c,"blockStarted",{blockNum:e,totalBlocks:a.Blocks,startPixel:g,endPixel:b});c=new U();c.setContext(this.c);for(d=f=g;f<b;d=f+=4){c.loc=d;c.r=this.c.pixelData[d];c.g=this.c.pixelData[d+1];c.b=this.c.pixelData[d+2];c.a=this.c.pixelData[d+3];this.currentJob.processFn(c);this.c.pixelData[d]=S.clampRGB(c.r);this.c.pixelData[d+1]=S.clampRGB(c.g);this.c.pixelData[d+2]=S.clampRGB(c.b);this.c.pixelData[d+3]=S.clampRGB(c.a)}if(af.NodeJS){return M.yield(e)}else{return this.blockFinished(e)}};a.prototype.renderKernel=function(u,j,g){var q,h,k,p,f,m,t,s,r,l,o,b,n,i,v,e,d,c;b=this.currentJob.name;k=this.currentJob.bias;m=this.currentJob.divisor;o=this.c.pixelData.length;q=this.currentJob.adjust;h=Math.sqrt(q.length);l=[];aa.debug("Rendering kernel - Filter: "+this.currentJob.name);j=Math.max(j,this.c.dimensions.width*4*((h-1)/2));g=Math.min(g,o-(this.c.dimensions.width*4*((h-1)/2)));p=(h-1)/2;i=new U();i.setContext(this.c);for(t=e=j;e<g;t=e+=4){i.loc=t;f=0;for(s=d=-p;-p<=p?d<=p:d>=p;s=-p<=p?++d:--d){for(r=c=p;p<=-p?c<=-p:c>=-p;r=p<=-p?++c:--c){n=i.getPixelRelative(s,r);l[f*3]=n.r;l[f*3+1]=n.g;l[f*3+2]=n.b;f++}}v=this.processKernel(q,l,m,k);this.modPixelData[t]=S.clampRGB(v.r);this.modPixelData[t+1]=S.clampRGB(v.g);this.modPixelData[t+2]=S.clampRGB(v.b);this.modPixelData[t+3]=this.c.pixelData[t+3]}if(af.NodeJS){return M.yield(u)}else{return this.blockFinished(u)}};a.prototype.blockFinished=function(c){var b,e,d;if(c>=0){aa.debug("Block #"+c+" finished! Filter: "+this.currentJob.name)}this.blocksDone++;K.trigger(this.c,"blockFinished",{blockNum:c,blocksFinished:this.blocksDone,totalBlocks:a.Blocks});if(this.blocksDone===a.Blocks){if(this.currentJob.type===I.Type.Kernel){for(b=e=0,d=this.c.pixelData.length;0<=d?e<d:e>d;b=0<=d?++e:--e){this.c.pixelData[b]=this.modPixelData[b]}}if(c>=0){aa.debug("Filter "+this.currentJob.name+" finished!")}K.trigger(this.c,"processComplete",this.currentJob);return this.processNext()}};a.prototype.processKernel=function(f,i,h,b){var c,g,e,d;g={r:0,g:0,b:0};for(c=e=0,d=f.length;0<=d?e<d:e>d;c=0<=d?++e:--e){g.r+=f[c]*i[c*3];g.g+=f[c]*i[c*3+1];g.b+=f[c]*i[c*3+2]}g.r=(g.r/h)+b;g.g=(g.g/h)+b;g.b=(g.b/h)+b;return g};a.prototype.loadOverlay=function(c,d){var b,f,e=this;b=document.createElement("img");b.onload=function(){c.context.drawImage(b,0,0,e.c.dimensions.width,e.c.dimensions.height);c.imageData=c.context.getImageData(0,0,e.c.dimensions.width,e.c.dimensions.height);c.pixelData=c.imageData.data;e.c.pixelData=c.pixelData;return e.processNext()};f=L.remoteCheck(d);return b.src=f!=null?f:d};return a})();ae=af.Renderer;af.Store=(function(){function a(){}a.items={};a.has=function(b){return this.items[b]!=null};a.get=function(b){return this.items[b]};a.put=function(b,c){return this.items[b]=c};a.execute=function(b,d){var c=this;setTimeout(function(){return d.call(c.get(b),c.get(b))},0);return this.get(b)};a.flush=function(b){if(b==null){b=false}if(b){return delete this.items[b]}else{return this.items={}}};return a})();W=af.Store;V.register("normal",function(a,b){return{r:a.r,g:a.g,b:a.b}});V.register("multiply",function(a,b){return{r:(a.r*b.r)/255,g:(a.g*b.g)/255,b:(a.b*b.b)/255}});V.register("screen",function(a,b){return{r:255-(((255-a.r)*(255-b.r))/255),g:255-(((255-a.g)*(255-b.g))/255),b:255-(((255-a.b)*(255-b.b))/255)}});V.register("overlay",function(b,c){var a;a={};a.r=c.r>128?255-2*(255-b.r)*(255-c.r)/255:(c.r*b.r*2)/255;a.g=c.g>128?255-2*(255-b.g)*(255-c.g)/255:(c.g*b.g*2)/255;a.b=c.b>128?255-2*(255-b.b)*(255-c.b)/255:(c.b*b.b*2)/255;return a});V.register("difference",function(a,b){return{r:a.r-b.r,g:a.g-b.g,b:a.b-b.b}});V.register("addition",function(a,b){return{r:b.r+a.r,g:b.g+a.g,b:b.b+a.b}});V.register("exclusion",function(a,b){return{r:128-2*(b.r-128)*(a.r-128)/255,g:128-2*(b.g-128)*(a.g-128)/255,b:128-2*(b.b-128)*(a.b-128)/255}});V.register("softLight",function(b,c){var a;a={};a.r=c.r>128?255-((255-c.r)*(255-(b.r-128)))/255:(c.r*(b.r+128))/255;a.g=c.g>128?255-((255-c.g)*(255-(b.g-128)))/255:(c.g*(b.g+128))/255;a.b=c.b>128?255-((255-c.b)*(255-(b.b-128)))/255:(c.b*(b.b+128))/255;return a});V.register("lighten",function(a,b){return{r:b.r>a.r?b.r:a.r,g:b.g>a.g?b.g:a.g,b:b.b>a.b?b.b:a.b}});V.register("darken",function(a,b){return{r:b.r>a.r?a.r:b.r,g:b.g>a.g?a.g:b.g,b:b.b>a.b?a.b:b.b}});I.register("fillColor",function(){var a;if(arguments.length===1){a=G.hexToRGB(arguments[0])}else{a={r:arguments[0],g:arguments[1],b:arguments[2]}}return this.process("fillColor",function(b){b.r=a.r;b.g=a.g;b.b=a.b;b.a=255;return b})});I.register("brightness",function(a){a=Math.floor(255*(a/100));return this.process("brightness",function(b){b.r+=a;b.g+=a;b.b+=a;return b})});I.register("saturation",function(a){a*=-0.01;return this.process("saturation",function(c){var b;b=Math.max(c.r,c.g,c.b);if(c.r!==b){c.r+=(b-c.r)*a}if(c.g!==b){c.g+=(b-c.g)*a}if(c.b!==b){c.b+=(b-c.b)*a}return c})});I.register("vibrance",function(a){a*=-1;return this.process("vibrance",function(c){var e,d,b;b=Math.max(c.r,c.g,c.b);d=(c.r+c.g+c.b)/3;e=((Math.abs(b-d)*2/255)*a)/100;if(c.r!==b){c.r+=(b-c.r)*e}if(c.g!==b){c.g+=(b-c.g)*e}if(c.b!==b){c.b+=(b-c.b)*e}return c})});I.register("greyscale",function(a){return this.process("greyscale",function(b){var c;c=X.luminance(b);b.r=c;b.g=c;b.b=c;return b})});I.register("contrast",function(a){a=Math.pow((a+100)/100,2);return this.process("contrast",function(b){b.r/=255;b.r-=0.5;b.r*=a;b.r+=0.5;b.r*=255;b.g/=255;b.g-=0.5;b.g*=a;b.g+=0.5;b.g*=255;b.b/=255;b.b-=0.5;b.b*=a;b.b+=0.5;b.b*=255;return b})});I.register("hue",function(a){return this.process("hue",function(d){var b,g,e,c,f,h;c=G.rgbToHSV(d.r,d.g,d.b);e=c.h*100;e+=Math.abs(a);e=e%100;e/=100;c.h=e;h=G.hsvToRGB(c.h,c.s,c.v),f=h.r,g=h.g,b=h.b;d.r=f;d.g=g;d.b=b;return d})});I.register("colorize",function(){var b,a;if(arguments.length===2){a=G.hexToRGB(arguments[0]);b=arguments[1]}else{if(arguments.length===4){a={r:arguments[0],g:arguments[1],b:arguments[2]};b=arguments[3]}}return this.process("colorize",function(c){c.r-=(c.r-a.r)*(b/100);c.g-=(c.g-a.g)*(b/100);c.b-=(c.b-a.b)*(b/100);return c})});I.register("invert",function(){return this.process("invert",function(a){a.r=255-a.r;a.g=255-a.g;a.b=255-a.b;return a})});I.register("sepia",function(a){if(a==null){a=100}a/=100;return this.process("sepia",function(b){b.r=Math.min(255,(b.r*(1-(0.607*a)))+(b.g*(0.769*a))+(b.b*(0.189*a)));b.g=Math.min(255,(b.r*(0.349*a))+(b.g*(1-(0.314*a)))+(b.b*(0.168*a)));b.b=Math.min(255,(b.r*(0.272*a))+(b.g*(0.534*a))+(b.b*(1-(0.869*a))));return b})});I.register("gamma",function(a){return this.process("gamma",function(b){b.r=Math.pow(b.r/255,a)*255;b.g=Math.pow(b.g/255,a)*255;b.b=Math.pow(b.b/255,a)*255;return b})});I.register("noise",function(a){a=Math.abs(a)*2.55;return this.process("noise",function(b){var c;c=X.randomRange(a*-1,a);b.r+=c;b.g+=c;b.b+=c;return b})});I.register("clip",function(a){a=Math.abs(a)*2.55;return this.process("clip",function(b){if(b.r>255-a){b.r=255}else{if(b.r<a){b.r=0}}if(b.g>255-a){b.g=255}else{if(b.g<a){b.g=0}}if(b.b>255-a){b.b=255}else{if(b.b<a){b.b=0}}return b})});I.register("channels",function(a){var c,b;if(typeof a!=="object"){return this}for(c in a){if(!Y.call(a,c)){continue}b=a[c];if(b===0){delete a[c];continue}a[c]/=100}if(a.length===0){return this}return this.process("channels",function(d){if(a.red!=null){if(a.red>0){d.r+=(255-d.r)*a.red}else{d.r-=d.r*Math.abs(a.red)}}if(a.green!=null){if(a.green>0){d.g+=(255-d.g)*a.green}else{d.g-=d.g*Math.abs(a.green)}}if(a.blue!=null){if(a.blue>0){d.b+=(255-d.b)*a.blue}else{d.b-=d.b*Math.abs(a.blue)}}return d})});I.register("curves",function(){var d,a,l,e,c,h,k,b,i,g,j,f;a=arguments[0],l=2<=arguments.length?Z.call(arguments,1):[];if(typeof a==="string"){a=a.split("")}if(a[0]==="v"){a=["r","g","b"]}if(l.length<3||l.length>4){throw"Invalid number of arguments to curves filter"}b=l[0];e=l[1];c=l.length===4?l[2]:l[1];h=l[l.length-1];d=X.bezier(b,e,c,h,0,255);if(b[0]>0){for(k=i=0,j=b[0];0<=j?i<j:i>j;k=0<=j?++i:--i){d[k]=b[1]}}if(h[0]<255){for(k=g=f=h[0];f<=255?g<=255:g>=255;k=f<=255?++g:--g){d[k]=h[1]}}return this.process("curves",function(m){var n,o;for(k=n=0,o=a.length;0<=o?n<o:n>o;k=0<=o?++n:--n){m[a[k]]=d[m[a[k]]]}return m})});I.register("exposure",function(c){var a,d,b;b=Math.abs(c)/100;a=[0,255*b];d=[255-(255*b),255];if(c<0){a=a.reverse();d=d.reverse()}return this.curves("rgb",[0,0],a,d,[255,255])});af.Plugin.register("crop",function(e,b,a,f){var d,c;if(a==null){a=0}if(f==null){f=0}if(typeof exports!=="undefined"&&exports!==null){d=new ab(e,b)}else{d=document.createElement("canvas");S.copyAttributes(this.canvas,d);d.width=e;d.height=b}c=d.getContext("2d");c.drawImage(this.canvas,a,f,e,b,0,0,e,b);this.cropCoordinates={x:a,y:f};this.cropped=true;return this.replaceCanvas(d)});af.Plugin.register("resize",function(c){var b,a;if(c==null){c=null}if(c===null||((c.width==null)&&(c.height==null))){aa.error("Invalid or missing dimensions given for resize");return}if(c.width==null){c.width=this.canvas.width*c.height/this.canvas.height}else{if(c.height==null){c.height=this.canvas.height*c.width/this.canvas.width}}if(typeof exports!=="undefined"&&exports!==null){b=new ab(c.width,c.height)}else{b=document.createElement("canvas");S.copyAttributes(this.canvas,b);b.width=c.width;b.height=c.height}a=b.getContext("2d");a.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,c.width,c.height);this.resized=true;return this.replaceCanvas(b)});af.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))});af.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))});af.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])});af.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])});af.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])});af.Filter.register("motionBlur",function(a){var b;if(a===0||a===180){b=[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]}else{if((a>0&&a<90)||(a>180&&a<270)){b=[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]}else{if(a===90||a===270){b=[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]}else{b=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}}}return this.processKernel("Motion Blur",b)});af.Filter.register("sharpen",function(a){if(a==null){a=100}a/=100;return this.processKernel("Sharpen",[0,-a,0,-a,4*a+1,-a,0,-a,0])});T={brightness:function(a,c,b){a.r=a.r-(a.r*c*b.strength);a.g=a.g-(a.g*c*b.strength);a.b=a.b-(a.b*c*b.strength);return a},gamma:function(a,c,b){a.r=Math.pow(a.r/255,Math.max(10*c*b.strength,1))*255;a.g=Math.pow(a.g/255,Math.max(10*c*b.strength,1))*255;a.b=Math.pow(a.b/255,Math.max(10*c*b.strength,1))*255;return a},colorize:function(a,c,b){a.r-=(a.r-b.color.r)*c;a.g-=(a.g-b.color.g)*c;a.b-=(a.b-b.color.b)*c;return a}};I.register("vignette",function(c,e){var d,a,b,f;if(e==null){e=60}if(typeof c==="string"&&c.substr(-1)==="%"){if(this.dimensions.height>this.dimensions.width){c=this.dimensions.width*(parseInt(c.substr(0,c.length-1),10)/100)}else{c=this.dimensions.height*(parseInt(c.substr(0,c.length-1),10)/100)}}e/=100;a=[this.dimensions.width/2,this.dimensions.height/2];f=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));b=f-c;d=X.bezier([0,1],[30,30],[70,60],[100,80]);return this.process("vignette",function(g){var i,j,h;h=g.locationXY();i=X.distance(h.x,h.y,a[0],a[1]);if(i>b){j=Math.max(1,(d[Math.round(((i-b)/c)*100)]/10)*e);g.r=Math.pow(g.r/255,j)*255;g.g=Math.pow(g.g/255,j)*255;g.b=Math.pow(g.b/255,j)*255}return g})});I.register("rectangularVignette",function(d){var h,g,c,b,f,a,e;h={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}};d=S.extend(h,d);if(!d.size){return this}else{if(typeof d.size==="string"){c=parseInt(d.size,10)/100;d.size={width:this.dimensions.width*c,height:this.dimensions.height*c}}else{if(typeof d.size==="object"){e=["width","height"];for(f=0,a=e.length;f<a;f++){g=e[f];if(typeof d.size[g]==="string"){d.size[g]=this.dimensions[g]*(parseInt(d.size[g],10)/100)}}}else{if(d.size==="number"){b=d.size;d.size={width:b,height:b}}}}}if(typeof d.cornerRadius==="string"){d.cornerRadius=(d.size.width/2)*(parseInt(d.cornerRadius,10)/100)}d.strength/=100;d.size.width=Math.floor(d.size.width);d.size.height=Math.floor(d.size.height);d.image={width:this.dimensions.width,height:this.dimensions.height};if(d.method==="colorize"&&typeof d.color==="string"){d.color=G.hexToRGB(d.color)}d.coords={left:(this.dimensions.width-d.size.width)/2,right:this.dimensions.width-d.coords.left,bottom:(this.dimensions.height-d.size.height)/2,top:this.dimensions.height-d.coords.bottom};d.corners=[{x:d.coords.left+d.cornerRadius,y:d.coords.top-d.cornerRadius},{x:d.coords.right-d.cornerRadius,y:d.coords.top-d.cornerRadius},{x:d.coords.right-d.cornerRadius,y:d.coords.bottom+d.cornerRadius},{x:d.coords.left+d.cornerRadius,y:d.coords.bottom+d.cornerRadius}];d.maxDist=X.distance(0,0,d.corners[3].x,d.corners[3].y)-d.cornerRadius;return this.process("rectangularVignette",function(i){var l,k,j;k=i.locationXY();if((k.x>d.corners[0].x&&k.x<d.corners[1].x)&&(k.y>d.coords.bottom&&k.y<d.coords.top)){return i}if((k.x>d.coords.left&&k.x<d.coords.right)&&(k.y>d.corners[3].y&&k.y<d.corners[2].y)){return i}if(k.x>d.corners[0].x&&k.x<d.corners[1].x&&k.y>d.coords.top){l=(k.y-d.coords.top)/d.maxDist}else{if(k.y>d.corners[2].y&&k.y<d.corners[1].y&&k.x>d.coords.right){l=(k.x-d.coords.right)/d.maxDist}else{if(k.x>d.corners[0].x&&k.x<d.corners[1].x&&k.y<d.coords.bottom){l=(d.coords.bottom-k.y)/d.maxDist}else{if(k.y>d.corners[2].y&&k.y<d.corners[1].y&&k.x<d.coords.left){l=(d.coords.left-k.x)/d.maxDist}else{if(k.x<=d.corners[0].x&&k.y>=d.corners[0].y){j=af.distance(k.x,k.y,d.corners[0].x,d.corners[0].y);l=(j-d.cornerRadius)/d.maxDist}else{if(k.x>=d.corners[1].x&&k.y>=d.corners[1].y){j=af.distance(k.x,k.y,d.corners[1].x,d.corners[1].y);l=(j-d.cornerRadius)/d.maxDist}else{if(k.x>=d.corners[2].x&&k.y<=d.corners[2].y){j=af.distance(k.x,k.y,d.corners[2].x,d.corners[2].y);l=(j-d.cornerRadius)/d.maxDist}else{if(k.x<=d.corners[3].x&&k.y<=d.corners[3].y){j=af.distance(k.x,k.y,d.corners[3].x,d.corners[3].y);l=(j-d.cornerRadius)/d.maxDist}}}}}}}}if(l<0){return i}return T[d.method](i,l,d)})});(function(){var d,c,a,b,e;b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];c=function(i,s,n,m,l,k,r){var j,h,q,g,f,p,o;j=typeof exports!=="undefined"&&exports!==null?new ab():document.createElement("canvas");j.width=i;j.height=s;g=n+Math.cos(l)*k*0.5;p=m+Math.sin(l)*k*0.5;f=n-Math.cos(l)*k*0.5;o=m-Math.sin(l)*k*0.5;h=j.getContext("2d");q=h.createLinearGradient(g,p,f,o);if(!r){q.addColorStop(0,"white");q.addColorStop(1,"black")}else{q.addColorStop(0,"white");q.addColorStop(0.5,"black");q.addColorStop(1,"white")}h.fillStyle=q;h.fillRect(0,0,i,s);return h.getImageData(0,0,i,s)};a=function(f,n,j,i,m,l){var h,g,k;h=typeof exports!=="undefined"&&exports!==null?new ab():document.createElement("canvas");h.width=f;h.height=n;g=h.getContext("2d");k=g.createRadialGradient(j,i,m,j,i,l);k.addColorStop(1,"white");k.addColorStop(0,"black");g.fillStyle=k;g.fillRect(0,0,f,n);return g.getImageData(0,0,f,n)};d=function(){this.r=0;this.g=0;this.b=0;this.a=0;return this.next=null};af.Plugin.register("compoundBlur",function(u,i,aM,aI){var h,t,z,aA,a4,aJ,aY,B,a7,a1,q,aH,a2,aL,g,aD,a0,x,r,w,p,j,a8,bb,am,be,a6,l,ba,ak,a5,v,a9,aG,aF,D,aK,m,aB,a3,aX,aZ,bd,aW,aV,n,f,bc,aE,aC,al,E,C,A,y,s,o,k;aZ=this.dimensions.width;a1=this.dimensions.height;g=this.pixelData;l=u.data;a3=aZ*a1;aX=a3<<2;a8=[];for(aH=aE=0;0<=aX?aE<aX:aE>aX;aH=0<=aX?++aE:--aE){a8[aH]=g[aH]}a4=0;aK=aI;aI-=1;while(aK-->=0){a0=(i+0.5)|0;if(a0===0){continue}if(a0>256){a0=256}aJ=a0+a0+1;aB=aZ<<2;bd=aZ-1;q=a1-1;ba=a0+1;m=ba*(ba+1)/2;D=new d();a9=void 0;v=D;for(aH=aC=1;1<=aJ?aC<aJ:aC>aJ;aH=1<=aJ?++aC:--aC){v=v.next=new d();if(aH===ba){a9=v}}v.next=D;aG=null;aF=null;bc=n=0;r=b[a0];a5=e[a0];for(aV=al=0;0<=a1?al<a1:al>a1;aV=0<=a1?++al:--al){am=aY=h=a6=a7=z=0;be=ba*(bb=a8[n]);B=ba*(j=a8[n+1]);t=ba*(p=a8[n+2]);a6+=m*bb;a7+=m*j;z+=m*p;v=D;for(aH=E=0;0<=ba?E<ba:E>ba;aH=0<=ba?++E:--E){v.r=bb;v.g=j;v.b=p;v=v.next}for(aH=C=1;1<=ba?C<ba:C>ba;aH=1<=ba?++C:--C){w=n+((bd<aH?bd:aH)<<2);a6+=(v.r=(bb=a8[w]))*(ak=ba-aH);a7+=(v.g=(j=a8[w+1]))*ak;z+=(v.b=(p=a8[w+2]))*ak;am+=bb;aY+=j;h+=p;v=v.next}aG=D;aF=a9;for(aW=A=0;0<=aZ?A<aZ:A>aZ;aW=0<=aZ?++A:--A){a8[n]=(a6*r)>>a5;a8[n+1]=(a7*r)>>a5;a8[n+2]=(z*r)>>a5;a6-=be;a7-=B;z-=t;be-=aG.r;B-=aG.g;t-=aG.b;w=(bc+((w=aW+ba)<bd?w:bd))<<2;am+=(aG.r=a8[w]);aY+=(aG.g=a8[w+1]);h+=(aG.b=a8[w+2]);a6+=am;a7+=aY;z+=h;aG=aG.next;be+=(bb=aF.r);B+=(j=aF.g);t+=(p=aF.b);am-=bb;aY-=j;h-=p;aF=aF.next;n+=4}bc+=aZ}for(aW=y=0;0<=aZ?y<aZ:y>aZ;aW=0<=aZ?++y:--y){aY=h=am=a7=z=a6=0;n=aW<<2;be=ba*(bb=a8[n]);B=ba*(j=a8[n+1]);t=ba*(p=a8[n+2]);a6+=m*bb;a7+=m*j;z+=m*p;v=D;for(aH=s=0;0<=ba?s<ba:s>ba;aH=0<=ba?++s:--s){v.r=bb;v.g=j;v.b=p;v=v.next}f=aZ;for(aH=o=1;1<=ba?o<ba:o>ba;aH=1<=ba?++o:--o){n=(f+aW)<<2;a6+=(v.r=(bb=a8[n]))*(ak=ba-aH);a7+=(v.g=(j=a8[n+1]))*ak;z+=(v.b=(p=a8[n+2]))*ak;am+=bb;aY+=j;h+=p;v=v.next;if(aH<q){f+=aZ}}n=aW;aG=D;aF=a9;for(aV=k=0;0<=a1?k<a1:k>a1;aV=0<=a1?++k:--k){w=n<<2;a8[w]=(a6*r)>>a5;a8[w+1]=(a7*r)>>a5;a8[w+2]=(z*r)>>a5;a6-=be;a7-=B;z-=t;be-=aG.r;B-=aG.g;t-=aG.b;w=(aW+(((w=aV+ba)<q?w:q)*aZ))<<2;a6+=(am+=(aG.r=a8[w]));a7+=(aY+=(aG.g=a8[w+1]));z+=(h+=(aG.b=a8[w+2]));aG=aG.next;be+=(bb=aF.r);B+=(j=aF.g);t+=(p=aF.b);am-=bb;aY-=j;h-=p;aF=aF.next;n+=aZ}}i*=aM;aH=a3;while(--aH>-1){aL=aH<<2;x=(l[aL+2]&255)/255*aI;aD=x|0;if(aD===a4){aA=256*(x-(x|0));a2=256-aA;g[aL]=(g[aL]*a2+a8[aL]*aA)>>8;g[aL+1]=(g[aL+1]*a2+a8[aL+1]*aA)>>8;g[aL+2]=(g[aL+2]*a2+a8[aL+2]*aA)>>8}else{if(aD===a4+1){g[aL]=a8[aL];g[aL+1]=a8[aL+1];g[aL+2]=a8[aL+2]}}}a4++}return this});af.Filter.register("tiltShift",function(f){var h,g;h={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3};f=S.extend(h,f);f.angle*=Math.PI/180;g=c(this.dimensions.width,this.dimensions.height,f.center.x,f.center.y,f.angle,f.focusWidth,true);return this.processPlugin("compoundBlur",[g,f.startRadius,f.radiusFactor,f.steps])});return af.Filter.register("radialBlur",function(h){var j,i,g,f;j={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null};h=S.extend(j,h);if(!h.radius){h.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width}g=(h.radius/2)-h.size;f=h.radius/2;i=a(this.dimensions.width,this.dimensions.height,h.center.x,h.center.y,g,f);return this.processPlugin("compoundBlur",[i,h.startRadius,h.radiusFactor,h.steps])})})();af.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])});af.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])});af.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])});af.Filter.register("posterize",function(c){var a,b;a=256/c;b=255/(c-1);return this.process("posterize",function(d){d.r=Math.floor(Math.floor(d.r/a)*b);d.g=Math.floor(Math.floor(d.g/a)*b);d.b=Math.floor(Math.floor(d.b/a)*b);return d})});af.Filter.register("vintage",function(a){if(a==null){a=true}this.greyscale();this.contrast(5);this.noise(3);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.87);if(a){return this.vignette("40%",30)}});af.Filter.register("lomo",function(a){if(a==null){a=true}this.brightness(15);this.exposure(15);this.curves("rgb",[0,0],[200,0],[155,255],[255,255]);this.saturation(-20);this.gamma(1.8);if(a){this.vignette("50%",60)}return this.brightness(5)});af.Filter.register("clarity",function(a){if(a==null){a=false}this.vibrance(20);this.curves("rgb",[5,0],[130,150],[190,220],[250,255]);this.sharpen(15);this.vignette("45%",20);if(a){this.greyscale();this.contrast(4)}return this});af.Filter.register("sinCity",function(){this.contrast(100);this.brightness(15);this.exposure(10);this.posterize(80);this.clip(30);return this.greyscale()});af.Filter.register("sunrise",function(){this.exposure(3.5);this.saturation(-5);this.vibrance(50);this.sepia(60);this.colorize("#e87b22",10);this.channels({red:8,blue:8});this.contrast(5);this.gamma(1.2);return this.vignette("55%",25)});af.Filter.register("crossProcess",function(){this.exposure(5);this.colorize("#e87b22",4);this.sepia(20);this.channels({blue:8,red:3});this.curves("b",[0,0],[100,150],[180,180],[255,255]);this.contrast(15);this.vibrance(75);return this.gamma(1.6)});af.Filter.register("orangePeel",function(){this.curves("rgb",[0,0],[100,50],[140,200],[255,255]);this.vibrance(-30);this.saturation(-30);this.colorize("#ff9000",30);this.contrast(-5);return this.gamma(1.4)});af.Filter.register("love",function(){this.brightness(5);this.exposure(8);this.contrast(4);this.colorize("#c42007",30);this.vibrance(50);return this.gamma(1.3)});af.Filter.register("grungy",function(){this.gamma(1.5);this.clip(25);this.saturation(-60);this.contrast(5);this.noise(5);return this.vignette("50%",30)});af.Filter.register("jarques",function(){this.saturation(-35);this.curves("b",[20,0],[90,120],[186,144],[255,230]);this.curves("r",[0,0],[144,90],[138,120],[255,255]);this.curves("g",[10,0],[115,105],[148,100],[255,248]);this.curves("rgb",[0,0],[120,100],[128,140],[255,255]);return this.sharpen(20)});af.Filter.register("pinhole",function(){this.greyscale();this.sepia(10);this.exposure(10);this.contrast(15);return this.vignette("60%",35)});af.Filter.register("oldBoot",function(){this.saturation(-20);this.vibrance(-50);this.gamma(1.1);this.sepia(30);this.channels({red:-10,blue:5});this.curves("rgb",[0,0],[80,50],[128,230],[255,255]);return this.vignette("60%",30)});af.Filter.register("glowingSun",function(a){if(a==null){a=true}this.brightness(10);this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();this.filter.gamma(0.8);this.filter.contrast(50);return this.filter.exposure(10)});this.newLayer(function(){this.setBlendingMode("softLight");this.opacity(80);return this.fillColor("#f49600")});this.exposure(20);this.gamma(0.8);if(a){return this.vignette("45%",20)}});af.Filter.register("hazyDays",function(){this.gamma(1.2);this.newLayer(function(){this.setBlendingMode("overlay");this.opacity(60);this.copyParent();this.filter.channels({red:5});return this.filter.stackBlur(15)});this.newLayer(function(){this.setBlendingMode("addition");this.opacity(40);return this.fillColor("#6899ba")});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(35);this.copyParent();this.filter.brightness(40);this.filter.vibrance(40);this.filter.exposure(30);this.filter.contrast(15);this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]);this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]);this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]);return this.filter.stackBlur(5)});this.curves("r",[20,0],[128,158],[128,128],[235,255]);this.curves("g",[20,0],[128,128],[128,128],[235,255]);this.curves("b",[20,0],[128,108],[128,128],[235,255]);return this.vignette("45%",20)});af.Filter.register("herMajesty",function(){this.brightness(40);this.colorize("#ea1c5d",10);this.curves("b",[0,10],[128,180],[190,190],[255,255]);this.newLayer(function(){this.setBlendingMode("overlay");this.opacity(50);this.copyParent();this.filter.gamma(0.7);return this.newLayer(function(){this.setBlendingMode("normal");this.opacity(60);return this.fillColor("#ea1c5d")})});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(60);this.copyParent();this.filter.saturation(50);this.filter.hue(90);return this.filter.contrast(10)});this.gamma(1.4);this.vibrance(-30);this.newLayer(function(){this.opacity(10);return this.fillColor("#e5f0ff")});return this});af.Filter.register("nostalgia",function(){this.saturation(20);this.gamma(1.4);this.greyscale();this.contrast(5);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.8);this.contrast(5);this.exposure(10);this.newLayer(function(){this.setBlendingMode("overlay");this.copyParent();this.opacity(55);return this.filter.stackBlur(10)});return this.vignette("50%",30)});af.Filter.register("hemingway",function(){this.greyscale();this.contrast(10);this.gamma(0.9);this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(40);this.copyParent();this.filter.exposure(15);this.filter.contrast(15);return this.filter.channels({green:10,red:5})});this.sepia(30);this.curves("rgb",[0,10],[120,90],[180,200],[235,255]);this.channels({red:5,green:-2});return this.exposure(15)});af.Filter.register("concentrate",function(){this.sharpen(40);this.saturation(-50);this.channels({red:3});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();this.filter.sharpen(5);this.filter.contrast(50);this.filter.exposure(10);return this.filter.channels({blue:5})});return this.brightness(10)});af.Plugin.register("rotate",function(c){var d,b,i,g,h,a,f,e;d=c%360;if(d===0){return this.dimensions={width:this.canvas.width,height:this.canvas.height}}h=Math.PI/180;if(typeof exports!=="undefined"&&exports!==null){b=new ab()}else{b=document.createElement("canvas");S.copyAttributes(this.canvas,b)}if(d===90||d===-270||d===270||d===-90){a=this.canvas.height;g=this.canvas.width;f=a/2;e=g/2}else{if(d===180){a=this.canvas.width;g=this.canvas.height;f=a/2;e=g/2}else{a=Math.sqrt(Math.pow(this.originalWidth,2)+Math.pow(this.originalHeight,2));g=a;f=this.canvas.height/2;e=this.canvas.width/2}}b.width=a;b.height=g;i=b.getContext("2d");i.save();i.translate(f,e);i.rotate(d*h);i.drawImage(this.canvas,-this.canvas.width/2,-this.canvas.height/2,this.canvas.width,this.canvas.height);i.restore();return this.replaceCanvas(b)});af.Filter.register("rotate",function(){return this.processPlugin("rotate",Array.prototype.slice.call(arguments,0))});(function(){var b,a,c;a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];b=function(){this.r=0;this.g=0;this.b=0;this.a=0;return this.next=null};af.Plugin.register("stackBlur",function(s){var ay,d,h,i,r,j,ao,al,v,e,aC,x,aB,az,ap,at,m,av,an,aq,l,am,f,ar,g,o,k,t,n,ak,aw,q,p,aA,ax,au,E,D,C,B,A,z,y,w,u;if(isNaN(s)||s<1){return}s|=0;ap=this.pixelData;ak=this.dimensions.width;al=this.dimensions.height;i=s+s+1;n=ak<<2;aw=ak-1;v=al-1;aq=s+1;t=aq*(aq+1)/2;k=new b();f=k;for(e=E=1;1<=i?E<i:E>i;e=1<=i?++E:--E){f=f.next=new b();if(e===aq){ar=f}}f.next=k;g=null;o=null;au=aA=0;aC=a[s];am=c[s];for(p=D=0;0<=al?D<al:D>al;p=0<=al?++D:--D){m=r=ay=an=ao=h=0;av=aq*(at=ap[aA]);j=aq*(az=ap[aA+1]);d=aq*(aB=ap[aA+2]);an+=t*at;ao+=t*az;h+=t*aB;f=k;for(e=C=0;0<=aq?C<aq:C>aq;e=0<=aq?++C:--C){f.r=at;f.g=az;f.b=aB;f=f.next}for(e=B=1;1<=aq?B<aq:B>aq;e=1<=aq?++B:--B){x=aA+((aw<e?aw:e)<<2);an+=(f.r=(at=ap[x]))*(l=aq-e);ao+=(f.g=(az=ap[x+1]))*l;h+=(f.b=(aB=ap[x+2]))*l;m+=at;r+=az;ay+=aB;f=f.next}g=k;o=ar;for(q=A=0;0<=ak?A<ak:A>ak;q=0<=ak?++A:--A){ap[aA]=(an*aC)>>am;ap[aA+1]=(ao*aC)>>am;ap[aA+2]=(h*aC)>>am;an-=av;ao-=j;h-=d;av-=g.r;j-=g.g;d-=g.b;x=(au+((x=q+s+1)<aw?x:aw))<<2;m+=(g.r=ap[x]);r+=(g.g=ap[x+1]);ay+=(g.b=ap[x+2]);an+=m;ao+=r;h+=ay;g=g.next;av+=(at=o.r);j+=(az=o.g);d+=(aB=o.b);m-=at;r-=az;ay-=aB;o=o.next;aA+=4}au+=ak}for(q=z=0;0<=ak?z<ak:z>ak;q=0<=ak?++z:--z){r=ay=m=ao=h=an=0;aA=q<<2;av=aq*(at=ap[aA]);j=aq*(az=ap[aA+1]);d=aq*(aB=ap[aA+2]);an+=t*at;ao+=t*az;h+=t*aB;f=k;for(e=y=0;0<=aq?y<aq:y>aq;e=0<=aq?++y:--y){f.r=at;f.g=az;f.b=aB;f=f.next}ax=ak;for(e=w=1;1<=s?w<=s:w>=s;e=1<=s?++w:--w){aA=(ax+q)<<2;an+=(f.r=(at=ap[aA]))*(l=aq-e);ao+=(f.g=(az=ap[aA+1]))*l;h+=(f.b=(aB=ap[aA+2]))*l;m+=at;r+=az;ay+=aB;f=f.next;if(e<v){ax+=ak}}aA=q;g=k;o=ar;for(p=u=0;0<=al?u<al:u>al;p=0<=al?++u:--u){x=aA<<2;ap[x]=(an*aC)>>am;ap[x+1]=(ao*aC)>>am;ap[x+2]=(h*aC)>>am;an-=av;ao-=j;h-=d;av-=g.r;j-=g.g;d-=g.b;x=(q+(((x=p+aq)<v?x:v)*ak))<<2;an+=(m+=(g.r=ap[x]));ao+=(r+=(g.g=ap[x+1]));h+=(ay+=(g.b=ap[x+2]));g=g.next;av+=(at=o.r);j+=(az=o.g);d+=(aB=o.b);m-=at;r-=az;ay-=aB;o=o.next;aA+=ak}}return this});return af.Filter.register("stackBlur",function(d){return this.processPlugin("stackBlur",[d])})})();af.Filter.register("threshold",function(a){return this.process("threshold",function(c){var b;b=(0.2126*c.r)+(0.7152*c.g)+(0.0722*c.b);if(b<a){c.r=0;c.g=0;c.b=0}else{c.r=255;c.g=255;c.b=255}return c})})}).call(this);(function(){var o,l,n,k,m,r,j,q,p={}.hasOwnProperty;l=null;r=null;k={};o=false;n=false;j=_.throttle(function(){var a,b;if(o){n=true;return}else{n=false}o=true;l.revert(false);for(a in k){if(!p.call(k,a)){continue}b=k[a];b=parseFloat(b,10);if(b===0){continue}l[a](b)}return l.render(function(){o=false;if(n){return j()}})},300);m=false;q=function(b){var c,a;if(m){return}$("#PresetFilters a").removeClass("Active");c=$("#PresetFilters a[data-preset='"+b+"']");a=c.html();c.addClass("Active").html("Rendering...");m=true;r.revert(false);r[b]();return r.render(function(){c.html(a);return m=false})};$(document).ready(function(){if(!($("#example").length>0)){return}l=Caman("#example");r=Caman("#preset-example");$(".FilterSetting input").each(function(){var a;a=$(this).data("filter");return k[a]=$(this).val()});$("#Filters").on("change",".FilterSetting input",function(){var a,b;a=$(this).data("filter");b=$(this).val();k[a]=b;$(this).find("~ .FilterValue").html(b);return j()});return $("#PresetFilters").on("click","a",function(){return q($(this).data("preset"))})})}).call(this);(function(){var b;b=function(g){var a,f,h;h=g.attr("id");g.attr("id","");f=$("<div>").css({position:"absolute",visibility:"hidden",top:$(document).scrollTop()+"px"}).attr("id",h).appendTo(document.body);document.location.hash="#"+h;f.remove();g.attr("id",h);a=$("#GuideSections li > a").filter("[href=#"+(g.attr("id"))+"]");a.parents("ul").find(".Active").removeClass("Active");return a.parents("li").addClass("Active")};$(document).ready(function(){var a;$("#GuideSections").on("click","a",function(){var e,f;e=$($(this).attr("href"));f=Math.max(0,e.position().top-129);document.location.hash=$(this).attr("href");setTimeout(function(){return $("body").scrollTop(f)},50);return false});a=_.map($("#GuideSections li > a"),function(d){return $($(d).attr("href"))});a=a.reverse();return $(document).on("scroll",_.throttle(function(){var i,j,h,g;j=$(document).scrollTop();for(h=0,g=a.length;h<g;h++){i=a[h];if(j>=i.position().top-130){b(i);return}}},200))})}).call(this);