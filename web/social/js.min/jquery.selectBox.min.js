/*
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */
(function(a,f){var c="selectbox",b=false,e=true;function d(){this._state=[];this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}a.extend(d.prototype,{_isOpenSelectbox:function(h){if(!h){return b}var g=this._getInst(h);return g.isOpen},_isDisabledSelectbox:function(h){if(!h){return b}var g=this._getInst(h);return g.isDisabled},_attachSelectbox:function(v,u){if(this._getInst(v)){return b}var g=a(v),t=this,j=t._newInst(g),o,q,r,p,n=b,l=g.find("optgroup"),m=g.find("option"),k=m.length;g.attr("sb",j.uid);a.extend(j.settings,t._defaults,u);t._state[j.uid]=b;g.hide();function h(){var s,w,x=this.attr("id").split("_")[1];for(s in t._state){if(s!==x){if(t._state.hasOwnProperty(s)){w=a("select[sb='"+s+"']")[0];if(w){t._closeSelectbox(w)}}}}}o=a("<div>",{id:"sbHolder_"+j.uid,"class":j.settings.classHolder,tabindex:g.attr("tabindex")});q=a("<a>",{id:"sbSelector_"+j.uid,href:"#","class":j.settings.classSelector,click:function(s){s.preventDefault();h.apply(a(this),[]);var w=a(this).attr("id").split("_")[1];if(t._state[w]){t._closeSelectbox(v)}else{t._openSelectbox(v)}}});r=a("<a>",{id:"sbToggle_"+j.uid,href:"#","class":j.settings.classToggle,click:function(s){s.preventDefault();h.apply(a(this),[]);var w=a(this).attr("id").split("_")[1];if(t._state[w]){t._closeSelectbox(v)}else{t._openSelectbox(v)}}});r.appendTo(o);p=a("<ul>",{id:"sbOptions_"+j.uid,"class":j.settings.classOptions,css:{display:"none"}});g.children().each(function(w){var y=a(this),x,s={};if(y.is("option")){i(y)}else{if(y.is("optgroup")){x=a("<li>");a("<span>",{text:y.attr("label")}).addClass(j.settings.classGroup).appendTo(x);x.appendTo(p);if(y.is(":disabled")){s.disabled=true}s.sub=true;i(y.find("option"),s)}}});function i(){var w=arguments[1]&&arguments[1].sub?true:false,s=arguments[1]&&arguments[1].disabled?true:false;arguments[0].each(function(y){var A=a(this),z=a("<li>"),x;if(A.is(":selected")){q.text(A.text());n=e}if(y===k-1){z.addClass("last")}if(!A.is(":disabled")&&!s){x=a("<a>",{href:"#"+A.val(),rel:A.val()}).text(A.text()).bind("click.sb",function(C){if(C&&C.preventDefault){C.preventDefault()}var D=r,B=a(this),E=D.attr("id").split("_")[1];t._changeSelectbox(v,B.attr("rel"),B.text());t._closeSelectbox(v)}).bind("mouseover.sb",function(){var B=a(this);B.parent().siblings().find("a").removeClass(j.settings.classFocus);B.addClass(j.settings.classFocus)}).bind("mouseout.sb",function(){a(this).removeClass(j.settings.classFocus)});if(w){x.addClass(j.settings.classSub)}if(A.is(":selected")){x.addClass(j.settings.classFocus)}x.appendTo(z)}else{x=a("<span>",{text:A.text()}).addClass(j.settings.classDisabled);if(w){x.addClass(j.settings.classSub)}x.appendTo(z)}z.appendTo(p)})}if(!n){q.text(m.first().text())}a.data(v,c,j);o.data("uid",j.uid).bind("keydown.sb",function(y){var B=y.charCode?y.charCode:y.keyCode?y.keyCode:0,x=a(this),D=x.data("uid"),A=x.siblings("select[sb='"+D+"']").data(c),C=x.siblings(["select[sb='",D,"']"].join("")).get(0),s=x.find("ul").find("a."+A.settings.classFocus);switch(B){case 37:case 38:if(s.length>0){var w;a("a",x).removeClass(A.settings.classFocus);w=s.parent().prevAll("li:has(a)").eq(0).find("a");if(w.length>0){w.addClass(A.settings.classFocus).focus();a("#sbSelector_"+D).text(w.text())}}break;case 39:case 40:var w;a("a",x).removeClass(A.settings.classFocus);if(s.length>0){w=s.parent().nextAll("li:has(a)").eq(0).find("a")}else{w=x.find("ul").find("a").eq(0)}if(w.length>0){w.addClass(A.settings.classFocus).focus();a("#sbSelector_"+D).text(w.text())}break;case 13:if(s.length>0){t._changeSelectbox(C,s.attr("rel"),s.text())}t._closeSelectbox(C);break;case 9:if(C){var A=t._getInst(C);if(A){if(s.length>0){t._changeSelectbox(C,s.attr("rel"),s.text())}t._closeSelectbox(C)}}var z=parseInt(x.attr("tabindex"),10);if(!y.shiftKey){z++}else{z--}a("*[tabindex='"+z+"']").focus();break;case 27:t._closeSelectbox(C);break}y.stopPropagation();return false}).delegate("a","mouseover",function(s){a(this).addClass(j.settings.classFocus)}).delegate("a","mouseout",function(s){a(this).removeClass(j.settings.classFocus)});q.appendTo(o);p.appendTo(o);o.insertAfter(g);a(document).click(function(s){s.stopPropagation();a("select").selectbox("close")});a([".",j.settings.classHolder,", .",j.settings.classSelector].join("")).mousedown(function(s){s.stopPropagation()})},_detachSelectbox:function(h){var g=this._getInst(h);if(!g){return b}a("#sbHolder_"+g.uid).remove();a.data(h,c,null);a(h).show()},_changeSelectbox:function(i,k,j){var h,g=this._getInst(i);if(g){h=this._get(g,"onChange");a("#sbSelector_"+g.uid).text(j)}k=k.replace(/\'/g,"\\'");a(i).find("option[value='"+k+"']").attr("selected",e);if(g&&h){h.apply((g.input?g.input[0]:null),[k,g])}else{if(g&&g.input){g.input.trigger("change")}}},_enableSelectbox:function(h){var g=this._getInst(h);if(!g||!g.isDisabled){return b}a("#sbHolder_"+g.uid).removeClass(g.settings.classHolderDisabled);g.isDisabled=b;a.data(h,c,g)},_disableSelectbox:function(h){var g=this._getInst(h);if(!g||g.isDisabled){return b}a("#sbHolder_"+g.uid).addClass(g.settings.classHolderDisabled);g.isDisabled=e;a.data(h,c,g)},_optionSelectbox:function(i,h,j){var g=this._getInst(i);if(!g){return b}g[h]=j;a.data(i,c,g)},_openSelectbox:function(n){var j=this._getInst(n);if(!j||j.isOpen||j.isDisabled){return}var h=a("#sbOptions_"+j.uid),o=parseInt(a(window).height(),10),k=a("#sbHolder_"+j.uid).offset(),m=a(window).scrollTop(),i=h.prev().height(),g=o-(k.top-m)-i/2,l=this._get(j,"onOpen");h.css({top:i+"px",maxHeight:(g-i)+"px"});j.settings.effect==="fade"?h.fadeIn(j.settings.speed):h.slideDown(j.settings.speed);a("#sbToggle_"+j.uid).addClass(j.settings.classToggleOpen);this._state[j.uid]=e;j.isOpen=e;if(l){l.apply((j.input?j.input[0]:null),[j])}a.data(n,c,j)},_closeSelectbox:function(i){var g=this._getInst(i);if(!g||!g.isOpen){return}var h=this._get(g,"onClose");g.settings.effect==="fade"?a("#sbOptions_"+g.uid).fadeOut(g.settings.speed):a("#sbOptions_"+g.uid).slideUp(g.settings.speed);a("#sbToggle_"+g.uid).removeClass(g.settings.classToggleOpen);this._state[g.uid]=b;g.isOpen=b;if(h){h.apply((g.input?g.input[0]:null),[g])}a.data(i,c,g)},_newInst:function(h){var g=h[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:g,input:h,uid:Math.floor(Math.random()*99999999),isOpen:b,isDisabled:b,settings:{}}},_getInst:function(h){try{return a.data(h,c)}catch(g){throw"Missing instance data for this selectbox"}},_get:function(g,h){return g.settings[h]!==f?g.settings[h]:this._defaults[h]}});a.fn.selectbox=function(g){var h=Array.prototype.slice.call(arguments,1);if(typeof g=="string"&&g=="isDisabled"){return a.selectbox["_"+g+"Selectbox"].apply(a.selectbox,[this[0]].concat(h))}if(g=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return a.selectbox["_"+g+"Selectbox"].apply(a.selectbox,[this[0]].concat(h))}return this.each(function(){typeof g=="string"?a.selectbox["_"+g+"Selectbox"].apply(a.selectbox,[this].concat(h)):a.selectbox._attachSelectbox(this,g)})};a.selectbox=new d();a.selectbox.version="0.2"})(jQuery);