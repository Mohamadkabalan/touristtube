var chatIsOn=true;var ws=null;var lastFavTab="ALL";var docTitle=document.title;var myheightList=0;var docDelay;function ChatEnabled(a){if(typeof a!="undefined"){chatIsOn=a}else{return chatIsOn}}function SendMsgTo(c,a){var b={op:"CHAT",to:c,msg:a,timezone:TimeZone};Communicate(b)}function Communicate(b){if(ws!=null){b.client_ts=getClientTS();var c=JSON.stringify(b,null,2);try{ws.send(c)}catch(a){}}}function Receive(a){if(a.from.length==0){}else{if(chatListLoaded()){if(a.from==CHAT_USER_ID){AddTuberChat(a.to,false)}else{AddTuberChat(a.from,false)}AppendToLog(a)}else{setTimeout(function(){Receive(a)},1000)}}}function titleChange(a,b){if(!($("#chatInput"+b).is(":focus"))){if(document.title==docTitle){document.title=a+" says ..."}else{document.title=docTitle}docDelay=setTimeout(function(){titleChange(a,b)},1200)}}var SocketOpened=false;function connect(){if(!ChatEnabled()){return}SocketOpened=false;ws=$.gracefulWebSocket(CHAT_SERVER);if(ws==null){setTimeout(function(){connect()},500);return}ws.onclose=function(a){};ws.onopen=function(a){SocketOpened=true;$("#openChatList").show();$("#onlineTubersNb").html(t("online chat server"))}}var ConnectInterval=null;function getOnlineUserNB(){var a=0;$(".one-chat-rec").each(function(){var b=$(this);if(b.attr("data-chat-status")=="available"){a++}});return a}function removeFromChatList(b,a){$.ajax({url:ReturnLink("/ajax/chat_user_notifications.php"),data:{friend_id:b,op:"removeFrnd",notification:a},type:"post",success:function(c){var f=null;try{f=$.parseJSON(c)}catch(e){return}if(!f){TTAlert({msg:t("Couldn't process. please try again later"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(f.status=="ok"){if(a==0){$("#ChatListItem"+b).animate({height:"0px"},500,function(){$(this).remove()})}else{loadChatList()}$("#"+lastFavTab).trigger("click")}else{TTAlert({msg:f.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}$(".chat-overlay-loading-fix").hide()}})}function addToFavorites(a){$.ajax({url:ReturnLink("/ajax/chat_favorite_user_add.php"),data:{fav_id:a,op:"addFav_frnd"},type:"post",success:function(b){var e=null;try{e=$.parseJSON(b)}catch(c){return}if(!e){TTAlert({msg:t("Couldn't process. please try again later"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(e.status=="ok"){$("#ChatListItem"+a).attr("data-chat-favorites",1);$("#"+lastFavTab).trigger("click")}else{TTAlert({msg:e.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}$(".chat-overlay-loading-fix").hide()}})}function replaceTuberSearch(){if($.cookie("openchat")=="false"){var a=getOnlineUserNB();if(a==1){a=t("1 tuber")}else{a=a+" "+t("tubers")}$("#ttsearch").hide();$("#onlineTubersNb").show().html(t("online tubers")+" ("+a+")")}else{$("#onlineTubersNb").hide().html("");$("#ttsearch").show()}}function DisplayChangeStatus(b,a){switch(a){case CHAT_STATUS_OFFLINE:$("#ChatListItem"+b).find("div").eq(1).removeClass("available away busy").addClass("one-chat-img offline");$("#ChatWindow"+b+" .ChatTitle").addClass("leftgrey2").removeClass("leftgreen2 leftred2 leftyellow2");break;case CHAT_STATUS_ONLINE:$("#ChatListItem"+b).find("div").eq(1).removeClass("offline away busy").addClass("one-chat-img available");$("#ChatWindow"+b+" .ChatTitle").addClass("leftgreen2").removeClass("leftyellow2 leftred2 leftgrey2");break;case CHAT_STATUS_AWAY:$("#ChatListItem"+b).find("div").eq(1).removeClass("available offline busy").addClass("one-chat-img away");$("#ChatWindow"+b+" .ChatTitle").addClass("leftyellow2").removeClass("leftgreen2 leftred2 leftgrey2");break;case CHAT_STATUS_BUSY:$("#ChatListItem"+b).find("div").eq(1).removeClass("available away offline").addClass("one-chat-img busy");$("#ChatWindow"+b+" .ChatTitle").addClass("leftred2").removeClass("leftyellow2 leftgreen2 leftgrey2");break}replaceTuberSearch();$("#"+lastFavTab).trigger("click")}function PostConnect(){if(!SocketOpened){return}replaceTuberSearch();clearInterval(ConnectInterval);ConnectInterval=null;destroyContextMenu();loadChatList();var c=ChatStatusGet();if(!c){c=CHAT_STATUS_ONLINE}var a=JSON.stringify({op:"CONNECT",sid:CHAT_SESSION_ID,status:c},null,2);try{ws.send(a)}catch(b){}ws.onclose=function(e){setTimeout(function(){connect()},2000);ConnectInterval=setInterval(function(){PostConnect()},500)};ws.onmessage=function(e){var g=null;try{g=JSON.parse(e.data)}catch(f){}g.from=parseInt(g.from);if(g.from==0){if(g.op=="dc"){DisplayChangeStatus(g.who,0)}else{if(g.op=="con"){DisplayChangeStatus(g.who,g.status)}else{if(g.op=="ch_stat"){DisplayChangeStatus(g.who,g.status)}else{if(g.op=="frnd_req"){TTAlert({msg:t(" got freind request from ")+g.who,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}}}}}else{Receive(g);if(g.from!=""){titleChange($(".one-chatLeftList[data-tuber="+g.from+"]").attr("title"),g.from)}$(".one-chatLeftList[data-tuber="+g.from+"]").click(function(){document.title=docTitle;clearInterval(docDelay)});$("#chatInput"+g.from).focus(function(){document.title=docTitle;clearInterval(docDelay)})}}}function ChatStatusGet(){return $.cookie("chatStatus")}function ChatStatusChange(c){var a=JSON.stringify({op:"CH_STAT",status:c},null,2);try{ws.send(a)}catch(b){}}function turnOffChat(){ChatEnabled(false);var a={op:"CLIENT_DISCONNECT"};Communicate(a);$("#chatList").hide().html("");replaceTuberSearch();$("#switchatOn").show().fadeIn(10,function(){$("#switchatOn").click(function(){$("#switchatOn").hide();$("#chatList").slideToggle();turnOnChat()})})}function turnOnChat(){ChatEnabled(true);connect();ConnectInterval=setInterval(function(){PostConnect()},500);loadChatList()}function initFavorites(){$(".oneTabFav").css("cursor","pointer").click(function(){$(".oneTabFav").removeClass("selectedFav");$(this).addClass("selectedFav");var a=$(this).attr("id");lastFavTab=a;switch(a){case"ALL":showAllRecords();break;case"ONLINE":showJustOnline();break;case"FAVORITES":showJustFavorites();break}reinitChatSCrollPane()})}function shareTubersToChatWindow(e){var c="";var a=new Array();$(".one_tuber_share").each(function(){var f=$(this).find(".one_tuber_name");if(f.hasClass("selected_share")){c+='<div class="tuber_automatic_share">'+t("i want to share this tube with you")+'</div> <br><a href="'+ReturnLink("/profile/"+f.html())+'" target="_blank"><img src="'+f.parent().attr("data-image")+'" +  class="tuber_search" border="0">  <div class="tuber_search_name">'+f.html()+"</div></a>"}});var b={op:"CHAT",to:e,msg:c,timezone:TimeZone};Communicate(b);ChatLogAppend($("#dataTuber"+e),'<div class="ChatMyMessage"><span class="User">'+t("Me")+'</span><span class="Date">'+getTS()+'</span><br/><span class="Msg">'+c+"</span></div>");$("#blackTransparentDiv").trigger("click")}function getRemovedChecked(){var b="";var a=new Array();$(".one_tuber_share").each(function(){var c=$(this).attr("data-tuber");var e=$(this).find(".one_tuber_name");if(e.hasClass("selected_share")){removeFromChatList(c,1)}});$("#blackTransparentDiv").trigger("click")}function viewTubersShare(c){var a=$(document).width();var b=ReturnLink("/get_my_tubers.php?to_user="+c);$("#blackTransparentDiv").show();$("#chattubers").css("left",(a-370)/2).show().load(b,function(){var e=$("#shareTubersInside").jScrollPane({animateDuration:500});jscrollpane_api=e.data("jsp");$("#shareTubersInside .jspDrag").css({"background-color":"#5f5f5f",width:"6px"});$(".one_tuber_share").click(function(){var f=$(this).find(".one_tuber_name");if(f.hasClass("selected_share")){f.removeClass("selected_share")}else{f.addClass("selected_share")}});$("#blackTransparentDiv").unbind("click");$("#blackTransparentDiv").css("cursor","pointer").click(function(){$("#chattubers").hide().html("");$("#blackTransparentDiv").hide()})})}function viewRemovedUsers(){var a=$(document).width();var b=ReturnLink("/get_my_tubers.php?to_user=0&status=notification");$("#blackTransparentDiv").show();$("#chattubers").css("left",(a-370)/2).show().load(b,function(){var c=$("#shareTubersInside").jScrollPane({animateDuration:500});jscrollpane_api=c.data("jsp");$("#shareTubersInside .jspDrag").css({"background-color":"#5f5f5f",width:"6px"});$(".one_tuber_share").click(function(){var e=$(this).find(".one_tuber_name");if(e.hasClass("selected_share")){e.removeClass("selected_share")}else{e.addClass("selected_share")}});$("#blackTransparentDiv").unbind("click");$("#blackTransparentDiv").css("cursor","pointer").click(function(){$("#chattubers").hide().html("");$("#blackTransparentDiv").hide()})})}function viewChatHistory(c){var a=$(document).width();var b=ReturnLink("/get_chat_history.php?to="+c);$("#blackTransparentDiv").show();$("#chathistorydiv").css("left",(a-700)/2).show().load(b,function(){var e=$("#rightChatHistory").jScrollPane({animateDuration:500});showhideTimeFunctions();jscrollpane_api=e.data("jsp");$("#rightChatHistory .jspDrag").css({"background-color":"#5f5f5f",width:"6px"});$("#blackTransparentDiv").unbind("click");$("#blackTransparentDiv").css("cursor","pointer").click(function(){$("#chathistorydiv").hide().html("");$("#blackTransparentDiv").hide()});$(".chat_time_history").click(function(){$(".chat_time_history").removeClass("yellow").addClass("grey");$(this).addClass("yellow");var f=$(this).attr("data-date");var g=$("#"+f).position();jscrollpane_api.scrollToY(g.top-65,true)})})}$(window).resize(function(){var g=$(document).width();var a=230;var c=$(".one-chatLeftList").size();var b=Math.floor((g-a-220)/278);$(".one-chatLeftList").hide();for($i=0;$i<b;$i++){$(".one-chatLeftList").eq($i).width(USUAL_CHAT_WIDTH+"px").show()}if(c>b){var e=c-b;$("#extraWindows").show();var f="+ "+e+" tubers";if(e==1){f="+ "+e+" tuber"}$("#extraWindwosNB").show().html(f)}else{$("#extraWindows").hide()}});$(document).ready(function(){myheightList=$(window).height();if(myheightList<730){myheightList=myheightList-54}else{myheightList=568}$("#chatList").css("height",myheightList+"px");turnOnChat();$("#ttsearch").focus(function(){$(this).val("")});$("#ttsearch").blur(function(){$(this).val("Search for a friend to chat with...")});$("#openChatList").click(function(){$("#chatList").slideToggle(500,function(){if($("#chatList").css("display")!="none"){$.cookie("openchat","true",{path:"/"});destroyContextMenu();loadChatList()}else{$.cookie("openchat","false",{path:"/"});destroyContextMenu()}replaceTuberSearch()})});loadKeyEvents();if($.cookie("openchat")=="true"){$("#chatList").slideToggle();if($("#chatList").css("display")!="none"){$.cookie("openchat","true",{path:"/"});loadChatList()}}});function refreshChatWindow(){myheightList=$(window).height();if(myheightList<730){myheightList=myheightList-54}else{myheightList=568}$("#chatList").css("height",myheightList+"px");$("#chatList #chat-container").css("height",(myheightList-120)+"px");$("#chatList #chat-container-inside").css("height",(myheightList-120)+"px");initChatScrollPane()}function showAllRecords(){$(".one-chat-rec").show();$(".one-chat-remove-fav").hide()}function showJustOnline(){$(".one-chat-rec").hide();$(".one-chat-remove-fav").hide();$(".one-chat-rec").each(function(){if($(this).attr("data-chat-status")=="available"){$(this).show()}})}function showJustFavorites(){$(".one-chat-rec").hide();$(".one-chat-rec").each(function(){if($(this).attr("data-chat-favorites")==1){$(this).show()}});initRemoveFav()}function initRemoveFav(){$(".one-chat-remove-fav").show().css("cursor","pointer").click(function(){var a=$(this).parent().attr("data-tuber");removeFavorite(a)})}function removeFavorite(a){$.ajax({url:ReturnLink("/ajax/chat_favorite_user_del.php"),data:{fav_id:a,op:"deleteFav_frnd"},type:"post",success:function(b){var e=null;try{e=$.parseJSON(b)}catch(c){return}if(!e){TTAlert({msg:t("Couldn't process. please try again later"),type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}if(e.status=="ok"){$("#ChatListItem"+a).attr("data-chat-favorites",0);$("#"+lastFavTab).trigger("click")}else{TTAlert({msg:e.msg,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}$(".chat-overlay-loading-fix").hide()}})}function destroyContextMenu(){$(".conmn-menu").remove()}function loadKeyEvents(){$("#ttsearch").keypress(function(){instantSearch($(this))});$("#ttsearch").keydown(function(){instantSearch($(this))});$("#ttsearch").keyup(function(){instantSearch($(this))})}function loadChatList(){$("#chatList").load(ReturnLink("/chatlist.php"),function(){loadChatFunctions()})}var ChatWindows=0;var ChatID=null;var USUAL_CHAT_WIDTH=273;var MINIMIZED_CHAT_WIDTH=159;var MARGIN_RIGHT_CHAT=5;function SizeAllTabs(){var a=$(window).width()-$("#chat-search").width();var e=$("div.ChatWindow:visible").length;var b=(a-USUAL_CHAT_WIDTH*e-(ChatWindows+2)*MARGIN_RIGHT_CHAT)/(ChatWindows-e);var c=Math.min(MINIMIZED_CHAT_WIDTH,b);$(".one-chatLeftList").each(function(){var f=$(this).attr("data-tuber");if($("#ChatWindow"+f).is(":visible")){$(this).width(USUAL_CHAT_WIDTH)}else{$(this).width(c)}})}function getClientTS(){var g=new Date();var i=g.getFullYear();var e=g.getMonth()+1;var a=g.getDate();var b=g.getHours();var c=g.getMinutes();var f=g.getSeconds();if(b<10){b="0"+b}if(c<10){c="0"+c}if(f<10){f="0"+f}var h=i+"-"+e+"-"+a+" "+b+":"+c+":"+f;return h}function getTS(j){var l,i,e,g,c,m,f,h;if(typeof j!="undefined"){i=j;m=i.getFullYear();g=i.getMonth()+1;c=i.getDate();e=i.getHours();f=i.getMinutes();h=i.getSeconds();if(e<10){e="0"+e}if(f<10){f="0"+f}if(h<10){h="0"+h}var k=new Date();var a=k.getDate();var b=k.getMonth();if((b==g)&&(a==c)){l=e+":"+f+":"+h}else{l=m+"-"+g+"-"+c+" "+e+":"+f+":"+h}}else{i=new Date();e=i.getHours();f=i.getMinutes();h=i.getSeconds();if(e<10){e="0"+e}if(f<10){f="0"+f}if(h<10){h="0"+h}l=e+":"+f+":"+h}return l}function HideChat(){$(".ChatWindow").hide();$("#chatList").hide()}var WhichStorage=sessionStorage;function ChatLogSave(b,a){if(typeof WhichStorage!="undefined"){WhichStorage.setItem("log_"+b,a)}}function ChatLogGet(a){if(typeof WhichStorage!="undefined"){return WhichStorage.getItem("log_"+a)}return null}function ChatLogSaveMsgNumber(c,b){if(typeof WhichStorage!="undefined"){var a=ChatLogGetMsgNumber(c);if(a==null){a=1}else{a++}b.find(".LeftTuberName").css("color","#000000");b.find("span.status").html("("+a+")");WhichStorage.setItem("log_"+c,a);$(".quickuploadcontainer").hide()}}function ChatLogGetMsgNumber(a){if(typeof WhichStorage!="undefined"){return WhichStorage.getItem("log_"+a)}return null}function ChatLogExtract(a){return $(".jspPane",a).html()}function ChatLogAppend(a,b){$(".jspPane",a).append(b);initScrollPane(a)}function initScrollPane(a){var b=a.jScrollPane();a.find(".jspDrag").css("background-color","#5f5f5f");a.find(".jspVerticalBar").css("width","5px");jscrollpane_api=b.data("jsp");jscrollpane_api.scrollToY(TotalInnerHeight(a.find(".jspPane"))+1000,true)}var d=new Date();var TimeZone=d.getTimezoneOffset();var ToWho=0;varChatZIndex=10000;function AddTuberChat(A,n){if(typeof n=="undefined"){n=true}if(A.length==0){return}if(!checkIfExist(A)){var y=$("#ChatListItem"+A).attr("data-chat-status");var z=$("#ChatListItem"+A).find(".one-chat-name span").text();if(!z){z="Tuber";y="green"}var k=$("<div class='one-chatLeftList' data-tuber='"+A+"' title='"+z+"'><div class='LeftChatContainer'></div><div class='LeftTuberName left"+y+"'>"+z+"</div><span class='status'></span></div>");var v=$(document).width();var o=230;var q=$(".one-chatLeftList").size()+1;var p=Math.floor((v-o-220)/278);if(q>p){var s=q-p;$("#extraWindows").show();$("#extraWindows").unbind("click");$("#extraWindows").css("cursor","pointer").click(function(){if($("#extraList").is(":visible")){$("#extraList").hide()}else{$("#extraList").show()}});var u="+ "+s+" tubers";if(s==1){u="+ "+s+" tuber"}$("#extraWindwosNB").show().html(u);var x=$(".one-chatLeftList:last").attr("title");var w=$(".one-chatLeftList:last").attr("data-tuber");var l=$("<div class='oneExtraItem' data-tuber='"+w+"'>"+x+"</div>");$("#extraList").append(l);l.click(function(){var C=$(".one-chatLeftList:visible:last").attr("title");var B=$(".one-chatLeftList:visible:last").attr("data-tuber");$(".one-chatLeftList:visible:last").hide();$(".one-chatLeftList[data-tuber='"+l.attr("data-tuber")+"']").css("width",USUAL_CHAT_WIDTH+"px").show();$(this).attr("data-tuber",B).html(C)});$(".one-chatLeftList:visible:last").hide()}$("#chat-leftList").append(k);var b=$('<div class="ChatWindow" id="ChatWindow'+A+'"></div>').css({"z-index":varChatZIndex});$(".LeftChatContainer",k).append(b).click(function(B){B.stopImmediatePropagation()});var i=$("<div class='one-chat-settings'><div class='one-chat-settings-row' id='viewChatHistory"+A+"'>"+t("view chat history")+"</div></div>");i.appendTo(b);$chatEmoticons=$("<div class='emoticonslist'></div>");$chatEmoticons.appendTo(b);var j=$("<div class='ChatTitle left"+y+"2'>"+z+"</div>");var a=$('<div class="ChatCloseImg" title="Close"></div>');var g=$('<div class="ChatMinimize" title="Minimize"></div>');var h=$('<div class="ChatSet" title="Settings"></div>');var c=$('<div class="emoticonsIcon" title="Emoticons"></div>');j.append(a).append(h).append(g).append(c).appendTo(b);var r=ChatLogGet(z);if(r==null){r=""}var f=$("<div class='ChatLog'  id='dataTuber"+A+"'></div>");f.appendTo(b);f.html(r);ChatWindows++;b.hide();b.parent().find(".quickuploadcontainer").hide();var e=$('<input type="text" id="chatInput'+A+'" class="chatInput" value="type something..."/>').css({position:"absolute",width:"244px","z-index":varChatZIndex,display:"none",border:"1px solid #c0c0c2"}).outerHeight(k.outerHeight()).appendTo($(".LeftChatContainer",k)).keyup(function(B){if(B.keyCode==13){var C=$(this).val();if(C==""){return}SendMsgTo(ToWho,C);$(this).val("");ChatLogAppend(f,'<div class="ChatMyMessage"><span class="User">'+t("Me")+'</span><span class="Date">'+getTS()+'</span><br/><span class="Msg">'+EmoticonTextReplace(C)+"</span></div>");ChatLogSave(f.parent().find(".ChatTitle").text(),ChatLogExtract(f));showhideTimeFunctions()}}).click(function(B){B.stopImmediatePropagation();return false}).focus(function(){if($(this).val()=="type something..."){$(this).val("")}});var m=$("#quickupload");m=$('<div class="quickuploadcontainer" id="quickuploadContainer'+A+'"><img src="'+AbsolutePath+'/images/quickupload.jpg" id="quickupload'+A+'"></div>').appendTo($(".LeftChatContainer",k));a.click(function(){ChatWindows--;k.remove();b.remove();e.remove();SizeAllTabs();manageExtraLists()});g.click(function(){b.hide();b.parent().find(".quickuploadcontainer").hide();e.hide();SizeAllTabs()});k.click(function(){ToWho=A;WhichStorage.setItem("log_"+ToWho+"msgnum",0);k.find("span.status").html("");if(b.is(":visible")){b.hide();b.parent().find(".quickuploadcontainer").hide();e.hide()}else{b.show();b.parent().find(".quickuploadcontainer").show();initScrollPane(f);e.show();k.removeClass("activeChat");k.find(".LeftTuberName").css("color","#FFF")}SizeAllTabs()});if(n){k.click()}h.click(function(){var B=$(this).parent().parent().find(".one-chat-settings");if(!(B.is(":visible"))){$(this).css("background","url("+AbsolutePath+"/images/chatSetBtn-hover.jpg) center center no-repeat");B.show();$("#viewChatHistory"+A).click(function(){viewChatHistory(A);$(this).parent().parent().find(".ChatSet").trigger("click")})}else{$(this).css("background","url("+AbsolutePath+"/images/chatSetBtn.jpg) center center no-repeat");B.hide()}if($(this).parent().parent().find(".emoticonslist").is(":visible")){$(this).parent().find(".emoticonsIcon").trigger("click")}});c.click(function(){var B=$(this).parent().parent().find(".emoticonslist");if(!(B.is(":visible"))){$(this).css("background","url("+AbsolutePath+"/images/emotiIcon-hover.jpg) center center no-repeat");B.show().load(ReturnLink("/get_emoticons.php"),function(){emoticonsFunctions(c)})}else{B.hide();$(this).css("background","url("+AbsolutePath+"/images/emotiIcon.jpg) center center no-repeat")}});$("#shareTuber").click(function(){var B=$(this).parent().parent().attr("id");B=B.replace("ChatWindow","");viewTubersShare(B)});initScrollPane(f);initUpload("quickuploadContainer"+A,"quickupload"+A);$("#send_media").click(function(){var B=$(this).parent().parent().parent().find(".quickuploadcontainer img").attr("id");alert(B);$("#"+B).click()});showhideTimeFunctions()}}function emoticonsFunctions(c){var b=269;var a=38;$(".oneEmoTab").css("cursor","pointer").click(function(){var g=$(this).index()-1;var f=$(this).parent().parent().find(".emoticonsContainer");var e=$(this).parent().find(".emotiArrow");e.animate({left:g*a+"px"},500);f.animate({left:-(g*b)+"px"},500)});$(".one_emoticon_div").css("cursor","pointer").click(function(){var e=$(this).parent().parent().parent().parent().parent().find(".chatInput");var f=e.val();if(f=="type something..."){f=""}f+=$(this).attr("title");e.val(f);e.focus();c.trigger("click")})}function manageExtraLists(){var a=$(".one-chatLeftList:hidden:first");var b=a.attr("data-tuber");var c=a.attr("title");a.show().css("width",USUAL_CHAT_WIDTH+"px");$(".oneExtraItem[data-tuber = "+b+"]").remove();calculateChatWindowOffsets()}function calculateChatWindowOffsets(){var g=$(document).width();var a=230;var c=$(".one-chatLeftList").size();var b=Math.floor((g-a-220)/278);if(c>b){var e=c-b;var f="+ "+e+" tubers";if(e==1){f="+ "+e+" tuber"}$("#extraWindwosNB").show().html(f)}else{$("#extraWindows").hide()}}function showhideTimeFunctions(){$(".ChatHisMessage,.ChatMyMessage").unbind("mouseover");$(".ChatHisMessage,.ChatMyMessage").mouseover(function(){$(".ChatHisMessage,.ChatMyMessage").find(".Date").hide();$(this).find(".Date").show()});$(".ChatHisMessage,.ChatMyMessage").unbind("mouseout");$(".ChatHisMessage,.ChatMyMessage").mouseout(function(){$(".ChatHisMessage,.ChatMyMessage").find(".Date").hide()})}function TotalInnerHeight(a){var b=0;a.children().each(function(){b+=$(this).height()});return b}function daysInMonth(b,c){var a=[31,28,31,30,31,30,31,31,30,31,30,31];if(b!=1){return a[b]}if(c%4!=0){return a[1]}if(c%100==0&&c%400!=0){return a[1]}return a[1]+1}function ActivateTab(a){$("#chat-leftList").find("div.one-chatLeftList").each(function(){if(($(this).attr("data-tuber")==a)){if(!$("#ChatWindow"+a).is(":visible")){ChatLogSaveMsgNumber(a+"msgnum",$(this));$(this).addClass("activeChat")}else{if(!$(this).hasClass("activeChat")){$(this).find(".LeftTuberName").css("color","#FFF")}}}})}function AppendToLog(g){if(g.from.length==0){return}var e=g.from;var l=g.to;var j=g.msg;var m="";if(typeof g.ts!="undefined"){m=g.ts;var n=m.split("-");var r=parseInt(n[0]);var i=parseInt(n[1])-1;var c=parseInt(n[2]);var f=parseInt(n[3]);var h=parseInt(n[4]);var k=parseInt(n[5]);h-=TimeZone;if(h<0){h+=60;f--}if(f<0){f+=24;c--}if(c<=0){i--;if(i<0){i=11;r--}c=daysInMonth(i,r)}var o=new Date(r,i,c,f,h,k);m=getTS(o)}else{m=getTS()}var a;if(e==CHAT_USER_ID){ActivateTab(l);var b;var p="Me";var q=$("#ChatListItem"+l).find(".one-chat-name span").text();b='<div class="ChatMyMessage"><span class="User">'+p+'</span><span class="Date">'+m+'</span><br/><span class="Msg">'+EmoticonTextReplace(j)+"</span></div>";a=$("#ChatWindow"+l).find("div.ChatLog");ChatLogAppend(a,b);ChatLogSave(q,ChatLogExtract(a))}else{ActivateTab(e);var b;var p=$("#ChatListItem"+e).find(".one-chat-name span").text();b='<div class="ChatHisMessage"><span class="User">'+p+'</span><span class="Date">'+m+'</span><br/><span class="Msg">'+EmoticonTextReplace(j)+"</span></div>";a=$("#ChatWindow"+e).find("div.ChatLog");ChatLogAppend(a,b);ChatLogSave(p,ChatLogExtract(a))}}function loadChatFunctions(){$("#chatSetButton").click(function(){if(!($("#chatSettingsList").is(":visible"))){showChatSettings()}else{hideChatSettings()}});initFavorites()}function showChatSettings(){$("#chatList").unbind("click");$("#chatSetButton").css("background","url("+AbsolutePath+"/images/settings-for-chat-hover.jpg)");$("#chatSettingsList").fadeIn(10,function(){$("#turnOffChat").click(function(){turnOffChat()});$("#addRemovedUser").click(function(){viewRemovedUsers()});$("#chatList").click(function(){hideChatSettings()})})}function hideChatSettings(){$("#chatSetButton").css("background","url("+AbsolutePath+"/images/settings-for-chat.jpg)");$("#chatSettingsList").hide()}function instantSearch(b){var c=b.val();if(c==""){$(".one-chat-rec").show()}else{var a=$(".one-chat-rec").size();if(a==0){$("#chatList").show();if($("#chatList").css("display")!="none"){loadChatList()}}$("#chatList").show();$(".one-chat-rec").each(function(){var e=$(this).find(".one-chat-name").html();e=(e).toLowerCase();if(e.indexOf(c)!=-1){$(this).show()}else{$(this).hide()}})}}function checkIfExist(b){var a=false;$(".one-chatLeftList").each(function(){if($(this).attr("data-tuber")==b){a=true}});return a}function chatListLoaded(){return($("#chatList").text()!="")}function reinitChatSCrollPane(){$("#chat-container-inside").data("jsp").destroy();initChatScrollPane()}function initChatScrollPane(){$(".scroll-panenew").jScrollPane();$(".scroll-panenew .jspVerticalBar").css("right",0+"px").css("width","7px");$(".scroll-panenew .jspVerticalBar").css("opacity",0.43)};