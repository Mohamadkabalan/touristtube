var currencyLogo="$";var budgetPerDay=0;var budget;var search_name;var data_state;var data_country;var currency;var departdate;var nb_days;var themes;var stars=[];var cuisines=[];var dayNumber;var placeToGo;var dateDep;var displayDay;var rest_type;function resetDailyBudget(){budgetPerDay=Math.round($(".budgetOutput").attr("data-value")/$(".plannerADaySel").attr("data-value"));$(".plannerDescRight").html(budgetPerDay+currencyLogo)}$(document).ready(function(){$("#budgetSlider").slider({from:0,to:19500,step:500,smooth:true,round:0,dimension:"&nbsp;$",skin:"tube",onstatechange:function(d){var g=this.o.pointers;var i=g[0].value.origin;var h=g[1].value.origin;var f=i==h?i+currencyLogo:i+currencyLogo+" - "+h+currencyLogo;$(".budgetOutput").html(f);$(".budgetOutput").attr("data-value",h);resetDailyBudget()}});var b="";autocompleteDiscover($("#plannerStationSelect"));addmoreusersautocomplete_custom_journal($("#addmoretext_privacy"));$(".shareMe").fancybox();var c=$("#foodTypeSelect").val();if(c!=null){if(c.length>0){for(var a=0;a<c.length;a++){b+='<div class="foodTypeOptionDisp">'+c[a]+"</div>"}$(".foodTypeOptionDispCont").html(b)}}$(document).on("click",".overdatabutenable",function(){var d=$(this);if(String(""+d.attr("data-status"))=="1"){d.attr("data-status","0");d.find(".overdatabutntficon").addClass("inactive")}else{d.attr("data-status","1");d.find(".overdatabutntficon").removeClass("inactive")}});$(document).on("click",".hotelsplus",function(){var e=$(this);var d=$(this).closest(".stationContainer");var k=d.attr("data-id");var f=$(".search_result_container").attr("data-bag");var h=""+($("#plannerStationSelect").attr("data-code")).toUpperCase();var i=""+($("#plannerStationSelect").attr("data-state-code"));var g=""+($("#plannerStationSelect").attr("data-city"));var j=d.attr("data-type");TTCallAPI({what:"/user/bag/add",data:{item_id:k,entity_type:j,data_country:h,data_state:i,data_city:g},callback:function(m){if(m.status==="error"){TTAlert({msg:m.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}$(".bag_count").html(m.count);e.removeClass("hotelsplus");e.addClass("stationBag");var l='<div class="stationContainer"><div class="stationImgCon"><img src="'+d.find(".stationImg").attr("src")+'" alt="" class="stationImg" /></div><div class="stationTitle">'+d.find(".stationTitle").html()+'</div><div class="stationSep"></div></div>';$(".ContainermapPartttBag").append(l)}})});$(".foodTypeOptionDispCont").on("click",".foodTypeOptionDisp",function(f){f.stopPropagation();f.preventDefault();var d=$(this);var i=$(this).attr("data-value");var h=$(this).html();var j="";if($("#foodTypeSelect").val()!=null){if($("#foodTypeSelect").val().length>0){$theArray=$("#foodTypeSelect").val();var g=$theArray.indexOf(i);$theArray.splice(g,1);$("#foodTypeSelect").val($theArray);d.remove();j+='<div class="foodTypeOpt" data-value="'+i+'">'+h+"</div>"}}$(".foodTypeSelect").append(j);return false});$(".foodTypeSelect").on("click",".foodTypeOpt",function(){var h=$("#foodTypeSelect").val();var d=""+$(this).attr("data-value");if(h!=null){if($.inArray(d,h)!==-1){var f=h.indexOf(d);h.splice(f,1);$("#foodTypeSelect").val(h)}else{h.push(d);$("#foodTypeSelect").val(h)}}else{$("#foodTypeSelect").val([d])}var j="";var l=$("#foodTypeSelect").val();if(l!=null){if(l.length>0){for(var e=0;e<l.length;e++){var k=l[e];var g=$("#foodTypeSelect option[value='"+k+"']").text();j+='<div class="foodTypeOptionDisp" data-value="'+k+'">'+g+"</div>"}}}$(".foodTypeOptionDispCont").html(j);$(this).remove()});$(".FromToStars").each(function(f,e){var d=$(this);d.raty({path:AbsolutePath+"/images",hints:["Very Poor","Poor","Neutral","Good","Very Good"],starOn:"rating_1.png",starOff:"rating_0.png",score:$("#myrating_score").val()})});$(".plannerThemesOption").click(function(){$(this).toggleClass("plannerThemesOptionSelected")});$(".interestCategoryOption").click(function(){$(this).remove()});$(".starBlock").click(function(){var d=$(this);if(d.hasClass("starBlockSel")){d.removeClass("starBlockSel")}else{d.addClass("starBlockSel")}});$(".plannerValidateButton").click(function(){budget=$(".budgetOutput").attr("data-value");search_name=$("#plannerStationSelect").val();data_state=$("#plannerStationSelect").attr("data-state-code");data_country=$("#plannerStationSelect").attr("data-code");currency=""+$(".myCurrencySelect").val();departdate=$(".departdate").attr("data-value");nb_days=$(".plannerADay.plannerADaySel").attr("data-value");var e=new Array();$(".plannerThemesOption.plannerThemesOptionSelected").each(function(h,g){var f=$(this).attr("data-value");e.push(f)});themes=e.join("/*/");var d="";stars.length=0;$(".starBlock.starBlockSel").each(function(){var f=$(this).attr("data-value");stars.push(f)});dayNumber=$(".plannerADaySel").attr("data-value");dateDep=$("#fromtxt").attr("data-value");placeToGo=getObjectData($(".plannerStationSelect"));if(placeToGo==""){d=t("please, specify your destination")}if(dateDep==""){if(d!=""){d=t("please, specify your destination and your departure date")}else{d=t("please, specify your departure date")}}rest_type=$("#foodTypeSelect").val()!=null?$("#foodTypeSelect").val().join(","):"";if(d!=""){TTAlert({msg:d,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null});return}displayDay=1;$(".search_result_container").attr("data-bag",search_name);getMapRelated()});$(".plannerADay").click(function(){var d=$(this);if(!d.hasClass("plannerADaySel")){$(".plannerADay").removeClass("plannerADaySel");d.addClass("plannerADaySel");resetDailyBudget()}});$(".plannerAddDay").click(function(){$(".plannerNbDaysContainer").animate({top:"-75px"},500);$(".plannerNbDaysContainer2").animate({top:"0px"},500)});$(".plannerRemDay").click(function(){$(".plannerNbDaysContainer2").animate({top:"75px"},500);$(".plannerNbDaysContainer").animate({top:"0px"},500)});$(".plannerSavedTrips .plannerBottomTrips:even").addClass("clearBoth");$(".plannerSuggestedFriendsTrips .plannerBottomTrips:even").addClass("clearBoth");$("#dateInput").blur(function(){if($(this).val()==""){$(this).val("dd")}});$("#dateInput2").blur(function(){if($(this).val()==""){$(this).val("mm")}});$("#dateInput3").blur(function(){if($(this).val()==""){$(this).val("yyyy")}});$(document).on("click",".mapPart_buttons",function(){var e=$(this);var d=e.attr("index");if(e.hasClass("mapPartSel")){$(".mapParttripDates,.mapParthotels,.mapPartrestaurants,.mapPartattractions,.mapPartmyPlanner,.mapPartttBag,.mapPartTuber").removeClass("mapPartSel");$(".ContainermapParttripDates,.ContainermapParthotels,.ContainermapPartrestaurants,.ContainermapPartattractions,.ContainermapPartmyPlanner,.ContainermapPartttBag,.ContainermapPartTuber").hide();$(".ContainermapPartSchedule").show();initscrollPane($(".ContainermapPartSchedule"))}else{$(".mapParttripDates,.mapParthotels,.mapPartrestaurants,.mapPartattractions,.mapPartmyPlanner,.mapPartttBag,.mapPartTuber").removeClass("mapPartSel");$(".ContainermapPartSchedule,.ContainermapParttripDates,.ContainermapParthotels,.ContainermapPartrestaurants,.ContainermapPartattractions,.ContainermapPartmyPlanner,.ContainermapPartttBag,.ContainermapPartTuber").hide();$(".ContainermapParttripDates,.ContainermapParthotels,.ContainermapPartrestaurants,.ContainermapPartattractions,.ContainermapPartmyPlanner,.ContainermapPartttBag,.ContainermapPartTuber").each(function(){if($(this).attr("index")==d){$(this).show();initscrollPane($(this))}});e.addClass("mapPartSel")}});InitCalendar();$(document).on("click",".uploadinfocheckbox",function(){if($(this).hasClass("active")){$(this).removeClass("active");if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friendsdata").remove()}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#friends_of_friends_data").remove()}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){$(this).parent().parent().find("#followersdata").remove()}}}}}else{$(this).addClass("active");if($(this).hasClass("uploadinfocheckbox3")){if($(this).parent().hasClass("friendscontainer")){var e='<div class="peoplesdata formttl13" id="friendsdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(e)}}else{if($(this).hasClass("uploadinfocheckbox_friends_of_friends")){if($(this).parent().hasClass("friendscontainer")){var d='<div class="peoplesdata formttl13" id="friends_of_friends_data" data-email="" data-id=""><div class="peoplesdatainside">'+t("friends of friends")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(d)}}else{if($(this).hasClass("uploadinfocheckbox4")){if($(this).parent().hasClass("friendscontainer")){var d='<div class="peoplesdata formttl13" id="followersdata" data-email="" data-id=""><div class="peoplesdatainside">'+t("followers")+'</div><div class="peoplesdataclose"></div></div>';$(this).parent().parent().find(".emailcontainer div:eq(0)").after(d)}}}}}});$(document).on("click",".peoplesdataclose",function(){var d=$(this).parent();var e=d.parent().parent();d.remove();if(d.attr("data-id")!=""){SelectedUsersDelete(d.attr("data-id"),e.find(".addmore input"))}if(d.attr("id")=="friendsdata"){e.find(".uploadinfocheckbox3").removeClass("active")}else{if(d.attr("id")=="followersdata"){e.find(".uploadinfocheckbox4").removeClass("active")}else{if(d.attr("id")=="connectionsdata"){e.find(".uploadinfocheckbox5").removeClass("active")}else{if(d.attr("id")=="sponsorssdata"){e.find(".uploadinfocheckbox6").removeClass("active")}else{if(d.attr("id")=="friends_of_friends_data"){e.find(".uploadinfocheckbox_friends_of_friends").removeClass("active")}}}}}})});function getSelectionHandler(){}function setCalanderTrip(a){Calendar.setup({cont:"tripDatesCalendarContainer",noScroll:true,fdow:1,selectionType:Calendar.SEL_SINGLE,onSelect:getSelectionHandler(),selection:Calendar.dateToInt(a),date:a,disabled:function(c){var d=new Date();var b=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0);return(c<b)}})}function InitCalendar(){Calendar.setup({inputField:"fromtxt",noScroll:true,trigger:"fromtxt",align:"B",onSelect:function(a){var b=Calendar.intToDate(a.selection.get());$("#fromtxt").attr("data-value",Calendar.printDate(b,"%Y-%m-%d"));this.hide()},dateFormat:"%d / %m / %Y",disabled:function(b){var c=new Date();var a=new Date(c.getFullYear(),c.getMonth(),c.getDate(),0,0,0,0);return(b<a)}})}var directionsDisplay;var directionsService;var poly;var map;var ib;var boxText;var flightPlanCoordinates=[];function setMapSearch(j,m,r,e,q,d){directionsService=new google.maps.DirectionsService();directionsDisplay=new google.maps.DirectionsRenderer();var a=$(".googlemap");var b=a.attr("id");var g=new google.maps.MarkerImage(ReturnLink("/images/pin_empty.png"));var p=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];var n={center:new google.maps.LatLng(j,m),zoom:12,disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:p};map=new google.maps.Map(document.getElementById(b),n);directionsDisplay.setMap(map);directionsDisplay.setOptions({suppressMarkers:true});boxText=document.createElement("div");var o={content:boxText,disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{opacity:0.9,width:"120px",height:"140px"},closeBoxURL:"",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};ib=new InfoBox(o);var c=(d).split("[*]");var h;for(var f=0;f<c.length;f++){var k=(c[f]).split("/*/");if(k[0]==0||k[1]==0){continue}var l=new google.maps.LatLng(k[1],k[0]);if(parseInt(k[2])==SOCIAL_ENTITY_RESTAURANT){h=new google.maps.MarkerImage(ReturnLink("/images/pin_rest.png"))}else{if(parseInt(k[2])==SOCIAL_ENTITY_HOTEL){h=new google.maps.MarkerImage(ReturnLink("/images/pin_hot.png"))}else{if(parseInt(k[2])==SOCIAL_ENTITY_LANDMARK){h=new google.maps.MarkerImage(ReturnLink("/images/pin_lmk.png"))}}}drawBagMarker(l,h,k[3],k[4],k[5],k[6],0,"",0)}google.maps.event.addListener(map,"click",function(){ib.close()});drawMapLines(e,q)}function drawMapLines(b,j){var a=(b).split("[*]");flightPlanCoordinates=[];for(var c=0;c<a.length;c++){var f=(a[c]).split("/*/");if(f[0]==0||f[1]==0){continue}var g=new google.maps.LatLng(f[1],f[0]);var h=new Array(g,f[2],f[3],f[4],f[5],f[6]);flightPlanCoordinates.push(h)}if(flightPlanCoordinates.length>1){flightPlanCoordinates.push(flightPlanCoordinates[0])}if(flightPlanCoordinates.length>0){var d=new google.maps.MarkerImage(ReturnLink("/images/pin_empty.png"));var e=new google.maps.MarkerImage(ReturnLink("/images/pin_hot.png"));drawBagMarker(flightPlanCoordinates[0][0],e,flightPlanCoordinates[0][1],flightPlanCoordinates[0][3],flightPlanCoordinates[0][4],flightPlanCoordinates[0][5],0,"",0);calcRoute(0,d)}}function addLatLng(a){var b=flightPlanCoordinates[a][0];var c=poly.getPath();c.push(b);a++;if(a>=flightPlanCoordinates.length){return}else{setTimeout(function(){addLatLng(a)},800)}}function calcRoute(e,d){var a=flightPlanCoordinates.length;var k=flightPlanCoordinates[0][0];var b=flightPlanCoordinates[e][0];var l=[];var g="";for(var c=1;c<e;c++){if(c==(e-1)){g="Start point \n"+flightPlanCoordinates[c][1]}else{g=flightPlanCoordinates[c][1]}l.push({location:flightPlanCoordinates[c][0],stopover:true})}var h={origin:k,destination:b,waypoints:l,optimizeWaypoints:true,travelMode:google.maps.TravelMode.WALKING};var f=new Array();directionsService.route(h,function(n,p){if(p==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(n);var o=n.routes[0];e++;if(e>a-1){for(var m=0;m<o.legs.length;m++){var j=o.legs[m];f.push([j.distance.text,j.duration.text,o.waypoint_order])}DisplayOnMap(f,d);return}else{setTimeout(function(){calcRoute(e,d)},800)}}})}function DisplayOnMap(k,f){var l="";for(var d=0;d<k.length;d++){var b=k[d];var h=b[2][d];if(String(""+h)=="undefined"){h=-1}if(String(""+h)!="undefined"){h=parseInt(h)+1;try{if(h==0){var g=new google.maps.MarkerImage(ReturnLink("/images/pin_hot.png"));drawBagMarker(flightPlanCoordinates[h][0],g,flightPlanCoordinates[h][1],flightPlanCoordinates[h][3],flightPlanCoordinates[h][4],flightPlanCoordinates[h][5],0,(b[0]+" - "+b[1]),0)}else{drawBagMarker(flightPlanCoordinates[h][0],f,flightPlanCoordinates[h][1],flightPlanCoordinates[h][3],flightPlanCoordinates[h][4],flightPlanCoordinates[h][5],0,(b[0]+" - "+b[1]),(d+1))}}catch(c){}}l+="<strong>"+t("Track")+" "+d+" :</strong> "+b[0]+" - "+b[1]+"<br>"}$(".plannerMapTrackInfo").append(l)}function changeDay(a){displayDay=parseInt($(a).val());getMapRelated()}function drawBagMarker(i,c,l,e,d,a,k,j,g){if(g!=0){var f=new MarkerWithLabel({position:i,map:map,draggable:true,raiseOnDrag:true,labelContent:g,icon:c,icon:c,labelAnchor:new google.maps.Point(3,30),labelClass:"labels",labelInBackground:false})}else{var f=new google.maps.Marker({position:i,title:l,icon:c,map:map})}var b="";var h=function(){ib.close();var n=this;var m='<div class="mtooltip"><div class="mtooltipin"><div class="clsgoo" onClick="ib.close();">X</div>';if(d!=""){m+='<img class="mtooltipbig" src="'+d+'" alt="" width="72" height="39" />';m+='<br /><a href="'+e+'" target="_blank">'}m+='<div class="mtooltip_title">'+l+"</div>";if(d!=""){m+="</a>"}if(parseInt(a)>0&&parseInt(a)<=5){m+='<div class="anchor_star anchor_star'+a+'"></div>'}if(parseInt(k)!=0){m+='<div class="textreviews"><u>'+k+" "+t("REVIEWS")+"</u></div>"}if(j!=""){m+='<div class="textreviews">'+j+"</div>"}m+='</div><div class="anchor_bk"></div></div>';boxText.innerHTML=m;ib.open(map,n)};google.maps.event.addListener(f,"click",h)}function getMapRelated(){$(".upload-overlay-loading-fix").show();$.post(ReturnLink("/ajax/ajax_planer_result.php"),{search_name:search_name,data_state:data_state,data_country:data_country,displayDay:displayDay,currency:currency,budget:budget,departdate:departdate,nb_days:nb_days,themes:themes,stars:stars,rest_type:rest_type},function(a){var c=null;try{c=$.parseJSON(a)}catch(b){$(".upload-overlay-loading-fix").hide();return}if(c.error){TTAlert({msg:c.error,type:"alert",btn1:t("ok"),btn2:"",btn2Callback:null})}else{$(".search_result_container").html(c.data);$(".current_bag .bag_count").html(c.all_bag_count);$(".current_bag").show();$("#plannerStationSelect").attr("data-code",c.data_country);$("#plannerStationSelect").attr("data-state-code",c.data_state);$("#plannerStationSelect").attr("data-city",c.city_id);setCalanderTrip(parseInt(c.departdate_str));initscrollPane($(".ContainermapPartSchedule"))}$(".upload-overlay-loading-fix").hide()})}function initscrollPane(a){a.jScrollPane()};