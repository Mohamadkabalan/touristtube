!function(a){jQuery.sessionTimeout=function(b){function g(b){switch(b){case"start":e=setTimeout(function(){a("#sessionTimeout-dialog").dialog("open"),h("start")},d.warnAfter);break;case"stop":clearTimeout(e)}}function h(b){switch(b){case"start":f=setTimeout(function(){a.ajax({type:"POST",url:d.actionUrl,data:{access_token:d.access_token,returnedConversationId:d.returnedConversationId}}).done(function(){window.location=d.redirUrl})},d.redirAfter-d.warnAfter);break;case"stop":clearTimeout(f)}}function i(a,b,c){var d=new RegExp("([?|&])"+b+"=.*?(&|#|$)","i");if(a.match(d))return a.replace(d,"$1"+b+"="+c+"$2");var e="";return-1!==a.indexOf("#")&&(e=a.replace(/.*#/,"#"),a=a.replace(/#.*/,"")),a+(-1!==a.indexOf("?")?"&":"?")+b+"="+c+e}var e,f,c={message:"Your session is about to expire.",keepAliveUrl:"/keep-alive",keepAliveAjaxRequestType:"POST",redirUrl:"/timed-out",logoutUrl:"/log-out",warnAfter:9e5,redirAfter:12e5,appendTime:!0,access_token:"",returnedConversationId:"",actionUrl:"/close-session"},d=c;b&&(d=a.extend(c,b)),a("body").append('<div title="Session Timeout" id="sessionTimeout-dialog">'+d.message+"</div>"),a("#sessionTimeout-dialog").dialog({autoOpen:!1,width:400,modal:!0,closeOnEscape:!1,open:function(){a(".ui-dialog-titlebar-close").hide()},buttons:{"End Session Now":function(){a.ajax({type:"Post",url:d.actionUrl,data:{access_token:d.access_token,returnedConversationId:d.returnedConversationId}}).done(function(){window.location=d.logoutUrl})},"Stay Connected":function(){a(this).dialog("close"),a.ajax({type:d.keepAliveAjaxRequestType,url:d.appendTime?i(d.keepAliveUrl,"_",(new Date).getTime()):d.keepAliveUrl,data:{access_token:d.access_token,returnedConversationId:d.returnedConversationId}}).done(function(a){"success"!==a.status&&(window.location=d.redirUrl)}),h("stop"),g("start")}}}),a(document).ajaxComplete(function(){a("#sessionTimeout-dialog").dialog("isOpen")||(h("stop"),g("stop"),g("start"))}),g("start")}}(jQuery);